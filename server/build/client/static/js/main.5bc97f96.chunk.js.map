{"version":3,"sources":["features/experience/Buttons.js","features/experience/experienceSlice.js","features/experience/Speech.js","features/experience/Layer.js","features/experience/Navigation.js","features/experience/Tree.js","hooks/useD3.js","hooks/useWindowDimensions.js","features/experience/Importer.js","features/experience/Experience.js","App.js","app/store.js","serviceWorker.js","index.js"],"names":["Buttons","ready","names","handleAction","buttons","map","b","onClick","className","socket","io","window","location","href","experienceSlice","createSlice","name","initialState","layers","events","readyforinput","transcript","lastsenttranscript","authored","layerName","listening","rendering","reducers","setAuthored","state","action","payload","setLayerName","setLayers","setEvents","setEvent","filter","l","id","setTranscript","layerid","setReadyForInput","setListening","sentTranscript","resetReadiness","setRendering","actions","on","console","log","setTimeout","connect","fetchAuthored","dispatch","superagent","get","then","res","alist","body","selectEvents","experience","sort","a","selectReadyForInput","selectSpeech","selectTrees","reduce","acc","item","d3","nodeSize","d","children","selectAuthored","selectLayerName","selectRendering","Speech","rules","handleChange","useState","words","setWords","_handleChange","value","_handleAction","speech","useSelector","style","height","trim","operands","rule","operand","o","next","length","onChange","e","target","type","placeholder","renderOperands","Layer","useDispatch","minHeight","overflow","data","toggleTree","event","query","layer","end","err","buttonPressed","getState","sendTranscript","Object","keys","key","JSON","stringify","renderEvent","Navigation","start","toggleCreate","twineExport","renderSpeech","width","viewBox","fillRule","clipRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","fill","stroke","strokeWidth","cx","cy","rx","ry","encodeURI","textWeight","opacity","_seen","_flatten","list","concat","Array","isArray","links","node","trigger","from","x","y","to","c","rids","root","rid","_clink","sx","sy","tx","ty","_loopback","isloopback","Tree","t","gtree","React","g","current","mx","my","moustrans","select","attr","split","replace","transition","duration","moveChart","mytree","d3Fn","dependencies","ref","useRef","useEffect","useD3","svg","dgbox","call","d3z","transform","generatecoords","n","recenter","r","seenlinks","link","Math","max","min","anchor","labeldata","label","ld","i","fontSize","textAnchor","Set","join","operator","rulelabel","ruletext","fontWeight","renderLinks","renderTree","selected","handleClick","paint","triggered","getWindowDimensions","innerWidth","innerHeight","Importer","save","cancel","json","setJSON","error","setError","setName","selectedFile","setSelectedFile","changeHandler","files","handleSubmission","fileReader","FileReader","readAsText","onload","parse","result","importIt","Experience","trees","visibleTrees","setVisibleTrees","create","setCreate","windowDimensions","setWindowDimensions","handleResize","addEventListener","removeEventListener","useWindowDimensions","undefined","setStartLabel","BrowserSpeechRecognition","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","msSpeechRecognition","oSpeechRecognition","recognition","continous","interimResults","lang","urlSearchParams","URLSearchParams","search","fromEntries","entries","et","tree","catch","manualTrigger","expandedtrees","th","e1","e2","request","post","set","send","reset","html","htmlString","encodeURIComponent","document","createElement","download","click","App","configureStore","reducer","experienceReducer","Boolean","hostname","match","ReactDOM","render","StrictMode","store","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.5bc97f96.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nfunction Buttons({ready, names, handleAction}) {\n    \n\n      const renderButtons = ()=>{\n            if(ready){\n                  return <div>{buttons}</div>\n            }else{\n                  return <></>;\n            }\n      }\n    const buttons = names.map(b=>{\n       \n          return   <button key={b} onClick={()=>handleAction(b)} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">{b}</button>\n         \n    });\n    \n    return renderButtons();\n }\n \n export default Buttons;","import { compose, createSlice } from '@reduxjs/toolkit';\nimport io from 'socket.io-client';\nimport superagent from 'superagent';\nimport * as d3 from 'd3-hierarchy';\n\n//import Layer from './Layer';\n\nconst socket = io(window.location.href);\n\n\nexport const experienceSlice = createSlice({\n  name: 'experience',\n  \n  initialState: {\n    layers: [],\n    events: [],\n    readyforinput: {},\n    transcript: \"\",\n    lastsenttranscript:\"\",\n    authored:[],\n    layerName:\"\",\n    listening: {},\n    rendering:false,\n  },\n\n  reducers: {\n    setAuthored : (state, action)=>{\n      state.authored = action.payload;\n    },\n    setLayerName : (state, action)=>{\n      state.layerName = action.payload;\n    },\n    setLayers : (state, action)=>{\n      state.layers = action.payload;\n    },\n    setEvents: (state, action)=>{\n      state.events = action.payload;\n    },\n    setEvent: (state, action) => {\n      state.events = [...state.events.filter(l=>l.id !== action.payload.id), action.payload];\n    },\n    setTranscript: (state, action)=>{\n      const {transcript, layerid} = action.payload;\n      state.transcript = transcript;\n    },\n    setReadyForInput: (state,action)=>{\n      state.readyforinput = {\n        ...state.readyforinput, [action.payload]:true\n      }\n    },\n    setListening: (state, action)=>{\n      const {layerid, listening} = action.payload;\n      state.listening = {\n        ...state.listening,\n        [layerid] : listening\n      }\n    },\n    sentTranscript: (state)=>{\n      state.lastsenttranscript = state.transcript;\n    },\n    resetReadiness: (state)=>{\n     // state.readyforinput = {};\n    },\n    setRendering: (state,action)=>{\n      state.rendering = action.payload;\n    }\n  }\n});\n\nexport const { setRendering, setLayers, setLayerName, setEvent, setListening, setEvents, setTranscript,sentTranscript,setReadyForInput,setAuthored,resetReadiness} = experienceSlice.actions;\n\nexport const reset = (layerid=\"\")=>dispatch=>{\n  superagent.get('/event/start').then(res => {\n    dispatch(setEvents(res.body));\n    dispatch(setTranscript({transcript:\"\", layerid}));\n    dispatch(resetReadiness());\n })\n .catch(err => {\n   console.log(\"error resetting events\", err);\n    // err.message, err.response\n });\n}\n\nconst delay = (ms) =>{\n  return new Promise((resolve, reject)=>{\n    setTimeout(()=>{\n      resolve()\n    }, ms);\n  });\n}\n\n/*const getVoices = () => {\n  return new Promise(resolve => {\n    let voices = speechSynthesis.getVoices()\n    if (voices.length) {\n      resolve(voices)\n      return\n    }\n    speechSynthesis.onvoiceschanged = () => {\n      voices = speechSynthesis.getVoices()\n      resolve(voices)\n    }\n  })\n}\n\nconst sayWords = async (window, words, voice)=>{\n  var msg = new SpeechSynthesisUtterance();\n \n\n  msg.text = words;\n  msg.voice = voice;\n  try{ \n     window.speechSynthesis.speak(msg);\n  }catch(err){\n    console.log(err);\n  }\n  \n  return new Promise(resolve => {\n    msg.onend = resolve;\n  });\n}*/\n\n\n//TODO - get rid - this is to react to browser speech synth, which not using now\n\nexport const listenOnActions = (window) => async dispatch => {\n  //const voices = await getVoices();\n\n  socket.on('action', async actions => {\n\n  \n  for (const payload of actions){\n  \n  \n    /*if (payload.type===\"browserspeech\"){\n      for (const sentence of payload.data.speech){\n        _talking = true;\n       // recognition.stop();\n        await sayWords(window, sentence.words,voices[1]);//51\n        if (sentence.delay){\n          await delay(sentence.delay);\n        }\n      }\n     _talking = false;\n     try{\n     \n      //recognition.start();\n    }catch(err){\n     \n    }\n      //window.speechSynthesis.speak(new SpeechSynthesisUtterance(payload.data.words));\n    }\n   */\n  }\n });\n}\n\nexport const renderSpeech = ()=> async (dispatch, getState)=>{\n  console.log(\"calling out to render\");\n  const name = getState().experience.layerName;\n  dispatch(setRendering(true));\n  await superagent.get(\"/author/render\").query({name});\n  dispatch(setRendering(false));\n}\n\nexport const listenOnEvents = () => (dispatch, getState) => {\n\n\n  socket.on('event', payload => {\n    dispatch(setTranscript({transcript:\"\"}));\n    dispatch(setListening({layerid: payload.id, listening:false}));\n    dispatch(setEvent(payload));\n  });\n\n  socket.on('ready', payload=>{\n    //TODO: get layerid from event!\n    const {event, layer} = payload;\n   \n    dispatch(setTranscript({transcript:\"\"}));\n    dispatch(setReadyForInput(event.id));\n\n    if (event.type===\"speech\"){\n      dispatch(setListening({layerid: layer, listening:true}));\n      console.log(\"layers are now\", getState().experience.listening);\n      //startRecognition();\n    }\n  });\n}\n\nsocket.on(\"connect_error\", () => {\n  const reconnect = ()=>{\n    console.log(\"attempting to reconnect!!\");\n    setTimeout(() => {\n      socket.connect();\n    }, 1000);\n  }\n  reconnect();\n});\n\nexport const buttonPressed  = (b, layerid) => ()=>{\n  //stopListening();\n  superagent.get(\"/event/press\").query({name:b, layer:layerid}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\nexport const manualTrigger = (layer, node)=>()=>{\n  superagent.get(\"/event/trigger\").query({layer,node}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\n//TOD0 - only listen if any of the current events are listening events.\n//on server only subscibe to current events rather than all!!\n\nexport const sendTranscript = () => (dispatch, getState) =>{\n   \n    const {transcript} = getState().experience;\n    const layers = getState().experience.listening\n\n    const sendTranscript = async ()=>{\n      for (const key of Object.keys(layers)){\n        if (layers[key]){    \n          await superagent.get(\"/event/speech\").query({layer:key, speech:getState().experience.transcript})\n          dispatch(sentTranscript());      \n        }\n      }\n      dispatch(setTranscript({transcript:\"\"}));\n    }\n    \n    if (transcript.trim() !== \"\"){\n      sendTranscript();\n    }\n};\n\nexport const gestureObserved = (g,layerid)=> (dispatch, getState) =>{\n  //stopListening();\n  superagent.get(\"/event/gesture\").query({gesture:g}).end((err, res)=>{});\n  //dispatch(setEvent({}));\n}\n\nexport const fetchAuthored = ()=>(dispatch)=>{\n  superagent.get('/author/authored').then(res => {\n    const alist = res.body.layers;\n    dispatch(setAuthored(alist));\n  })\n}\n\n\n\n//this kicks everything off;\n\n//recogniotion cannot know about layer!!\n\nexport const fetchLayers = (layer, r) => (dispatch, getState)=>{\n  \n \n  \n\n  superagent.get('/event/layers').query({layer}).then(res => {\n    const trees = res.body.map(et=>({...et.tree, layerid:et.layerid}));\n    dispatch(setLayerName(layer));\n    dispatch(setLayers(trees));\n  })\n  .catch(err => {\n    console.log(\"error resetting events\", err);\n  });\n}\n\n\nexport const listenToSpeech = () => (dispatch, getState) => {\n  //console.log(\"called listen to speech!\");\n  //startRecognition();\n}\n\n// The function below is called a selector and allows us to select a value from\n// the state. Selectors can also be defined inline where they're used instead of\n// in the slice file. For example: `useSelector((state) => state.counter.value)`\nexport const selectEvents= state => {\n  return  [...(state.experience.events || [])].sort((a,b)=>{\n    if (a.id < b.id) return -1;\n    if (a.id > b.id) return 1;\n    return -1;\n  });\n}\n\n\nexport const selectReadyForInput = state => state.experience.readyforinput;\nexport const selectSpeech= state => state.experience.transcript;\n\n\nexport const selectTrees = state =>  {\n    return state.experience.layers.reduce((acc, item)=>{\n      return {\n          ...acc,\n          [item.layerid] : d3.tree().nodeSize([120, 230])(d3.hierarchy(item, d=>d.children))\n      }\n    },{});\n}\nexport const selectAuthored = state => state.experience.authored;\nexport const selectLayerName = state => state.experience.layerName;\nexport const selectRendering = state => state.experience.rendering;\n\nexport default experienceSlice.reducer;\n","import React, {useState,} from 'react';\nimport { useSelector} from 'react-redux';\n\nimport {\n    selectSpeech,\n} from './experienceSlice';\n\nexport default function Speech({rules, ready, handleAction, handleChange}) {\n \n\n  const [words, setWords] = useState(\"\");\n\n  const _handleChange = (value) =>{\n    handleChange(value);\n    setWords(value);\n  }\n\n  const _handleAction = ()=>{\n    setWords(\"\");\n    handleAction();\n  }\n\n  const renderOperands = ()=>{\n\n    const operands = rules.reduce((acc, item)=>{\n          return [...acc, ...(item.rule.operand || []).map(o=>({\n                operand: o,\n                next: item.next,\n          }))]\n    },[]);\n\n    if (operands.length === 0){\n      return <div className=\"flex flex-col overflow-auto\">\n            <input onChange={(e)=>_handleChange(e.target.value)} value={words} className=\"h-10 pl-2 m-4 rounded\" type=\"text\" placeholder=\"simulate some words\"></input>\n            <button onClick={()=>{_handleAction()}} className=\"bg-blue-500 mr-2 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">say it!</button>\n        </div>\n    }else{\n      return  operands.map(b=>{\n            return   <button key={b.operand} onClick={()=>{ _handleChange(b.operand);_handleAction();}} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 mt-2rounded\">{`${b.operand} (${b.next})`}</button>\n      });\n    }\n}\n\n  const speech = useSelector(selectSpeech);\n\n  return (\n    <div className=\"flex flex-col h-full w-full\">\n      <div style={{height:50}} className=\"flex text-xs font-bold justify-center items-center\">{speech.trim()==\"\" ? \"[listening for speech]\" : `\"${speech}\"`}</div>\n      {ready && <div className=\"p-6 bg-black flex flex-grow flex-col\">\n          <div className=\"font-semibold text-white text-base pb-2\">override</div>\n          {renderOperands()}\n      </div>}\n    </div>  \n  );\n  \n}\n","import Buttons from \"./Buttons\";\nimport Speech from \"./Speech\";\n//import Gesture from \"./Gesture\";\nimport {setTranscript, sendTranscript, buttonPressed} from './experienceSlice';\nimport {useDispatch } from 'react-redux';\n\nfunction Layer(e) {\n    const {id} = e;\n    const dispatch = useDispatch();\n    const renderEvent = (event)=>{\n\n        switch (event.type){\n            case \"button\":\n                return <Buttons \n                            ready={event.ready} \n                            names={event.data} \n                            handleAction={(b)=>{\n                              \n                                dispatch(buttonPressed(b,id));\n                            }}/>\n            case \"speech\":\n                return <Speech  \n                            rules={event.rules} \n                            ready={event.ready} \n                            handleChange={(transcript)=>{\n                               \n                                dispatch(setTranscript({transcript,layerid:id}));\n                            }}\n                            handleAction={()=>{\n                              \n                                dispatch(sendTranscript());\n                            }}/>\n\n           \n\n            default:\n                return JSON.stringify(event,null,4)\n        }\n    }\n\n    return (\n        <div className=\"w-full text-black  bg-gray-600 overflow-hidden shadow-lg flex flex-grow flex-col\" style={{minHeight:280, overflow:\"auto\"}}> \n            <div className=\"flex flex-row text-xs font-semibold p-4 bg-gray-400\">\n                    <div className=\"flex flex-grow\">{`${e.id} (${e.data.type})`} </div>\n                    <div onClick={()=>e.toggleTree(e.id)} className=\"flex\">tree</div>\n            </div> \n            <div className=\"flex justify-center flex-grow\">\n                {renderEvent({...e.data, ready:e.ready||false})}\n            </div>\n        </div>\n    );\n}\n\nexport default Layer;","import {selectLayerName} from './experienceSlice';\nimport { useSelector } from 'react-redux';\n\nconst Navigation = ({ start, authored, toggleCreate, twineExport, renderSpeech, rendering}) => {\n  \n  const layerName = useSelector(selectLayerName);\n\n  const renderAuthored = ()=>{\n    return authored.map(a=>{\n      const textWeight = layerName==a ? \"font-bold\" : \"font-normal\"; \n      return <a key={a} className={`p-2 text-white ${textWeight} text-xs`} style={{opacity:layerName==a?1:0.6}} href={encodeURI(`?layers=${a}`)}>{a}</a>\n    })\n  }\n    return <nav className=\"flex items-center flex-wrap bg-teal-500 p-1\">\n      <div className=\"flex items-center text-white\">   \n        <svg width=\"66\" height=\"42\" viewBox=\"0 0 33 21\" style={{fillRule:\"evenodd\",clipRule:\"evenodd\",strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeMiterlimit:\"1.5\"}}>\n          <path d=\"M1.425,11.233c1.484,-2.368 3.867,-5.752 8.591,-8.263c4.267,-2.268 9.378,-2.597 10.538,-2.634c11.581,-0.375 11.745,9.075 11.758,9.983c0.149,2.891 -0.988,5.991 -2.709,6.365c-2.557,0.556 -5.645,0.675 -8.484,0.823c-0,-0 -0.485,-2.705 -3.147,-2.523c-3.078,0.211 -3.057,2.749 -3.057,2.749l-5.478,0.034c-3.169,-0.217 -6.251,-0.923 -9.112,-2.878c0.099,-1.076 0.424,-2.577 1.1,-3.656Z\"  style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M18.03,16.213c1.187,0 2.15,0.921 2.15,2.056c0,1.135 -0.963,2.056 -2.15,2.056c-1.187,0 -2.151,-0.921 -2.151,-2.056c-0,-1.135 0.964,-2.056 2.151,-2.056Zm-0,1.273c0.452,-0 0.819,0.351 0.819,0.783c0,0.433 -0.367,0.784 -0.819,0.784c-0.453,-0 -0.82,-0.351 -0.82,-0.784c-0,-0.432 0.367,-0.783 0.82,-0.783Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n          <path d=\"M3.191,11.01c-0,0 5.163,-9.036 17.356,-9.416c10.119,-0.316 10.542,8.541 10.542,8.541c-0.983,0.081 -1.454,0.569 -1.498,0.911c-0.093,0.724 0.607,1.131 1.224,1.14c-0.301,1.964 -0.921,2.796 -2.169,3.24c-1.608,0.572 -6.789,0.413 -6.789,0.413c-0,-0 -0.524,-2.554 -3.759,-2.522c-2.696,0.027 -3.614,2.85 -3.614,2.85c-4.652,0.473 -8.768,-0.024 -12.101,-1.954c0.019,-0.386 0.149,-0.733 0.372,-1.045c-0,-0 1.62,-0.073 1.658,-1.111c0.035,-0.959 -1.222,-1.047 -1.222,-1.047Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M21.831,5.29c0.027,-0.872 0.996,-1.574 2.185,-1.574c1.207,0 2.186,0.723 2.186,1.612c0,0.051 -0.003,0.101 -0.009,0.151l0.297,7.926l-4.358,0.089l-0.317,-8.204l0.016,0Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.68}}/>\n          <ellipse cx=\"24.137\" cy=\"6.687\" rx=\"1.042\" ry=\"1.013\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.54}}/>\n          <path d=\"M17.87,5.83c-0.004,-0.204 -0.147,-0.367 -0.319,-0.363c-1.828,-0.053 -3.673,-0.044 -5.557,0.109c-0.172,0.003 -0.309,0.171 -0.305,0.375c0.092,0.837 0.1,1.693 0.051,2.564c0.004,0.203 0.147,0.366 0.319,0.363c1.87,-0.146 3.715,-0.137 5.557,-0.11c0.172,-0.003 0.308,-0.171 0.304,-0.375c-0.045,-0.854 -0.062,-1.709 -0.05,-2.563Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n        </svg>\n      </div>\n     <div>\n      <span className=\"font-semibold text-xl tracking-tight pl-4 text-white\">\n        Future Mundane\n      </span>\n    </div>\n    \n    <div className=\"w-full block flex-grow lg:flex lg:items-center lg:w-auto pl-10\">\n      <div className=\"text-sm lg: flex-grow\">\n        {layerName.trim() != \"\" && <a onClick={start} className=\"block mt-4 lg:inline-block lg:mt-0 text-white  hover:font-bold mr-4\">Start</a>}\n        {layerName.trim() != \"\" && <a target=\"_blank\" href={encodeURI(`/author?layers=${layerName}`)} className=\"block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4\">Edit</a>}\n      </div>\n    </div>\n    <div className=\"flex flex-col\">\n      <div className=\"flex flex-row\">\n        {renderAuthored()}\n      </div>\n      <div className=\"flex flex-row justify-end\">\n        <a className=\"p-2 text-xs font-bold text-white\" onClick={toggleCreate}>upload</a> \n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={twineExport}>export (twine)</a>} \n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={renderSpeech}>{`${!rendering ? \"render speech\": \"[rendering...]\"}`}</a>}\n      </div>\n    </div>\n  </nav>\n};\n\nexport default Navigation;\n","import * as React from \"react\";\nimport * as d3 from \"d3\";\nimport * as d3z from \"d3-zoom\";\nimport {useD3} from '../../hooks/useD3';\n\n\nlet _seen = {};\n\nconst _flatten = list => list.reduce(\n    (a, b) => a.concat(Array.isArray(b) ? _flatten(b) : b), []\n);\n\n\nconst links = (node)=>{\n   \n    return _flatten([\n      {    \n        links: node.data.links,\n        trigger: node.data.trigger,\n        from : {\n          name:node.data.id,\n          x: _seen[node.data.id].x,\n          y: _seen[node.data.id].y + 60\n        },\n        to : (node.children||[]).map(c=>({trigger:c.data.trigger, name:c.data.id,x:_seen[c.data.id].x, y:_seen[c.data.id].y-60}))\n      },\n      ...(node.children || []).map(c=>links(c))\n    ])\n  }\n\n  const rids = (node)=>{\n        const root = Object.keys(node.data.links || {}).reduce((acc, key)=>{\n            const item = node.data.links[key];\n            return {\n                ...acc,\n                [item.rid]: item\n            }\n        },{})\n  \n        return {\n            ...root,\n            ...(node.children || []).reduce((acc, item)=>{\n                return {\n                    ...acc,\n                    ...rids(item)\n                }\n            },{})\n        }\n  }\n\nconst linkdata = (node)=>{\n    return {...(node.data.links || {}), ...(node.children || []).reduce((acc,item)=>{\n        return {\n            ...acc,\n            ...linkdata(item),\n        }\n    },{})}\n}\n\nconst _clink = (sx, sy, tx, ty) => {\n    return <path d={`M ${sx} ${sy} C ${(sx + tx) / 2} ${sy}, ${(sx + tx) / 2} ${ty}, ${tx} ${ty}`} style={{stroke:\"#000\", strokeWidth:\"2\", fill:\"none\"}}></path> \n}\n\nconst _loopback = (sx, sy, tx, ty) =>{\n    //(link.from.y + (l.y-link.from.y)/2)\n    \n    return <path d={`M ${sx} ${sy} C ${(sx)} ${sy+60}, ${(sx-120) } ${ty+60}, ${tx} ${ty}`} style={{stroke:\"#444\", strokeWidth:\"1\", fill:\"none\"}}></path> \n}\n\nconst isloopback = (l)=>{\n    \n    const result = l.from.y > l.to.y;\n    return result;\n  }\n  \n\nconst findNode = (t, name)=>{\n\n    if ((t.data || {}).name == name){\n        return t;\n    }\n\n    if ((t.children || []).length <= 0){\n        return null;\n    }\n    \n    //search children\n\n    let node = null;\n    for (let i = 0; i < t.children.length; i++){\n        node = findNode(t.children[i], name);\n        if (node != null){\n            break;\n        }\n    }\n    return node;\n}\n\nconst recenter = (gtree,t)=>{\n    const g = d3.select(gtree.current);\n    const {x,y} = _seen[t.id] || {x:0, y:0};\n    let mx = 0, my=0;\n    const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n    if (moustrans){\n        [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n    }\n    g.attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n}\n\n\nfunction Tree(t) {\n  \n      \n    const gtree = React.useRef();\n    \n    const moveChart = ()=>{\n        const g = d3.select(gtree.current);\n        let {x,y} = _seen[t.id] || {x:0,y:0};\n        let mx = 0, my=0;\n        const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n        if (moustrans){\n            [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n        }\n        g.transition().duration(2000).attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n    }\n\n    \n    React.useEffect(() => {\n        moveChart();\n    }, [t]);\n    \n    const mytree = useD3((svg) => {\n        \n       const dgbox = svg.select(\"g#dragbox\");\n       \n         svg.call(d3z.zoom().on(\"zoom\",  (e)=>{\n            const {x,y} = e.transform;\n            dgbox.attr(\"transform\", `translate(${x},${y})`)\n        }))\n        //svg.call(d3z.zoom, d3z.zoomIdentity.scale(0.8).translate([x,y]))\n\n    }, []);\n\n    const renderLinks = (links, data)=>{\n        const seenlinks = {};\n   \n\n        return links.map((link)=>{\n          \n            return link.to.map((l)=>{\n           \n           \n                if (seenlinks[`${link.from.name},${l.name}`]){\n                    return <g></g>\n                }else{    \n                    seenlinks[`${link.from.name},${l.name}`]= true;\n                //const labeldata = data[`${link.from.name}->${l.name}`] || [];\n                const tx = (l.x-link.from.x)/2;\n                const ty = (Math.max(l.y,link.from.y)-Math.min(l.y,link.from.y))/2;\n                const anchor = \"middle\";//tx == 0 ? \"middle\" : tx < 0 ? \"end\": \"start\";\n                \n            \n                const labeldata = data[l.trigger];\n\n                \n                const mx = 20 + (labeldata.actions.length - 1) * 20;\n\n               \n                const label = labeldata.actions.map((ld,i)=>{\n                    \n                    return <text key={ld.map(a=>a.action).join(\",\")} fontSize=\"x-small\" textAnchor={\"middle\"} x={l.y+60} y={l.x-mx + (i*18)} > {[...new Set(ld.map(l=>l.action))].join(',')}</text>\n                });\n\n                const {rule={}} = labeldata;\n                const operator = rule.operator || \"\";\n                const operand =  rule.operand || [];\n                const rulelabel = `${operator}, ${operand}`;\n                const renderText = ()=>{\n                    if (isloopback({from:link.from, to:l})){\n                       return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"#000\" opacity=\"0.5\" textAnchor={anchor} y={link.from.x+tx-5+70} x={(link.from.y + (l.y-link.from.y)/2)}>{rulelabel}</text>\n                    }\n                   return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"black\" textAnchor={anchor} y={link.from.x+tx-5} x={(link.from.y+ty)}>{rulelabel}</text>\n                }\n\n                const ruletext =    <g>\n                                        <rect x={link.from.y-20+ty} y={link.from.x-13+tx} width={40} height={12} style={{fill: \"#edf2f7\"}}/>\n                                       {renderText()}\n                                    </g>\n\n\n                return <g key={`${l.x},${l.y}`}>\n                            {isloopback({from:link.from, to:l}) ? _loopback(link.from.y, link.from.x, l.y, l.x) : _clink(link.from.y, link.from.x, l.y, l.x)}\n                            {ruletext}\n                            {label}\n                            \n                       </g>\n                }\n\n            });\n           //return link.to.map((l)=><path d={_clink(link.from.x, link.from.y,l.x, l.y)} stroke=\"#D1D1D1\" fill=\"none\"/>);\n        });\n    }\n\n    const renderTree = (node,selected,rid, handleClick)=>{\n       \n\n        let paint = false;\n       \n        if (_seen[node.data.id].x !== node.x || _seen[node.data.id].y != node.y){\n            return;\n        }\n        \n        if (!rid){\n            paint = selected==node.data.id;// && node.children && node.children.length > 0;\n        }else{\n            paint = selected===node.data.id;// && node.data.trigger == rid;\n        }\n\n        return <g key={`${node.x},${node.y}`}> \n                \n                    <rect onClick={()=>handleClick(node.data.id)} x={node.y-60} y={node.x-10} width={120} height={20} rx={10} style={{fill: paint ? \"#4299e1\":\"white\", stroke:\"black\"}}/>\n                    <text onClick={()=>handleClick(node.data.id)} textAnchor=\"middle\" fontSize=\"x-small\"  x={node.y} y={node.x+4}>{node.data.name}</text>\n                    {(node.children || []).map(n=>renderTree(n, selected, rid,handleClick))}\n            </g>\n\n        \n    }\n\n    _seen = {};\n\n    const generatecoords = (node)=>{\n        if (!_seen[node.data.id]){\n            _seen[node.data.id] = {x:node.x, y:node.y};\n            (node.children || []).map(n=>generatecoords(n))\n        }\n    }\n\n    generatecoords(t);\n\n    return <div className=\"text-black bg-gray-200 rounded bg-white overflow-hidden shadow-lg\"> \n        <svg ref={mytree} height={t.height} style={{width:`calc(100vw - 280px)`}}>\n            <circle onClick={()=>{recenter(gtree,t)}} cx={50} cy={50} r=\"10\" fill=\"white\" strokeWidth={2} stroke=\"#000\"></circle>\n            <g ref ={gtree} transform={`translate(120,${t.height/2})`}>\n                <g id=\"dragbox\"> \n                    {renderLinks(links(t), rids(t))}\n                    {renderTree(t, t.id, t.triggered, t.handleClick)}\n                </g>\n            </g>   \n        </svg>\n    </div>\n }\n \n export default Tree;","import React from 'react';\nimport * as d3 from 'd3';\n\nexport const useD3 = (d3Fn, dependencies) => {\n    const ref = React.useRef();\n\n    React.useEffect(() => {\n        d3Fn(d3.select(ref.current));\n        return () => {};\n      }, dependencies);\n    return ref;\n}","import { useState, useEffect } from 'react';\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height\n  };\n}\n\nexport default function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return windowDimensions;\n}\n","import {useState} from 'react';\nimport {useDispatch } from 'react-redux';\nimport {fetchAuthored} from './experienceSlice';\n\nexport function Importer({save, cancel}){\n    const dispatch = useDispatch();\n    const [json, setJSON] = useState({});\n    const [error, setError] = useState(\"\");\n    const [name, setName] = useState(\"\");\n    const [selectedFile, setSelectedFile] = useState();\n\n    const changeHandler = (event) => {\n\t\tsetSelectedFile(event.target.files[0]);\n\t};\n\n\tconst handleSubmission = () => {\n        const fileReader = new FileReader();\n        fileReader.readAsText(selectedFile, \"UTF-8\");\n        fileReader.onload = e => {\n            try{\n                setJSON(JSON.parse(e.target.result))\n            }catch(err){\n\n            }\n        };\n\t};\n\n    const importIt = async ()=>{\n        try {\n            \n            setError(\"\");\n            if (name.trim()==\"\"){\n                setError(\"Please provide a name for this file\");\n                return;\n            }\n            await save(name,json);\n            dispatch(fetchAuthored());\n        }catch(err){\n            setError(\"Error with JSON file, please correct and try again\")\n        }\n    }\n\n    const renderError = ()=>{\n        return <div className=\"text-red-600 p-4 text-bold justify-center\">{error}</div>\n    }\n    const renderUpload = ()=>{\n        return <div className=\"flex flex-row p-4 items-center\">\n            <input type=\"file\" name=\"file\" onChange={changeHandler} />\n            {selectedFile &&  <div onClick={handleSubmission} className=\"m-2 p-2 bg-blue-500 text-white\">upload</div>}\n            <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n        </div>\n    }\n    \n    const renderName = ()=>{\n        return   <div className=\"flex flex-col text-center p-4 items-center justify-center\">\n                    <input value={name} onChange={(e)=>setName(e.target.value)} type=\"text\" placeholder=\"give it a name\" className=\"w-64 p-2 bg-gray-400\"></input>\n                    <div className=\"flex flex-row justify-center items-center\">\n                        <div onClick={importIt} className=\"m-2 p-2 bg-blue-500 text-white\">IMPORT!</div>\n                        <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n                    </div>\n                </div>\n    }\n\n    return <div className=\"relative flex justify-end\">\n        <div className=\"text-center shadow-lg flex flex-col\">\n            {Object.keys(json).length > 0 && renderName()}\n            {Object.keys(json).length <= 0 && renderUpload()}\n            {error && renderError()}\n        </div>\n        \n    </div>\n}","import React, {useEffect, useState} from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Layer from './Layer';\nimport Navigation from './Navigation';\nimport Tree from './Tree';\nimport useWindowDimensions from '../../hooks/useWindowDimensions';\nimport { Importer } from './Importer';\nimport request from 'superagent';\nimport superagent from 'superagent';\n\nimport {\n    listenOnEvents,\n    listenOnActions,\n    fetchLayers,\n    selectEvents,\n    selectAuthored,\n    selectReadyForInput,\n    selectLayerName,\n    selectRendering,\n    selectTrees,\n    reset,\n    fetchAuthored,\n    manualTrigger,\n    renderSpeech,\n} from './experienceSlice';\n\nexport function Experience() {\n  const events = useSelector(selectEvents);\n  const readyforinput = useSelector(selectReadyForInput);\n  const trees = useSelector(selectTrees);\n  const authored = useSelector(selectAuthored);\n  const layerName = useSelector(selectLayerName);\n  const rendering = useSelector(selectRendering);\n  const [visibleTrees, setVisibleTrees] = useState({});\n  const [create, setCreate] = useState(false);\n\n  const { height } = useWindowDimensions();\n\n  const dispatch = useDispatch();\n\n\n  const proxyRecognition = ()=>{\n    return {\n       start : ()=>{}\n    }\n  }\n\n  \n  const toggleCreate = (value)=>{\n    if (value != undefined){\n      setCreate(value);\n    }else{\n      setCreate(!create);\n    }\n  }\n\n\n  const [startLabel, setStartLabel] = useState(\"start\");\n  \n  //const _fetchLayers = (layer)=>{\n  //  dispatch(fetchLayers(layer, recognition));\n //}\n\n  useEffect(() => {\n    const BrowserSpeechRecognition =\n    typeof window !== 'undefined' &&\n    (window.SpeechRecognition ||\n      window.webkitSpeechRecognition ||\n      window.mozSpeechRecognition ||\n      window.msSpeechRecognition ||\n      window.oSpeechRecognition)\n    const recognition = BrowserSpeechRecognition ? new BrowserSpeechRecognition() : proxyRecognition();\n    recognition.continous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n\n    dispatch(fetchAuthored());\n    dispatch(listenOnEvents());\n    dispatch(listenOnActions(window));\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const params = Object.fromEntries(urlSearchParams.entries());\n    const {layers=null} = params;\n    if (layers){\n      dispatch(fetchLayers(layers, recognition))\n    }\n  }, []); //only re-run the effect if new message comes in\n\n  const toggleTree = (id)=>{\n    setVisibleTrees({...visibleTrees, [id]:!(visibleTrees[id]||false)})\n  }\n\n  const handleClick = (layer, node)=>{\n    dispatch(manualTrigger(layer,node));\n  }\n \n\n  const expandedtrees = Object.keys(visibleTrees).reduce((acc,key)=>{\n    if (visibleTrees[key]== true)\n      return acc + 1;\n    return acc;\n  },0)\n\n  const minimised = events.length - expandedtrees;  \n  const th = ((height - 54 - (minimised > 0 ? 280 :0)) / expandedtrees) - events.length*4;\n\n  const list = events.sort((e1, e2)=>{\n      if (visibleTrees[e1.id] && !visibleTrees[e2.id])\n        return -1;\n      if (visibleTrees[e2.id] && !visibleTrees[e1.id])\n        return 1;\n      return 0;\n\n  }).map((e,i)=>{\n  \n  return  <div key = {e.id} className=\"flex flex-row m-1\">\n            <div  className=\"flex w-64 justify-center overflow-visible\" style={{height:visibleTrees[e.id] ? th-2: 280}}>\n              <Layer {...{...e, ready:readyforinput[e.data.id]||false, toggleTree}} />\n            </div>\n           { visibleTrees[e.id]  && <Tree {...{...trees[e.id], handleClick:(node)=>{handleClick(e.id, node)}, height:th, id:e.data.id, triggered:e.triggered}}/>}\n         </div>  \n  });\n\n  //const forest = trees.map((t,i)=><Tree key={i} {...t}/>);\n\n  const resetExperience = ()=>{\n     dispatch(reset());\n     setStartLabel(\"reset\");\n  }\n  const save = async (name, json)=>{\n    await request.post('/author/save').set('Content-Type', 'application/json').send({name,layer:json});\n    toggleCreate(false);\n  }\n\n  const exportTwine = ()=>{\n    superagent.get('/author/translate').query({name:layerName}).then(res => {\n      const {html} = res.body;\n      const htmlString = `data:text/html;chatset=utf-8,${encodeURIComponent(html)}`;\n      const link = document.createElement(\"a\");\n      link.href = htmlString;\n      link.download = `${layerName}.html`;\n      link.click();\n   })\n  }\n\n  const _renderSpeech = ()=>{\n    dispatch(renderSpeech());\n  }\n\n  return (\n      <div>\n        <Navigation rendering={rendering} authored={authored} start={resetExperience} toggleCreate={toggleCreate} twineExport={exportTwine} renderSpeech={_renderSpeech}/>\n        <div className=\"flex row mb-4 border-b-2 flex-wrap\" >\n        {list}\n       \n        </div>\n       \n        {create && <Importer save={(name,json)=>save(name,json)} cancel={()=>toggleCreate(false)}/>}\n      </div>\n  );\n  \n}\n","import React from 'react';\r\nimport {Experience} from './features/experience/Experience';\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <Experience/>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { configureStore } from '@reduxjs/toolkit';\r\nimport experienceReducer from '../features/experience/experienceSlice';\r\n\r\nexport default configureStore({\r\n  reducer: {\r\n    experience: experienceReducer,\r\n  },\r\n});\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './assets/main.css'\r\nimport App from './App';\r\nimport store from './app/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}