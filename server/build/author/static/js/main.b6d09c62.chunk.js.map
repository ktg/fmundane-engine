{"version":3,"sources":["features/creator/creatorSlice.js","features/layer/layerSlice.js","features/creator/LinkCreator.js","features/creator/Speech.js","features/creator/Action.js","features/creator/Actions.js","features/creator/index.js","features/creator/Creator.js","features/creator/ActionCreator.js","hooks/useD3.js","features/layer/Tree.js","features/layer/index.js","features/layer/Layer.js","App.js","reportWebVitals.js","app/store.js","index.js"],"names":["creatorSlice","createSlice","name","initialState","selectedNode","selectedLink","viewAdd","rule","onstart","actions","type","reducers","setEditNode","state","action","payload","setEditLink","setViewAddNode","setName","setRule","setOnstart","setActions","setType","showAddNode","value","dispatch","getState","linkToEdit","creator","selectViewAdd","selectName","selectRule","selectOnstart","selectActions","selectType","_nodesById","createLut","nbi","Object","keys","reduce","acc","key","index","item","id","event","rules","i","next","trim","op","operand","templateLayer","parent","child","lut","nodesById","nodes","layerSlice","layers","authored","layerid","addNode","setLayer","addLayer","existing","indexOf","uniqueLayerName","createLink","a","from","to","_from","_actions","split","map","line","Date","now","loadNodes","reverse","layer","updateLink","updateNode","node","subscription","console","log","replace","root","n","setChild","setParent","setAuthored","setLookup","generateLookuptable","updateParent","addRulesToParent","selectNodeIds","selectNodes","selectParent","selectChild","selectTree","selectAuthored","selectLayers","sort","selectLayerId","LinkCreator","onClose","useDispatch","useSelector","useState","linknode","setLinkNode","selectLinkNode","e","target","className","items","onChange","renderLinkTo","placeholder","ruleChanged","actionChanged","onClick","_validatelines","lines","l","rate","Speech","_lines","speechChanged","voices","length","setLines","_testSpeech","request","post","set","send","_testLine","renderSelect","r","options","v","voice","setVoice","style","width","minWidth","words","text","setText","delay","ms","err","setDuration","wpm","setRate","background","setBackground","deleteLine","_validateactions","params","JSON","parse","Action","stringify","_testActions","_testAction","setAction","setDelay","setParams","deleteAction","Actions","_actionChanged","actionlist","Creator","tab","setTab","speechTab","setSpeechTab","parenttype","setNode","createNode","_node","arr","_value","unique","addToParent","reset","speech","typeChanged","_updateNode","renderRule","info","nameChanged","ActionCreator","link","setRules","useD3","d3Fn","dependencies","ref","React","useRef","useEffect","d3","current","sw","sh","SLIDEWIDTH","LINKDELTA","ANIMATION_DURATION","_flatten","list","b","concat","Array","isArray","_clink","sx","sy","tx","ty","_loopback","_seen","_loops","insert","lookup","children","c","_printableactions","Set","links","data","x","y","Tree","lookuptable","toggleAddNew","closeEditAction","setParentToAddTo","setLookuptable","addNew","editNode","editLink","editRules","childSelected","nodeSelected","linkSelected","d","filtered","filter","svgref","svg","dgbox","select","call","d3z","on","attr","transform","allchildren","_empty","treeref","jsontree","convertToHierarchy","hier","d3h","_lookup","tree","nodeSize","descendants","_links","_to","t","currentlinks","x1","y1","x2","y2","eligible","isloopback","parentfor","obj","nodestoignore","each","push","allexcept","selectAll","join","enter","append","update","transition","duration","exit","remove","attrTween","l1","last","previous","interpolatePath","_parentSelected","TARGETBIGR","TARGETSMALLR","height","stopPropagation","Layer","_layers","_exportNodes","towrite","_lut","k","default","exportNodes","toggleSaveDialog","saveDialog","currentLayer","setCurrentLayer","get","then","res","alist","body","urlSearchParams","URLSearchParams","window","location","search","fromEntries","entries","query","events","catch","href","encodeURI","_items","selected","renderLayerSelection","renderTree","App","zIndex","maxHeight","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","configureStore","reducer","creatorReducer","layerReducer","ReactDOM","render","StrictMode","store","document","getElementById"],"mappings":"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","file":"static/js/main.b6d09c62.chunk.js","sourcesContent":["import {  createSlice } from '@reduxjs/toolkit';\n\nexport const creatorSlice = createSlice({\n  name: 'creator',\n  \n  initialState: {\n    selectedNode: null,\n    selectedLink: null,\n    viewAdd: false,\n    name: \"\",\n    rule: \"\",\n    onstart : {},\n    actions:\"\",\n    type:\"button\",\n  },\n\n  reducers: {\n    setEditNode : (state, action)=>{\n      const {name,rule, onstart, actions, type} = action.payload;\n      state.selectedNode = name;\n      state.name = name;\n      state.rule = rule;\n      state.onstart = onstart;\n      state.actions = actions;\n      state.type = type;\n    },\n    setEditLink: (state, action)=>{\n      state.selectedLink = action.payload;\n    },\n    setViewAddNode : (state, action)=>{\n      state.viewAdd = action.payload;\n    },\n    setName : (state, action)=>{\n      state.name = action.payload;\n    },\n    setRule : (state, action)=>{\n      state.rule = action.payload;\n    },\n    setOnstart: (state, action)=>{\n      state.onstart = action.payload;\n    },\n    setActions: (state, action)=>{\n      state.actions = action.payload;\n    },\n    setType: (state, action)=>{\n      state.type = action.payload;\n    }\n  }\n});\n\nexport const { setEditNode,setViewAddNode,setName,setRule, setOnstart,setActions,setEditLink,setType } = creatorSlice.actions;\n\nexport const showAddNode = (value)=>{\n  return (dispatch, getState)=>{\n      dispatch(setViewAddNode(value))\n  }\n}\n\nexport const editNode = (node)=>{\n  return (dispatch, getState)=>{\n      dispatch(setEditNode(node));\n      dispatch(showAddNode(true));\n  };\n}\n\nexport const nodeToEdit         = state => state.creator.selectedNode;\nexport const linkToEdit         = state => state.creator.selectedLink;\nexport const selectViewAdd      = state => state.creator.viewAdd;\nexport const selectName         = state => state.creator.name;\nexport const selectRule         = state => state.creator.rule;\nexport const selectOnstart      = state => state.creator.onstart;\nexport const selectActions      = state => state.creator.actions;\nexport const selectType         = state => state.creator.type;\n\nexport default creatorSlice.reducer;\n","import { createSlice } from '@reduxjs/toolkit';\nimport {showAddNode} from '../creator/creatorSlice';\nimport request from 'superagent';\n\nconst _nodesById = {\n      \"e1\" : {\n        \"name\": \"e1\",\n        \"id\": \"e1\",\n        \"onstart\": {\"speech\":[\n            {\n                \"words\": \"something to say\",\n                \"delay\": 1000,\n                \"voice\":\"Daniel\",\n                \"background\":\"\",\n\n            },\n            {\n                \"words\": \"and something after a second.\",\n                \"voice\":\"Daniel\",\n                \"background\":\"\",\n            }\n        ]},\n        \"type\": \"button\",\n        \"subscription\": \"/press\",\n    }\n} \n\nconst createLut = (nbi)=>{\n    return Object.keys(nbi).reduce((acc, key, index)=>{\n        \n        const item = nbi[key];\n\n        if (index == 0){\n            acc[\"root\"] = {id:item.id, event:item.id}\n        }\n        return {\n            ...acc,\n            [item.id] : (item.rules || []).reduce((acc, item, i)=>{\n                if (item.next && item.next.trim() != \"\"){\n                    return [...acc, {id:`${item.next}_${index}_${i}`, event: item.next || \"\", op:item.rule.operand, actions:item.actions} ]\n                }\n                return acc;\n            },[])\n        }\n    },{});\n}\n\nconst templateLayer = ()=>{\n    return {\n        parent: null,\n        child: null,\n        lut : createLut(_nodesById),\n        nodesById :  _nodesById,\n        nodes: Object.keys(_nodesById),\n    }\n}\n\nconst uniqueLayerName = (existing=[])=>{\n  let index = 0;\n  while (existing.indexOf(`layer${++index}`) != -1){}\n  return `layer${index}`;\n}\n\nexport const layerSlice = createSlice({\n  name: 'layer',\n  \n  initialState: {\n      layers:{\n        \"layer1\": templateLayer()\n      },\n      authored:[],\n      layerid: \"layer1\"\n  },\n\n  reducers: {\n\n    addNode : (state, action)=>{\n  \n\n      state.layers[state.layerid].nodes = [...state.layers[state.layerid].nodes, action.payload.id]\n      state.layers[state.layerid].nodesById = {\n          ...state.layers[state.layerid].nodesById,\n          [action.payload.id] : action.payload,\n      }\n     \n    },\n\n    setLayer : (state, action)=>{\n        state.layerid = action.payload;  \n    },\n\n    addLayer : (state, action)=>{\n        state.layers = {\n            ...state.layers,\n            [uniqueLayerName(Object.keys(state.layers))] : templateLayer()\n        }\n    },\n\n    createLink: (state, action)=>{\n\n        const {rule, actions:a, from, to} = action.payload;\n        \n        \n        \n        const _from = from.id;\n      \n\n        const _actions =  (a||\"\").split(\"|\").map((line)=>{\n            return line.split(\",\");\n        });\n\n     \n     \n\n        state.layers[state.layerid].lut = {\n            ...state.layers[state.layerid].lut, \n            [_from] : [...(state.layers[state.layerid].lut[_from]||[]), {id: `${to}_${Date.now()}`, event:to, op:rule, actions:_actions}]\n        }\n       \n    },\n\n    loadNodes : (state, action)=>{\n\n        state.layers = {};\n        for (const {nodes, layer} of action.payload.reverse()){\n            state.layers[layer] = state.layers[layer] || {};\n            state.layers[layer].nodes = Object.keys(nodes);\n            state.layers[layer].nodesById = nodes; \n            state.layers[layer].lut = createLut(state.layers[layer].nodesById);   \n            state.layers[layer].parent = null;\n            state.layers[layer].child =null;\n            state.layerid = layer;\n        }\n    },\n\n    updateLink : (state, action)=>{\n      \n        const {from,to,actions,rules} = action.payload; \n        //const _actions =  (actions||\"\").split(\"|\").map((line)=>{\n        //    return line.split(\",\");\n        //});\n        \n        state.layers[state.layerid].lut = Object.keys(state.layers[state.layerid].lut).reduce((acc, key)=>{\n            if (key === from){\n                return {\n                    ...acc,\n                    [key] : state.layers[state.layerid].lut[key].map((item)=>{\n                        if (item.event === to){\n                            return {\n                                ...item,\n                                actions,\n                                op:rules,\n                            }\n                        }\n                        return item;\n                    })\n                }\n            }\n            return {...acc,[key]:state.layers[state.layerid].lut[key]}\n\n        },{});\n    },\n\n    updateNode : (state, action)=>{\n\n        const {node,name,onstart,type,subscription=\"/press\"} = action.payload;\n      \n        \n        console.log(\"in updare node with onstart\", onstart);\n\n\n        //TODO - SORT ROOT NODE - ID THIS IS THE ONE CHANGED!!\n        state.layers[state.layerid].nodesById = Object.keys(state.layers[state.layerid].nodesById).reduce((acc, key)=>{\n         \n            if (key == node){\n                return {\n                    ...acc,\n                    [name] : {\n                        ...state.layers[state.layerid].nodesById[key],\n                        name,\n                        type,\n                        subscription,\n                        id: name.replace(/\\s/g, \"_\"),\n                        onstart,\n                    }\n                }\n            }\n            return {\n                ...acc,\n                [key] : state.layers[state.layerid].nodesById[key]\n            }\n        },{});\n\n        state.layers[state.layerid].nodes = state.layers[state.layerid].nodes.reduce((acc, item)=>{\n            if (item == node){\n                return [...acc, name]\n            }\n            return [...acc, item];\n        },[])\n\n        state.layers[state.layerid].lut = Object.keys(state.layers[state.layerid].lut).reduce((acc,key)=>{\n            if (key === \"root\"){\n                return {\n                    ...acc,\n                    root : {\n                        id : state.layers[state.layerid].lut[\"root\"].id == node ? name : state.layers[state.layerid].lut[\"root\"].id,\n                        event : state.layers[state.layerid].lut[\"root\"].event == node ? name : state.layers[state.layerid].lut[\"root\"].event,\n                    }\n                }\n            }\n            if (key == node){\n                return {\n                    ...acc,\n                    [name] : state.layers[state.layerid].lut[node].map(n=>{\n                            if (n.event === node){\n                                return {\n                                    ...n,\n                                    event: name,\n                                    id: name,\n                                }\n                            }\n                            return n;\n                    })\n                }\n            }\n            return {\n                ...acc,\n                [key] : state.layers[state.layerid].lut[key].map(n=>{\n                    if (n.event === node){\n                        return {\n                            ...n,\n                            event: name,\n                            id: name,\n                        }\n                    }\n                    return n;\n                })\n            }\n        },{});\n    },\n    setChild : (state, action)=>{\n        state.layers[state.layerid].child = action.payload\n    },\n    setParent : (state, action)=>{\n        state.layers[state.layerid].parent = action.payload\n    },\n    setAuthored : (state, action)=>{\n        state.authored = action.payload\n    },\n    setLookup : (state, action)=>{\n        state.layers[state.layerid].lut = action.payload\n    },\n    generateLookuptable : (state)=>{\n        state.layers[state.layerid].lut = createLut(state.layers[state.layerid].nodesById)\n    },\n   \n    updateParent : (state, action)=>{\n      \n        state.layers[state.layerid].lut = Object.keys(state.layers[state.layerid].lut).reduce((acc,key)=>{\n            if (key != state.layers[state.layerid].parent){\n                return {\n                    ...acc,\n                   [key]: state.layers[state.layerid].lut[key]\n                }\n            }\n            else{\n                return {\n                    ...acc,\n                    [key] : [...(state.layers[state.layerid].lut[key] || []), {event: action.payload.next, id: action.payload.next, op:action.payload.op, actions:action.payload.actions}]\n                }\n            }\n        },{});\n\n        state.layers[state.layerid].lut = {\n            ...state.layers[state.layerid].lut,\n            [action.payload.next] : state.layers[state.layerid].lut[action.payload.next] || []\n        }\n    }\n  }\n});\n\n\n\nexport const { addNode, loadNodes, addLayer, setLayer, setParent, setChild, updateParent,setLookup,setAuthored, generateLookuptable,setEditNode,updateNode,updateLink,createLink} = layerSlice.actions;\n\nconst unique = (value=\"\", arr=[])=>{\n  \n    let _value = value;\n    let i = 0;\n    while (arr.indexOf(_value) != -1){\n        _value = `${_value}_${++i}`\n    }\n   \n    return _value;\n}\n\nexport const fetchAuthored = ()=>(dispatch)=>{\n    request.get('/author/authored').then(res => {\n      const alist = res.body.layers;\n \n      dispatch(setAuthored(alist));\n    })\n  }\n\n  export const fetchLayers = (layer) => {\n    \n    return (dispatch)=>{\n\n        request.get('/event/layers').query({layer}).then(res => {\n            //const [layers={}, ...rest] = res.body;\n            \n            const nodes = (res.body || []).map((l,i)=>{\n                const {events=[], layerid} = l;\n                return {nodes:events, layer: layerid || `layer${i}`}\n            })\n\n            dispatch(loadNodes(nodes))\n           \n        })\n        .catch(err => {\n            console.log(\"error resetting events\", err);\n        });\n    }\n  }\n\nexport const setLookuptable = (lut)=>{\n    return (dispatch) => {\n        dispatch(setLookup(lut));\n    }\n}\n\nexport const setParentToAddTo = (parent)=>{\n    return (dispatch) => {\n        dispatch(setParent(parent));\n      \n    }\n}\n\n\n\nexport const  addToParent = (node, rule, actions,)=>{\n    \n\n    return (dispatch, getState)=>{\n        const layerid = getState().layer.layerid;\n        const nodes = getState().layer.layers[layerid].nodes;\n        const name = unique(node.name, nodes);\n        const _node = {...node, type: node.type || \"button\", name:`${name}`, id:`${name.replace(\" \",\"_\")}`};\n        dispatch(addNode(_node));\n        dispatch(addRulesToParent(rule,actions,_node.name));\n\n   \n    }\n\n   \n\n}\n\n\nexport const exportNodes = (name)=>{\n    return async (dispatch, getState)=>{\n\n        const _layers = getState().layer.layers;\n        const towrite = Object.keys(_layers).reduce((acc, layerid)=>{\n            \n            const lut       = _layers[layerid].lut;\n            const nodesById = _layers[layerid].nodesById;\n\n            const _lut = Object.keys(lut).reduce((acc,key)=>{\n                if (key===\"root\")\n                    return acc;\n                return {\n                    ...acc,\n                    [key] : lut[key]\n                }\n            },{});\n\n            const items = Object.keys(_lut).reduce((acc,key)=>{\n                const {type} = nodesById[key];\n    \n                if (type===\"button\"){\n                    return [\n                        ...acc,\n                        {\n                            id: key,\n                            ...nodesById[key],\n                            subscription: \"/press\",\n                            data: _lut[key].map(k=>k.op),\n                            rules : _lut[key].map(k=>{\n                                   return {\n                                     \"rule\": {\n                                        \"operator\": \"equals\",\n                                        \"operand\": k.op\n                                      },\n                                      \"actions\": k.actions,\n                                      \"next\": k.event\n                                    }\n                            })\n                            \n                        }\n                    ]\n                }\n                if (type === \"speech\"){\n                    //NB: operand may be a string if created in this session, or array if read from server\n                    //TODO: - save in array format when speech so is always an array..!\n                    return [\n                        ...acc,\n                        {\n                            id: key,\n                            ...nodesById[key],\n                            subscription: \"/speech\",\n                            rules : _lut[key].map(k=>{\n                                if (k.op){\n                                    return {\n                                         \"rule\": {\n                                            \"operator\": \"contains\",\n                                            \"operand\": Array.isArray(k.op) ? k.op : k.op.split(\",\"),\n                                            \"default\": k.default\n                                        },\n                                        \"actions\":  k.actions,\n                                        \"next\": k.event\n                                    }\n                                }else{\n                                    return {\n                                        \"rule\": {\n                                           \"operator\": \"any\",\n                                           \"default\": true,\n                                       },\n                                       \"actions\": k.actions,\n                                       \"next\": k.event\n                                   }\n                                }\n                            })\n                        }\n                    ]\n                }\n                return acc;\n            },[]);\n            \n\n            return [\n                ...acc,\n                {\n                    \n                    \"id\" : layerid,\n                    \"start\": {\n                        \"actions\": [[]],\n                        \"event\": getState().layer.layers[layerid].nodes[0]\n                    },\n                    \"events\": items\n                }\n            ]\n        },[]);\n\n        console.log(JSON.stringify(towrite,null,4));\n        await request.post('/author/save').set('Content-Type', 'application/json').send({name,layer:towrite});\n    }\n}\n\nexport const addRulesToParent = (op, actions, next)=>{\n\n    return (dispatch, getState)=>{\n        dispatch(updateParent({op, actions, next}));\n        dispatch(showAddNode(false));\n    }\n}\n\n\nexport const selectNodeIds          = state => state.layer.layers[state.layer.layerid].nodes;\nexport const selectNodes            = state => state.layer.layers[state.layer.layerid].nodesById;\nexport const selectParent           = state => state.layer.layers[state.layer.layerid].nodesById[state.layer.layers[state.layer.layerid].parent] ||  {};\nexport const selectChild            = state => state.layer.layers[state.layer.layerid].child;\nexport const selectTree             = state => state.layer.layers[state.layer.layerid].lut;\nexport const selectNodeToEdit       = state => state.layer.layers[state.layer.layerid].node;\nexport const selectAuthored         = state => state.layer.authored;\nexport const selectLayers           = state => Object.keys(state.layer.layers || {}).sort();\nexport const selectLayerId          = state => state.layer.layerid;\n\nexport default layerSlice.reducer;\n","import {useState}  from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\n\n\n\nimport {\n   selectNodeIds,\n   selectParent,\n   createLink\n} from '../layer/layerSlice';\n\n\n//mirror a local copy and only update on button press, which then means that we keep the old identity locally before\n//making the change from,to\nexport function LinkCreator({onClose}) {\n    \n    const dispatch = useDispatch();\n    const nodes     = useSelector(selectNodeIds);\n    const [linknode, setLinkNode] = useState(nodes[0]);\n    const [rule, setRule] = useState(\"\");\n    const [actions, setActions] = useState(\"\");\n    const parent    = useSelector(selectParent);\n\n    const _createLink = ()=>{\n        dispatch(createLink({from:parent, to:linknode, rule, actions}))\n    }\n\n    const ruleChanged = (rule = \"\")=>{\n        setRule(rule);\n        //setNode({...node, rule})\n        //dispatch(setRule(rule));\n    }\n\n    const actionChanged = (actions)=>{\n        setActions(actions);\n        //setNode({...node, actions})\n        //dispatch(setActions(action));\n       \n    }\n\n    const selectLinkNode = (e)=>{\n        setLinkNode(e.target.value)\n    }\n\n\n    const renderActions = ()=>{\n\n\n       return   <div className=\"flex flex-col mt-2 items-start p-4\">\n                    <div className=\"font-bold text-xs flex justify-start\">ACTION</div>\n                    <div className=\"flex flex-col mt-2 items-start\">\n                        <input type=\"text\" placeholder=\"action list\" value={actions} onChange={(e)=>{actionChanged(e.target.value)}}></input>\n                        <label className=\"text-xs mt-1 justify-start\">format: a1,a2,a3|a5,a6 </label>\n                    </div>\n                 </div>\n    }\n\n    const renderRules = ()=>{\n        return <div className=\"flex flex-col mt-2 items-start p-4\">\n                    <div className=\"font-bold text-xs flex justify-start\">RULE</div>\n                    <div className=\"flex flex-col mt-2 items-start\">\n                        <input type=\"text\" placeholder=\"rule list\"  value={rule} onChange={(e)=>{ruleChanged(e.target.value)}}></input>\n                        <label className=\"text-xs mt-1 justify-start\">button name</label>\n                    </div>\n                </div>\n    }\n\n   \n\n    const renderLinkTo = ()=>{\n        \n        const items = nodes.map(n=><option key={n} value={n}>{n}</option>);\n        \n        return <div className=\"flex flex-col mt-2 items-start p-4\">\n            <label>node</label>\n                    <select value={linknode} onChange={selectLinkNode}>\n                    {items}\n                </select>\n                </div>\n    }\n  \n    return <div className=\"flex flex-col\">\n    <div className=\"flex flex-row shadow p-2 mt-4\">\n            <div className=\"flex  flex-col\">\n                {renderLinkTo()}\n            </div>\n            <div className=\"flex  flex-col\">\n                {renderRules()}\n            </div>\n            <div className=\"flex  flex-col \">\n                {renderActions()}\n            </div>\n           \n    </div>\n    <div> <button onClick={()=>{_createLink()}} className=\"p-2 mt-4 bg-blue-500 text-white\">create link</button></div>\n    </div>\n    \n}","import {useState, useEffect}  from 'react';\nimport request from 'superagent';\n\n\nconst _validatelines = (lines)=>{\n    \n    return lines.map(l=> {\n        const rate = (l.rate || \"\").trim()==\"\" ? \"180\" : l.rate;\n        return {\n            ...l, \n            rate\n        }\n    });\n}\n\nexport default function Speech({lines:_lines=[], speechChanged}) {\n    \n    const _localvoices = [\"Kate\", \"Daniel\", \"Oliver\", \"Ava\", \"Alex\", \"Bruce\", \"Junior\", \"Ralph\", \"Tom\", \"Serena\"];\n    const voices = [\"Emily\", \"Daniel\", \"Tom\", \"Fiona\", \"Moira\", \"Bruce\", \"Junior\", \"Karen\", \"Lee\", \"Serena\"];\n\n    //const {speech=[]} = _lines;\n\n    _lines = _lines.length <= 0 ? [{\"words\":\"\", \"delay\":0, \"voice\":\"Daniel\",\"background\":\"\", rate:\"180\"}] : _lines ;\n\n    const [lines, setLines] = useState(_lines);\n\n    const addLine = ()=>{\n        setLines([...lines, {\"words\":\"\", \"delay\":0, \"voice\":\"Daniel\", \"background\":\"\", rate:\"180\"}])\n    }\n\n    const deleteLine = (index)=>{\n         const _lines = lines.reduce((acc,item,i)=>{\n            return i == index ? acc : [...acc, item];\n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n    const setText = (index,text)=>{\n        const _lines = lines.map((item,i)=>{\n            return i==index ? {...item, words:text} : item;\n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n    const setVoice = (index,voice)=>{\n        const _lines = lines.map((item,i)=>{\n            return i==index ? {...item, voice} : item;\n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n\n    const setDuration = (index, ms)=>{\n        const _lines = lines.map((item,i)=>{\n            try{\n                return i==index ? {...item, delay:ms} : item;\n            }catch(err){\n                return item;\n            }\n            \n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n    const setRate = (index, wpm)=>{\n        const _lines = lines.map((item,i)=>{\n            try{\n                return i==index ? {...item, rate:wpm} : item;\n            }catch(err){\n                return item;\n            }\n            \n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n    const setBackground = (index, background)=>{\n        const _lines = lines.map((item,i)=>{\n            try{\n                return i==index ? {...item, background} : item;\n            }catch(err){\n                return item;\n            }\n            \n        },[]);\n        setLines(_lines);\n        speechChanged(_validatelines(_lines));\n    }\n\n    const _testSpeech = async ()=>{\n        await request.post('/author/audiotest').set('Content-Type', 'application/json').send({lines:_validatelines(lines)});\n    }\n\n    const _testLine = async (i)=>{\n        await request.post('/author/audiotest').set('Content-Type', 'application/json').send({lines:_validatelines([lines[i]])});\n    }\n\n    const renderSelect = (r,index)=>{\n        const options =  voices.map(v=><option key={v} value={v}>{v}</option>);\n        return <select key={index} value={r.voice || \"Kate\"} onChange={(e)=>setVoice(index,e.target.value)} style={{width:120}}>{options}</select>\n    }\n\n    const renderLines = ()=>{\n        return lines.map((r,i)=>{\n            return <div key={i} className=\"flex flex-row text-sm items-center justify-start mt-4\">\n                <div className=\"flex flex-col justify-start\">\n                    <input style={{minWidth:300}} className=\"mr-4\" type=\"text\" value={r.words} onChange={(e)=>{setText(i,e.target.value)}}></input>\n                    <label className=\"flex justify-start\">what to say</label>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                    <input type=\"text\" style={{width:80}} value={r.delay} onChange={(e)=>{setDuration(i,e.target.value)}}></input>\n                    <label className=\"flex justify-start\">pause (ms)</label>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                    <div className=\"pl-2\">\n                        <input type=\"text\" style={{width:80}} value={r.rate} onChange={(e)=>{setRate(i,e.target.value)}}></input>\n                        <label className=\"flex justify-start\">words/min</label>\n                    </div>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                   <div className=\"pl-2\">\n                   {renderSelect(r,i)}\n                   <label className=\"flex justify-start\">voice</label>\n                   </div>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                    <div className=\"pl-2\">\n                        <input type=\"text\" style={{width:120}} value={r.background} onChange={(e)=>{setBackground(i,e.target.value)}}></input>\n                        <label className=\"flex justify-start\">sound effect</label>\n                    </div>\n                </div>\n                <div onClick={()=>_testLine(i)} className=\"flex flex-col justify-start pb-4\">\n                   <div className=\"flex items-center justify-center ml-4 mr-4 text-black w-6 h-6\"></div>\n                </div>\n                <div onClick={()=>deleteLine(i)} className=\"flex flex-col justify-start pb-4\">\n                   <div></div>\n                </div>\n                \n            </div>\n        })\n    }\n\n    return  <div>\n                \n                <div className=\"flex  flex-col shadow p-2 mt-4\">\n                    <div onClick={()=>addLine()} className=\"font-bold text-xs flex justify-start\">LINES (+)</div>                    \n                    {renderLines()}\n                    <div className=\"p-8\"> <button onClick={_testSpeech} className=\"rounded-full h-10 w-10 bg-pink-500 text-white\"></button></div>\n                </div>\n            </div>\n}","import {useState, useEffect}  from 'react';\nimport request from 'superagent';\n\n\nconst _validateactions = (actions)=>{\n    \n    return actions.map(a=> {\n       \n        return {\n            ...a, \n            params: JSON.parse(a.params),\n        }\n    });\n}\n\nexport default function Action({action:_actions=[], actionChanged}) {\n    \n    //const {speech=[]} = _lines;\n\n    _actions = _actions.length <= 0 ? [] : _actions.map(a=>({...a, params:a.params? JSON.stringify(a.params):\"{}\"}))\n\n    const [actions, setActions] = useState(_actions);\n\n    const addAction = ()=>{\n        setActions([...actions, {\"action\":\"\", \"delay\":0, \"params\":\"{}\"}])\n    }\n\n    const deleteAction = (index)=>{\n         const _actions = actions.reduce((acc,item,i)=>{\n            return i == index ? acc : [...acc, item];\n        },[]);\n        setActions(_actions);\n        actionChanged(_validateactions(_actions));\n    }\n\n    const setAction = (index,action)=>{\n        const _actions = actions.map((item,i)=>{\n            return i==index ? {...item, action} : item;\n        },[]);\n        setActions(_actions);\n        actionChanged(_validateactions(_actions));\n    }\n\n    const setDelay = (index,delay)=>{\n        const _actions = actions.map((item,i)=>{\n            return i==index ? {...item, delay} : item;\n        },[]);\n        setActions(_actions);\n        actionChanged(_validateactions(_actions));\n    }\n\n\n    const setParams = (index, params)=>{\n        const _actions = actions.map((item,i)=>{\n            try{\n                return i==index ? {...item, params} : item;\n            }catch(err){\n                return item;\n            }\n            \n        },[]);\n        setActions(_actions);\n        actionChanged(_validateactions(_actions));\n    }\n\n    const _testActions = async ()=>{\n        await request.post('/author/actiontest').set('Content-Type', 'application/json').send({actions:_validateactions(actions)});\n    }\n\n    const _testAction = async (i)=>{\n        await request.post('/author/actiontest').set('Content-Type', 'application/json').send({actions:_validateactions([actions[i]])});\n    }\n\n    const renderActions = ()=>{\n        return actions.map((r,i)=>{\n            return <div key={i} className=\"flex flex-row text-sm items-center justify-start mt-1\">\n                <div className=\"flex flex-col justify-start\">\n                    <input style={{width:120}} className=\"mr-4\" type=\"text\" value={r.action} onChange={(e)=>{setAction(i,e.target.value)}}></input>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                    <input type=\"text\" style={{width:80}} value={r.delay} onChange={(e)=>{setDelay(i,e.target.value)}}></input>\n                </div>\n                <div className=\"flex flex-col justify-start\">\n                    <div className=\"pl-2\">\n                        <input type=\"text\" style={{width:400}} value={r.params} onChange={(e)=>{setParams(i,e.target.value)}}></input>\n                    </div>\n                </div>\n                <div onClick={()=>_testAction(i)} className=\"flex flex-col justify-start pb-4\">\n                   <div className=\"flex items-center justify-center ml-4 mr-4 text-black w-6 h-6\"></div>\n                </div>\n                <div onClick={()=>deleteAction(i)} className=\"flex flex-col justify-start pb-4\">\n                   <div></div>\n                </div>\n                \n            </div>\n        })\n    }\n\n    return  <div>\n                \n                <div className=\"flex  flex-col shadow p-2 mt-4\">\n                    <div onClick={()=>addAction()} className=\"font-bold text-xs flex justify-start\">ACTIONS (name,delay,params) (+)</div>                    \n                    {renderActions()}\n                    <div className=\"p-2\"> <button onClick={_testActions} className=\"rounded-full h-6 w-6 text-xs bg-pink-500 text-white\"></button></div>\n                </div>\n            </div>\n}","import Action from './Action';\n\nexport default function Actions({actions=[[]], actionChanged}){\n\n    const _actionChanged = (index, action)=>{\n        actionChanged(actions.reduce((acc, item, i)=>{\n            if (i === index){\n                return [...acc, action];\n            }\n            return [...acc, item]\n        },[]));\n    }\n\n    const actionlist = actions.map((a,i)=>{\n        return <Action key={i} action={a||[]} actionChanged={(a)=>_actionChanged(i,a)}/>\n    })\n    return <div>{actionlist}</div>\n\n\n}","import {Creator} from \"./Creator\"\nexport default Creator;","import {useState}  from 'react';\nimport {LinkCreator} from './LinkCreator';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Speech from './Speech';\nimport Actions from './Actions';\nimport {\n   selectParent,   \n   addToParent,\n   updateNode,\n} from '../layer/layerSlice';\n\n\nimport {\n   setName,\n   setRule,\n   setType,\n   setOnstart,\n   setViewAddNode,\n   setActions, \n   selectName,  \n   selectRule,        \n   selectOnstart,    \n   selectActions,\n   selectType,\n} from './creatorSlice';\n//mirror a local copy and only update on button press, which then means that we keep the old identity locally before\n//making the change from,to\nexport function Creator({onClose}) {\n    const dispatch = useDispatch();\n    const [tab, setTab] = useState(\"new\");\n\n    const [speechTab, setSpeechTab] = useState(true);\n\n    const {id:parent, type:parenttype}    = useSelector(selectParent);\n\n    const name      = useSelector(selectName);\n    const rule      = useSelector(selectRule);\n    const onstart    = useSelector(selectOnstart);\n    const actions   = useSelector(selectActions);\n    const type      = useSelector(selectType);\n\n    console.log(\"onstart is\", onstart);\n\n    const [node, setNode] = useState({name,rule,onstart,actions,type});\n   \n    const createNode = ()=>{\n        \n        const _node = {\n            name: node.name.replace(/\\s/g, \"\"),\n            id: node.name.replace(/\\s/g, \"_\"),\n            onstart: node.onstart,\n            type:node.type,\n            subscription : node.type == \"button\" || node.type.trim()==\"\" ? `/press` : `/${node.type}`,\n        }\n     \n        dispatch(addToParent(_node, node.rule, [[]]));\n        reset();\n    }\n    \n    const speechChanged = (lines)=>{\n        setNode({...node, onstart:{...node.onstart,speech:lines}});\n        dispatch(setOnstart({...node.onstart,speech:lines}));\n    }\n\n    const ruleChanged = (rule = \"\")=>{\n        setNode({...node, rule})\n        //dispatch(setRule(rule));\n    }\n\n    const nameChanged = (name = \"\")=>{\n        setNode({...node, name})\n        //dispatch(setName(name));\n    }\n\n    const actionChanged = (actions)=>{\n        setNode({...node, onstart:{...node.onstart,actions}});\n        dispatch(setOnstart({...node.onstart,actions}));\n    }\n\n    const typeChanged = (type)=>{\n        const subscription = type==\"speech\" ? \"/speech\" : \"/press\";\n        setNode({...node, type, subscription})\n    }\n\n    const _updateNode = ()=>{\n        console.log(\"UPdating node\", {node:name, ...node});\n        dispatch(updateNode({node:name, ...node}));\n        dispatch(setViewAddNode(false))\n        reset();\n    }\n\n    const reset = ()=>{\n        dispatch(setName(\"\"));\n        dispatch(setRule(\"\"));\n        dispatch(setOnstart({}));\n        dispatch(setType(\"\"));\n        setNode({name:\"\",rule:\"\", onstart:{}, actions:\"\", type:\"button\"});\n    }\n\n    const renderSpeech = ()=>{\n        console.log(\"in rendr sppech with\", node);\n        return <div className=\"flex  flex-col shadow p-2 mt-4\">\n                    <div className=\"font-bold text-xs flex justify-start\">SPEECH (when this node starts)</div>\n                    <div className=\"flex flex-col mt-2 items-start\">\n                        <Speech lines={node.onstart.speech} speechChanged={speechChanged}/>\n                    </div>\n                </div>\n    }\n\n    const renderActions = ()=>{\n        return <div><Actions actions={node.onstart.actions} actionChanged={actionChanged}/></div>\n    }\n\n    const renderRule = ()=>{\n        if (!parent){\n            return;\n        }\n        const info = parenttype === \"button\" ? `the name of the button pressed to trigger ${parent}->this node` : `the keyword(s) that are spoken to trigger ${parent}->this node`;\n        return <div className=\"flex flex-col mt-2 items-start\">\n            <label>rule</label>\n            <input type=\"text\" value={node.rule} onChange={(e)=>{ruleChanged(e.target.value)}} className=\"p-1 mt-2\"></input>\n            <label className=\"text-xs mt-1\">{info}</label>\n        </div>\n    }\n    const renderCurrent = ()=> <LinkCreator/>\n\n    const renderNew = ()=>{\n        return <div className=\"flex justify-start flex-col\">\n        <div className=\"flex flex-col mt-2 items-start\">\n            <label>node name</label>\n            <input type=\"text\" value={node.name} onChange={(e)=>{nameChanged(e.target.value)}} className=\"p-1 mt-2\"></input>\n            <label className=\"text-xs mt-1\">a unique name for this node</label>\n        </div>\n        {parent && renderRule()}\n       \n       <div className=\"bg-gray-100 mt-4\">\n            <div className=\"flex items-start flex-col p-4\">\n                <div>on start</div>\n                <div className=\"text-xs text-gray-500\">(the speech and actions that run when this node is triggered)</div>\n            </div>\n           \n                <div className=\"flex flex-row \">\n                    <div onClick={()=>{setSpeechTab(true)}} className={`text-xs font-bold p-4 ${speechTab  ? \"text-blue-500\" : \"text-gray-500\"}`}>speech</div>\n                    <div onClick={()=>{setSpeechTab(false)}} className={`text-xs font-bold p-4 ${!speechTab ? \"text-blue-500\" : \"text-gray-500\"}`}>actions</div>\n                </div>\n                {speechTab && renderSpeech()}\n                {!speechTab && renderActions()}\n      \n        </div>\n        <div className=\"flex flex-row justify-center items-center\">\n            {parent &&  <div> <button onClick={createNode} className=\"p-2 mt-4 bg-blue-500 text-white\">Create node!</button></div>}\n            {!parent &&  <div> <button onClick={_updateNode} className=\"p-2 mt-4 bg-blue-500 text-white\">Update node</button></div>}\n            <div> <button onClick={onClose} className=\"ml-4 p-2 mt-4 bg-blue-500 text-white\">Close</button></div>\n        </div>\n    </div>\n    }\n\n    return  <div className=\"flex flex-col\">\n                <div className=\"flex justify-end items-center text-xl\"><div  onClick={onClose} className=\"flex justify-center items-center  rounded-full  text-xs bg-pink-500 text-white h-6 w-6 shadow\">x</div></div>\n                <div className=\"flex flex-row \">\n                    <div onClick={()=>{setTab(\"new\")}} className={`font-bold p-4 ${tab==\"new\" ? \"text-blue-500\" : \"text-gray-500\"}`}>new node</div>\n                    <div onClick={()=>{setTab(\"current\")}} className={`font-bold p-4 ${tab==\"current\" ? \"text-blue-500\" : \"text-gray-500\"}`}>existing node</div>\n                </div>\n                <div className=\"flex flex-row \">\n                    <div onClick={()=>{typeChanged(\"button\")}} className={`text-xs font-bold p-4 ${node.type==\"button\" ? \"text-blue-500\" : \"text-gray-500\"}`}>button</div>\n                    <div onClick={()=>{typeChanged(\"speech\")}} className={`text-xs font-bold p-4 ${node.type==\"speech\" ? \"text-blue-500\" : \"text-gray-500\"}`}>speech</div>\n                </div>\n                {tab==\"new\" && renderNew()}\n                {tab==\"current\" && renderCurrent()}\n            </div>\n}","import {useState}  from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Actions from './Actions';\n\nimport {\n    linkToEdit,\n    setEditLink,\n} from './creatorSlice';\n\nimport {\n    updateLink\n} from '../layer/layerSlice';\n\nexport function ActionCreator({onClose}) {\n    const dispatch = useDispatch();\n    const link    = useSelector(linkToEdit) || {};\n    const {from={},to={}} = link;\n    \n    const [actions, setActions] = useState(to.actions)\n    const [rules, setRules] = useState(to.op||\"\");\n\n    /*\n      <div className=\"flex flex-col mt-2 items-start\">\n                    <input type=\"text\" placeholder=\"action list\" value={actions} onChange={(e)=>{actionChanged(e.target.value)}}></input>\n                    <label className=\"text-xs mt-1 justify-start\">format: a1,a2,a3|a5,a6 </label>\n                </div>*/\n\n    const actionChanged = (actions)=>{\n        console.log(\"seen action changed!\", actions);\n        setActions(actions);\n    }\n\n    const ruleChanged = (value)=>{\n        setRules(value);\n    }\n    const _updateLink = ()=>{\n        dispatch(updateLink({from:from.name, to:to.name, actions:actions, rules:rules}))\n        dispatch(setEditLink());\n    }\n\n    const renderRules = ()=>{\n           return  <>\n                <div className=\"font-bold text-xs flex justify-start\">rules</div>\n                <div className=\"font-bold text-xs flex justify-start\">{`rules to trigger move from ${from.name} to ${to.name}`}</div>\n                <div className=\"flex flex-col mt-2 items-start\">\n                    <input type=\"text\" placeholder=\"action list\" value={rules} onChange={(e)=>{ruleChanged(e.target.value)}}></input>\n                    <label className=\"text-xs mt-1 justify-start\">format: a,b,c</label>\n                </div>\n            </>\n    }\n\n    const renderActions = ()=>{\n        return <>\n                <div className=\"font-bold text-xs flex justify-start\">actions</div>\n                <div className=\"font-bold text-xs flex justify-start\">{`actions executed on move from ${from.name} to ${to.name}`}</div>\n                <Actions actions={actions} actionChanged={actionChanged}/>\n              \n            </>\n    }\n    return <div className=\"flex flex-col shadow p-2 mt-4\">\n                <div className=\"flex justify-end items-center text-xl\"><div  onClick={onClose} className=\"flex justify-center items-center  rounded-full  text-xs bg-pink-500 text-white h-6 w-6 shadow\">x</div></div>\n                {renderRules()}\n                {renderActions()}\n                <button onClick={_updateLink} className=\"p-2 mt-4 bg-blue-500 text-white\">Update link</button>\n            </div>\n}","import React from 'react';\nimport * as d3 from 'd3';\n\nexport const useD3 = (d3Fn, dependencies) => {\n    const ref = React.useRef();\n\n    React.useEffect(() => {\n        d3Fn(d3.select(ref.current));\n        return () => {};\n      }, dependencies);\n    return ref;\n}","import {useEffect} from 'react';\nimport * as d3h from 'd3-hierarchy';\nimport * as d3z from 'd3-zoom';\nimport { interpolatePath } from 'd3-interpolate-path';\nimport {useD3} from '../../hooks/useD3.js';\n\nconst SLIDEWIDTH  = 192;\nconst WHRATIO = 0.5625;\nconst XPADDING = 18;\nconst YPADDING = 178;\nconst sw = SLIDEWIDTH;\nconst sh = SLIDEWIDTH*WHRATIO;\nconst TARGETBIGR = 8;\nconst TARGETSMALLR = 3;\nconst LINKDELTA = 18;\n\nconst ANIMATION_DURATION = 800;\n\nconst _flatten = list => list.reduce(\n  (a, b) => a.concat(Array.isArray(b) ? _flatten(b) : b), []\n);\n\nconst _clink = (sx, sy, tx, ty) => {\n  return `M ${sx} ${sy} C ${(sx + tx) / 2} ${sy}, ${(sx + tx) / 2} ${ty}, ${tx} ${ty}`;  \n}\n\nconst _loopback = (sx, sy, tx, ty) =>{\n  return `M ${sx} ${sy} C ${(sx + tx)*1.5} ${sy}, ${(sx + tx)*1.5} ${ty}, ${tx} ${ty}`;  \n}\n\nlet _seen   = {};\nlet _loops  = [];\n\nconst insert = (lookup, event, nodes={})=>{\n\n\n    const children = lookup[event.event] || [];\n    \n    //console.log(nodes[event.event].name || \"\").split(\".\");\n    const [name=[\"x\"]] = (nodes[event.event].name || \"\").split(\".\");\n    const {onstart=\"\",type=\"button\"} = nodes[event.event]\n    //if (_seen[event.event]){\n    //  children.map(c=>{\n    //    console.log(\"insert link\", parent.event, \"=>\", event.event);\n    //  })\n     // return {event, onstart, type, name, children:[]};\n   // }\n    _seen[event.event] = true;\n    //if (seen.indexOf(event.event)!=-1){\n    //  return {event, onstart, type, name, children:[]};\n    //}\n    return {event, onstart, type, name, children : children.reduce((acc,c) => {\n      if (!_seen[c.event]){\n        return [...acc,insert(lookup, c, nodes)]\n      }\n      _loops = [..._loops, {from:event, to: c}];\n      return acc;\n    },[])}\n    \n}\n\nconst convertToHierarchy = (lut,nodes={})=>{\n  console.log(\"in convert toi hierarchy!\")\n   _seen = {}; _loops = [];\n    return insert (lut, lut[\"root\"],nodes);\n}\n\nconst _printableactions = (actions)=>{\n  //return actions;\n  return actions.map(a=>[...new Set(a.map(l=>l.action))]);\n}\n\nconst links = (node={})=>{\n \n  if (Object.keys(node).length <= 0){\n    return [];\n  }\n  return  _flatten([\n    {    \n      from : {\n        name:node.data.event.event,\n        x: node.x,\n        y: node.y + sh \n      },\n      to : (node.children||[]).map(c=>{\n      \n        return {name:c.data.event.event,x:c.x, y:c.y+LINKDELTA, op:c.data.event.op, actions: c.data.event.actions}\n      })\n    },\n    ...(node.children || []).map(c=>links(c))\n  ]);\n}\n\nconst _expanded = (arr)=>{\n  //TODO: ffs the tos can be {} or []!  FIX THIS!\n  return arr.reduce((acc,item)=>{\n      const {from={}, to=[]} = item;\n      const _to = Array.isArray(to) ? to : [to];\n      return [...acc,...(_to.map(t=>({from:from, \"to\":t})))]\n  },[]);\n}\n\n\nconst lookuplinks = (lnks)=>{\n  return lnks.reduce((acc, link)=>{\n    return {\n              ...acc,\n              [`${link.from.name}_${link.to.name}`]: {from: link.from.name, to: link.to.name, op:link.to.op, actions:link.to.actions, x1:link.from.x, y1: link.from.y, x2:link.to.x, y2:link.to.y} \n          }\n  },{})\n}\n\n\nexport default function Tree({lookuptable,nodes,parent,child,toggleAddNew,closeEditAction,setParentToAddTo,setLookuptable,addNew,editNode,editLink,editRules,setParent,setChild}) {\n \n  const reset = ()=>{\n      setChild();\n      setParent();\n      toggleAddNew(false);\n      closeEditAction();\n  }\n\n  const childSelected =(e,node)=>{\n    toggleAddNew(false);\n    setChild(node.data.event);\n  }\n\n  const nodeSelected = (e, node)=>{\n    editNode(node.data);\n  }\n\n  const linkSelected = (d, link)=>{\n    editLink(link);\n  }\n\n  const ruleSelected = (d, link)=>{\n    editRules(link);\n  }\n\n  const parentSelected = (e, node)=>{\n   \n    if (!child){\n  \n       toggleAddNew(true)\n    }else{\n        toggleAddNew(false)\n    }\n\n    setParent(node.data.event.event);\n    setParentToAddTo(node.data.event.event);\n  }\n\n  useEffect(()=>{\n      if (!addNew){\n        setParent();\n        setChild();\n      }\n  },[addNew])\n  \n  useEffect(()=>{ \n\n   \n\n    if (!child){    \n       return;\n    }\n  \n\n    if (!child || !parent)\n      return;\n\n    \n    const lut = {...lookuptable};\n\n    lut[parent] = lut[parent] || [];\n\n    const filtered = Object.keys(lut).reduce((acc, key)=>{\n        //ignore root!\n        if (key === \"root\"){\n          return {\n            ...acc,\n            [key]:lut[key]\n          }\n        }\n\n        const children = lut[key] || [];\n        \n        if (key==parent){\n            return {\n              ...acc,\n              [key]: [...children, child]\n            }\n        }\n\n   \n\n        if (children.map(c=>c.event).indexOf(child.event) !== -1){\n          return {\n            ...acc,\n            [key] : [...children.filter(i=>i.event!==child.event)]\n          }\n        }\n\n        //return unchanged\n        return {\n          ...acc,\n          [key] : children,\n        }\n    },{});\n\n    setLookuptable(filtered);\n   \n  },[child,parent]);\n\n  const svgref = useD3(\n   \n    (svg) => {\n      const dgbox = svg.select(\"g#dragbox\");\n      svg.call(d3z.zoom().on(\"zoom\",  (e)=>{\n        dgbox.attr(\"transform\", e.transform)\n      }))\n    } \n ,[]);\n\n//LOTS of gotchas here - need to make sure we re-bind the clicks and that we use useEffect to see the changes to state objects AND\n//pass in the changed items\nconst allexcept = (tree, nodestoignore=[])=>{\n  const eligible = [];\n  tree.each(n=>{\n      if (nodestoignore.indexOf(n.data.name)==-1){\n         eligible.push(n.data.name);\n      }\n  })\n  return eligible;\n}\n\nconst allchildren = (node, lut)=>{\n    if (!lut[node] || lut[node].length <= 0){\n        return []\n    }\n    return [...lut[node], ...lut[node].reduce((acc, n)=>{\n        return [...acc, ...allchildren(n.event,lut)]\n    },[])]\n}\n\n\n//NASTY!\nconst _empty = (arr)=>{\n\n  \n  if (!arr || arr.length <= 0 || arr.length <= 0 || arr[0].length <= 0){\n    return true;\n  } \n\n  /*const x = arr[0][0];\n  if (typeof x == \"string\"){\n    if (x.trim()==\"\")\n      return true;\n  }*/\n  return false;\n}\n\nconst treeref = useD3((root) => {\n\n  console.log(\"converting! toi hierarchy!\")\n    const jsontree = convertToHierarchy(lookuptable,nodes);\n    console.log(\"done!\");\n    const hier = (d3h.hierarchy(jsontree, d=>d.children));\n    let _lookup = {}\n  \n    const tree   =  d3h.tree().nodeSize([sw+XPADDING,sh+YPADDING])(hier);  \n\n    //we use this table to generate the loop links\n    for (const n of tree.descendants()){\n      _lookup[n.data.event.event] = {x:n.x, y:n.y}\n    }\n   \n\n    \n  \n    _loops = _loops.map(l=>{\n      return {\n        from : {name: l.from.event, x:_lookup[l.from.event].x, y:_lookup[l.from.event].y+ sh} ,\n        to: { name: l.to.event, x:_lookup[l.to.event].x, y:_lookup[l.to.event].y+ LINKDELTA, op:l.to.op, actions:l.to.actions}\n      }\n    })\n\n    const _links  = [..._expanded(links(tree)), ..._loops];\n\n    const currentlinks = lookuplinks(_links);\n\n    let eligible = [];\n    \n    \n    const isloopback = (l)=>{\n      return l.from.x === l.to.x && l.from.y > l.to.y;\n    }\n\n    const parentfor = Object.keys(lookuptable).reduce((acc,key)=>{\n        if (key === \"root\"){\n            return acc;\n        }\n        const item = lookuptable[key];\n        \n        return {\n                    ...acc, \n                    ...(item.reduce((acc,obj)=>{\n                        return {\n                            ...acc,\n                            [obj.event] : key,\n                        }\n                    },{}))\n        }\n    },{});\n    \n    if (child){\n      \n      //ignore all children, current parent and self as candidates for new parent\n      const nodestoignore = [...allchildren(child.event,lookuptable).map(e=>e.event), parentfor[child.event], child.event];\n      eligible = allexcept(tree,nodestoignore);\n    }\n\n    root.selectAll(\"g#slide\")\n        .data(tree.descendants(), (d) => {\n            return d.data.event.id\n        }) \n        .join(\n        enter => {\n\n          //render slides!\n          const node = enter.append(\"g\")\n                            .attr(\"id\", \"slide\")\n                            .attr(\"transform\", (d, i) => `translate(${d.x},${d.y+20})`)\n          \n          node.append(\"circle\")\n              .attr(\"id\", d=>d.data.name)\n              .attr(\"cx\", sw/2)\n              .attr(\"cy\",sh/2)\n              .attr(\"r\", sh/2)\n              .style(\"stroke\",\"black\")\n              .style(\"stroke-width\", \"1.87px\")\n              .style(\"fill\", \"white\")\n              .on(\"dblclick\", (e,n)=>nodeSelected(e,n))\n\n           node.append(\"text\")\n                .attr(\"x\", sw/2)\n                .attr(\"y\", sh/2+5)\n                .style(\"text-anchor\", \"middle\")\n                .text((d)=>d.data.name)\n                .on(\"dblclick\", (e,n)=>nodeSelected(e,n))\n        },\n        update =>{\n          update.transition().duration(ANIMATION_DURATION).attr(\"transform\", (d, i) => `translate(${d.x},${d.y+20})`);\n          update.select(\"circle\").on(\"dblclick\", (e,n)=>nodeSelected(e,n))\n          update.select(\"text\").on(\"dblclick\", (e,n)=>nodeSelected(e,n))\n        },\n        \n        exit => exit.call(exit =>\n              exit.remove().transition()\n                  .duration(ANIMATION_DURATION)\n                  .delay((d, i) => i * 100)\n                  .attr(\"transform\", (d,i) => `translate(${i * 50},50)`)\n                  .style(\"opacity\", 0)\n                  .remove()\n            )\n        )//update passed through to this..\n       \n        \n    //render links!\n    root.selectAll(\"path#link\").data(_links, d=>`${d.from.name}${d.to.name}${d.to.actions.join(\",\")}`).join(\n          enter => {\n            enter.append(\"path\").attr(\"id\", \"link\").attr(\"d\", l=>{\n              if (isloopback(l)){\n                return _loopback(l.from.x+(sw/2), l.from.y+LINKDELTA, l.to.x+(sw/2), l.to.y)\n              }\n              return _clink(l.from.x+(sw/2), l.from.y+LINKDELTA+TARGETBIGR, l.to.x+(sw/2), l.to.y-TARGETBIGR);\n            })\n            .style(\"stroke\",\"#000\")\n            .style(\"opacity\",1)\n            .style(\"stroke-width\", 2.5)\n            .style(\"fill\", \"none\")\n            .transition().duration(ANIMATION_DURATION).style(\"opacity\", 1);\n          },\n          update=>update,\n          exit => exit.call(exit=>exit.remove())\n      )\n      .transition()\n      .duration(ANIMATION_DURATION)\n      .attrTween(\"d\", l=>{\n          const last = treeref.current.last || {};\n          const l1 = last[`${l.from.name}_${l.to.name}`];\n          \n\n          var previous = l1 ?  _clink(l1.x1+(sw/2), l1.y1+LINKDELTA+TARGETBIGR, l1.x2+(sw/2), l1.y2-TARGETBIGR) : _clink(l.from.x+(sw/2), l.from.y+LINKDELTA+TARGETBIGR, l.to.x+(sw/2), l.to.y-TARGETBIGR);\n          var current =  isloopback(l) ? _loopback(l.from.x+(sw/2), l.from.y+LINKDELTA, l.to.x+(sw/2), l.to.y) : _clink(l.from.x+(sw/2), l.from.y+LINKDELTA+TARGETBIGR, l.to.x+(sw/2), l.to.y-TARGETBIGR);\n          \n          return interpolatePath(previous, current);\n      }).on(\"end\", ()=>{\n        treeref.current.last = currentlinks; //memoise the previous links\n      });\n    \n     //render actions within links\n     root.selectAll(\"g#link\").data(_links, d=>{return`${d.from.name}${d.to.name}${d.to.actions.join(\",\")}${d.to.op}`}).join(\n        enter => {\n            const target = enter.append(\"g\").attr(\"id\", \"link\").attr(\"transform\", l=>`translate(${l.from.x+sw/2 - (l.from.x-l.to.x)/2}, ${l.to.y+ (l.from.y+LINKDELTA-l.to.y)/2})`);\n           \n            target.append(\"circle\").attr(\"id\", \"link\").style(\"opacity\",0).style(\"fill\",\"rgb(243, 244, 246)\").style(\"stroke\",\"none\").attr(\"cx\", 0).attr(\"cy\",-YPADDING+sh).attr(\"r\",10).transition().duration(ANIMATION_DURATION).style(\"opacity\",1);\n            target.append(\"text\").attr(\"id\", \"rule\").style(\"text-anchor\", \"middle\").style(\"font-weight\", \"bold\").style(\"font-size\", \"10px\").attr(\"x\",0).attr(\"y\",-YPADDING+sh).text(l=>l.to.op).on(\"click\", (e,l)=>linkSelected(e,l))\n           \n            target.append(\"circle\").attr(\"id\", \"label\").style(\"fill\",\"rgb(243, 244, 246)\").style(\"opacity\", l=>l.to.actions && l.to.actions.length > 0 ? 1 : 0).style(\"stroke\",\"none\").attr(\"cx\", l=>isloopback(l) ? (sw/2)*1.5:0).attr(\"cy\",0).attr(\"r\",20).on(\"click\", (e,l)=>linkSelected(e,l))\n            target.append(\"text\").attr(\"id\",\"action\").style(\"font-size\", \"10px\").style(\"text-anchor\", \"middle\").attr(\"x\",l=>isloopback(l) ? (sw/2)*1.5:0).attr(\"y\",0).text(l=>_empty(l.to.actions) ? \"+\" : _printableactions(l.to.actions)).on(\"click\", (e,l)=>linkSelected(e,l))\n            \n        },\n        update=>{\n            update.transition().duration(ANIMATION_DURATION).attr(\"transform\", l=>`translate(${l.from.x+sw/2 - (l.from.x-l.to.x)/2}, ${l.to.y+ (l.from.y+LINKDELTA-l.to.y)/2})`);\n            update.select(\"circle#label\").style(\"opacity\", l=>l.to.actions && l.to.actions.length > 0 ? 1 : 0).on(\"click\", (e,l)=>linkSelected(e,l))\n            update.select(\"text#action\").text(l=>_empty(l.to.actions) ? \"+\" : _printableactions(l.to.actions)).on(\"click\", (e,l)=>linkSelected(e,l));\n            update.select(\"text#rule\").on(\"click\", (e,l)=>linkSelected(e,l));\n        },\n        exit => exit.call(exit=>exit.remove())\n    );\n\n    const _parentSelected = (e, n)=>{\n        if (!child || eligible.indexOf(n.data.event.event) != -1){\n            parentSelected(e,n);\n        }\n    }\n    //render targets!\n    root.selectAll(\"g#target\")\n        .data(tree.descendants(), d => `${d.data.name}${child ? d.data.name==child ? \"_\" : \"\" : \"\"}`)\n        .join(\n          enter=>{\n            const target = enter.append(\"g\").attr(\"id\", \"target\").attr(\"transform\", d=>`translate(${d.x-sw/2}, ${d.y})`)\n          \n            //to target\n            target.append(\"circle\").attr(\"id\", \"bigtotarget\").attr(\"cx\",sw).attr(\"cy\", LINKDELTA+TARGETSMALLR).attr(\"r\", TARGETBIGR).style(\"fill\",\"#fff\").style(\"stroke\",\"#762bae\").attr(\"stroke-width\",2.5).on(\"click\",childSelected)\n            target.append(\"circle\").attr(\"id\", \"smalltotarget\").attr(\"cx\",sw).attr(\"cy\", LINKDELTA+TARGETSMALLR).attr(\"r\", TARGETSMALLR).style(\"fill\",\"#ae2b4d\").style(\"stroke\",\"#6F67CC\").attr(\"stroke-width\",2.5).on(\"click\",childSelected)\n           \n            //from target\n            target.append(\"circle\").attr(\"id\", \"bigfromtarget\").attr(\"cx\",sw).attr(\"cy\", sh+LINKDELTA).attr(\"r\",  TARGETBIGR).style(\"fill\", d=> parent && parent == d.data.name ? \"#ae2b4d\":\"white\").style(\"stroke\",\"black\").attr(\"stroke-width\",2.5).on(\"click\", _parentSelected)\n            target.append(\"circle\").attr(\"id\", \"smallfromtarget\").attr(\"cx\",sw).attr(\"cy\", sh+LINKDELTA).style(\"opacity\", child ? 1 : 0).attr(\"r\",  TARGETSMALLR).style(\"fill\", d=> parent && parent == d.data.name ? \"#ae2b4d\":\"white\").style(\"stroke\",\"#cc6767\").attr(\"stroke-width\",2.5).on(\"click\",_parentSelected)\n            target.append(\"text\").attr(\"id\", \"smalltotarget\").attr(\"x\",sw).attr(\"y\",sh+LINKDELTA+5).text(\"+\").style(\"text-anchor\", \"middle\").style(\"fill\",\"black\").on(\"click\", _parentSelected)\n            \n          \n        },\n        update=>{\n            \n            update.transition().duration(ANIMATION_DURATION).attr(\"transform\", d=>`translate(${d.x-sw/2}, ${d.y})`)\n            update.selectAll(\"circle#bigtotarget\").style(\"fill\", (d)=> child && child == d.data.name ? \"red\" : \"white\").style(\"stroke\", (d)=>child && child == d.data.name ? \"white\" : \"#762bae\").on(\"click\", childSelected)\n            update.selectAll(\"circle#smalltotarget\").style(\"fill\", (d)=>child && child== d.data.name ? \"red\" : \"#ae2b4d\").style(\"stroke\",(d)=>child && child == d.data.name ? \"white\" : \"#6F67CC\").on(\"click\", childSelected)   \n            update.selectAll(\"circle#bigfromtarget\").style(\"stroke\", child ? \"#ae2b4d\" : \"black\").style(\"fill\", d=> parent && parent == d.data.name ? \"#ae2b4d\":\"white\").on(\"click\", _parentSelected).transition().duration(ANIMATION_DURATION).attr(\"r\", d=>eligible.indexOf(d.data.name) == -1 ? TARGETBIGR :  TARGETBIGR+4)\n            update.selectAll(\"circle#smallfromtarget\").style(\"opacity\", child ? 1 : 0).style(\"fill\",  d=> parent &&  parent == d.data.name ? \"#ae2b4d\":\"white\").on(\"click\", _parentSelected).transition().duration(ANIMATION_DURATION).attr(\"r\", d=>eligible.indexOf(d.data.name) == -1 ? TARGETSMALLR : TARGETSMALLR+2).attr(\"class\", d=>eligible.indexOf(d.data.name) == -1 ? \"\":\"pulse\");\n            update.selectAll(\"text#smalltotarget\").style(\"opacity\", child ? 0 : 1).on(\"click\",_parentSelected)\n           \n          \n          },\n          exit=> exit.call(exit=>exit.remove())\n        )\n\n      \n  }, [child, parent, lookuptable, nodes]);\n\n \n  //can we do the rendertree, renderlinks and rendertargets in d3 hook?  \n  //we can even have two ref objects to deal with the zoom box?\n  return (\n    <div >\n     \n      <main>\n            <div className=\"flex justify-center items-center flex-col\">\n                \n            <svg onClick={()=>reset()} ref={svgref} width={\"100vw\"} height={\"100vh\"}>\n                <g  id=\"dragbox\">\n                    <g onClick={(e)=>{e.stopPropagation()}}  ref={treeref}>\n                    </g>\n                </g>\n            </svg>\n           \n            </div>\n      </main>\n    </div>\n  )\n}\n","import {Layer} from \"./Layer\"\nexport default Layer;","import { useSelector, useDispatch } from 'react-redux';\nimport Tree from './Tree';\nimport {useEffect, useState} from 'react';\n\nimport {\n   selectTree,\n   selectLayers,\n   selectLayerId,\n   selectNodes,\n   selectParent,\n   selectChild,\n   selectAuthored,\n   setLookuptable, \n   setParentToAddTo,\n   setParent,\n   setChild,\n   setLayer,\n   exportNodes,\n   fetchAuthored,\n   fetchLayers,\n   addLayer\n} from './layerSlice';\n\nimport {\n    setViewAddNode,\n    selectViewAdd,\n    editNode,\n    setEditLink,\n} from '../creator/creatorSlice'\n\nexport function Layer() {\n\n  const dispatch = useDispatch();\n  const nodes = useSelector(selectNodes);\n  const lut  = useSelector(selectTree);\n  const addNew  = useSelector(selectViewAdd);\n  const {id:parent} = useSelector(selectParent);\n  const child = useSelector(selectChild);\n  const authored = useSelector(selectAuthored);\n  const _layers = useSelector(selectLayers);\n  const layerid = useSelector(selectLayerId);\n\n  const _exportNodes = (name)=>{ \n      dispatch(exportNodes(name));\n      toggleSaveDialog(false);\n  }\n\n  const [saveDialog, toggleSaveDialog] = useState(false);\n  const [name, setName] = useState(\"\");\n  const [currentLayer, setCurrentLayer] = useState(\"\");\n\n  useEffect(()=>{\n    dispatch(fetchAuthored());\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const params = Object.fromEntries(urlSearchParams.entries());\n    const {layers=null} = params;\n    if (layers){\n      dispatch(fetchLayers(layers))\n      setCurrentLayer(layers);\n    }\n  },[])\n\n  const renderAuthored = ()=>{\n        return authored.map(a=>{\n          //return <div key={a} className=\"p-2 text-white text-xs\" onClick={()=>{dispatch(fetchLayers(a))}}>{a}</div>\n          return <a key={a} className=\"p-2 text-white text-xs\" href={encodeURI(`author?layers=${a}`)}>{a}</a>\n        })\n  }\n\n  const renderSaveDialog = ()=>{\n    return <div className=\"absolute flex w-screen h-screen  items-center justify-center\">\n              <div className=\"flex flex-col shadow-xl p-4 bg-white rounded flex justify-items-end items-end \">\n                <button onClick={()=>toggleSaveDialog(!saveDialog)} className=\"rounded-full h-6 w-6 bg-pink-500 text-white\">x</button> \n                <div className=\" flex flex-row p-4 items-center\">\n                  <input type=\"text\" className=\"p-4 mr-4\" placeholder=\"filename\" value={name} onChange={(e)=>setName(e.target.value)}></input>     \n                  <button onClick={()=>_exportNodes(name)} className=\"rounded-full h-10 w-10 bg-blue-500 text-white\">save</button>              \n              </div>\n              </div>\n            </div>\n  }\n\n  const renderLayerSelection = ()=>{\n    const _items = _layers.map(l=>{\n      const selected = l === layerid;\n      return <div className={`p-2 text-xs ${selected ? \"font-bold\":\"text-gray-400\"}`} key ={l} onClick={()=>dispatch(setLayer(l))}>{l}</div>\n    })\n    return <div className=\"h-10 flex flex-row  mt-12 w-screen bg-black text-white  items-center\">\n        {_items}\n        <div className=\"ml-4 p-2 text-xs flex items-center justify-center rounded-full bg-white text-black w-4 h-4\" key =\"add\" onClick={()=>{dispatch(addLayer())}}>+</div>\n    </div>\n  }\n\n  const renderTree = ()=>{\n        if (lut){\n            return <Tree    \n                    lookuptable={lut} \n                    nodes={nodes} \n                    addNew={addNew} \n                    parent={parent}\n                    child={child}\n                    setLookuptable      = {(lut)=>dispatch(setLookuptable(lut))} \n                    toggleAddNew        = {(value)=>dispatch(setViewAddNode(value))} \n                    closeEditAction     = {()=>dispatch(setEditLink())} \n                    setParentToAddTo    = {(parent)=>dispatch(setParentToAddTo(parent))} \n                    editNode            = {(node)=>dispatch(editNode(node))}\n                    editLink            = {(link)=>dispatch(setEditLink(link))}\n                    setParent           = {(parent)=>dispatch(setParent(parent))}\n                    setChild            = {(child)=>dispatch(setChild(child))}\n            />\n        }\n  }\n  \n  return  <div>\n     {saveDialog && renderSaveDialog()}\n                <div  className=\"bg-blue-500 text-white w-screen h-12 fixed flex items-center\">\n                   \n                    <div className=\"flex flex-grow pl-4 text-xs\">\n                      <div onClick={()=>toggleSaveDialog(!saveDialog)}>SAVE & EXPORT</div>\n                      {currentLayer && <a className=\"flex flex-grow pl-4 text-xs\" target=\"_blank\" href={`../?layers=${currentLayer}`}></a>}\n                    </div>\n                    <div className=\"flex justify-end items-center mr-8\"><div className=\"text-xs p-2\">LOAD</div>{renderAuthored()}</div>\n                </div>\n                {renderLayerSelection()}\n                {renderTree()}\n               \n            </div>\n}","import './App.css';\nimport Creator from './features/creator';\nimport {ActionCreator} from './features/creator/ActionCreator';\nimport Layer from './features/layer';\nimport { useSelector, useDispatch} from 'react-redux';\n\nimport {\n  selectViewAdd,\n  linkToEdit,\n  setViewAddNode,\n  setEditLink,\n} from './features/creator/creatorSlice';\n\nfunction App() {\n  const dispatch = useDispatch();\n  const viewAdd  = useSelector(selectViewAdd);\n  const link = useSelector(linkToEdit);\n\n  const onClose = ()=>{\n    dispatch(setViewAddNode(false))\n    dispatch(setEditLink());\n  }\n\n  const renderCreate = ()=>{\n    return <div className=\"absolute flex w-screen h-screen  items-center justify-center\" style={{zIndex:30}}>\n              <div   className=\"shadow-xl p-2 bg-white rounded overflow-auto\" style={{maxHeight: \"80vh\",  width:\"900px\"}}><Creator onClose={onClose}/></div>\n            </div>\n  }\n \n  const renderActions = ()=>{\n    return <div  className=\"absolute flex w-screen h-screen  items-center justify-center\" style={{zIndex:30}}>\n    <div className=\"flex flex-grow absolute shadow-xl p-2 bg-white rounded overflow-auto\" style={{maxHeight: \"80vh\",  width:\"745px\"}} ><ActionCreator onClose={onClose}/></div>\n    </div>\n  }\n\n  return (\n    <div className=\"App w-screen\">\n       <div className=\"flex flex-row shadow bg-gray-100\">\n            {link && renderActions()}\n            {viewAdd && renderCreate()}\n            <div className=\"flex flex-grow\"><Layer/></div>\n       </div>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import { configureStore } from '@reduxjs/toolkit';\nimport creatorReducer from '../features/creator/creatorSlice';\nimport layerReducer from '../features/layer/layerSlice';\n\nexport default configureStore({\n  reducer: {\n   creator: creatorReducer,\n   layer: layerReducer\n  },\n});\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\nimport store from './app/store';\nimport { Provider } from 'react-redux';\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}