{"version":3,"sources":["features/experience/Buttons.js","features/experience/experienceSlice.js","features/experience/Speech.js","features/experience/Webhook.js","features/experience/Layer.js","features/experience/Navigation.js","features/experience/Uploader.js","features/experience/TextEntry.js","utils/index.js","features/experience/PlaceholderManager.js","features/experience/Tree.js","hooks/useD3.js","hooks/useWindowDimensions.js","features/experience/Importer.js","features/experience/Experience.js","App.js","app/store.js","serviceWorker.js","index.js"],"names":["Buttons","ready","names","handleAction","buttons","map","b","onClick","className","socket","io","window","location","href","experienceSlice","createSlice","name","initialState","layers","events","readyforinput","transcript","lastsenttranscript","authored","layerName","listening","rendering","reducers","setAuthored","state","action","payload","setLayerName","setLayers","setEvents","setEvent","filter","l","id","setTranscript","layerid","setReadyForInput","setListening","sentTranscript","resetReadiness","setRendering","actions","on","console","log","setTimeout","connect","fetchAuthored","dispatch","superagent","get","then","res","alist","body","selectEvents","experience","sort","a","selectReadyForInput","selectSpeech","selectTrees","reduce","acc","item","d3","nodeSize","d","children","selectAuthored","selectLayerName","selectRendering","Speech","rules","handleChange","useState","words","setWords","_handleChange","value","_handleAction","speech","useSelector","style","height","trim","operands","rule","operand","o","next","length","onChange","e","target","type","placeholder","renderOperands","Webhook","webhooks","w","Layer","useDispatch","minHeight","overflow","data","toggleTree","event","query","layer","end","err","buttonPressed","getState","sendTranscript","Object","keys","key","trigger","manualWebhook","JSON","stringify","renderEvent","Navigation","start","toggleCreate","toggleUploadMedia","twineExport","renderSpeech","width","viewBox","fillRule","clipRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","fill","stroke","strokeWidth","cx","cy","rx","ry","encodeURI","textWeight","opacity","Uploader","close","success","error","file","setFile","changeHandler","files","handleSubmission","formData","FormData","append","request","post","send","response","undefined","TextEntry","done","text","setText","rows","placeholderType","url","indexOf","updatePlaceholder","parse","PlaceholderManager","placeholders","placeholderValues","setPlaceholderValues","expand","setExpand","fetchPlaceHolderValues","useEffect","toggleExpand","_updatePlaceholder","renderPlaceholder","border","src","renderImagePlaceHolder","renderPlaceholders","items","top","left","background","overflowY","paddingBottom","borderRadius","_seen","_flatten","list","concat","Array","isArray","links","node","from","x","y","to","c","rids","root","rid","_clink","sx","sy","tx","ty","_loopback","isloopback","recenter","gtree","t","g","current","mx","my","moustrans","select","attr","split","replace","Tree","React","placeholderVisible","setPlaceholderVisible","placeholderManagementVisible","setPlaceholderManagementVisible","selectedPlaceholders","setSelectedPlaceholders","allPlaceholders","setAllPlaceholders","extractPlaceholders","transition","duration","moveChart","mytree","d3Fn","dependencies","ref","useRef","useD3","svg","dgbox","call","d3z","transform","togglePlaceholders","toggleShowPlaceHolderManagement","stopPropagation","renderSpeechPlaceHolder","renderType","generatecoords","n","r","textAnchor","fontSize","seenlinks","link","Math","max","min","anchor","labeldata","label","ld","i","Set","join","operator","rulelabel","ruletext","fontWeight","renderLinks","renderTree","selected","handleClick","paint","show","triggered","getWindowDimensions","innerWidth","innerHeight","Importer","save","cancel","json","setJSON","setError","setName","selectedFile","setSelectedFile","fileReader","FileReader","readAsText","onload","result","importIt","Experience","trees","visibleTrees","setVisibleTrees","create","setCreate","upload","setUpload","windowDimensions","setWindowDimensions","handleResize","addEventListener","removeEventListener","useWindowDimensions","setStartLabel","BrowserSpeechRecognition","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","msSpeechRecognition","oSpeechRecognition","recognition","continous","interimResults","lang","urlSearchParams","URLSearchParams","search","fromEntries","entries","et","tree","catch","manualTrigger","expandedtrees","th","e1","e2","set","reset","html","htmlString","encodeURIComponent","document","createElement","download","click","App","configureStore","reducer","experienceReducer","Boolean","hostname","match","ReactDOM","render","StrictMode","store","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.b87485fb.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nfunction Buttons({ready, names, handleAction}) {\n    \n\n      const renderButtons = ()=>{\n            if(ready){\n                  return <div>{buttons}</div>\n            }else{\n                  return <></>;\n            }\n      }\n    const buttons = names.map(b=>{\n       \n          return   <button key={b} onClick={()=>handleAction(b)} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">{b}</button>\n         \n    });\n    \n    return renderButtons();\n }\n \n export default Buttons;","import { compose, createSlice } from '@reduxjs/toolkit';\nimport io from 'socket.io-client';\nimport superagent from 'superagent';\nimport * as d3 from 'd3-hierarchy';\n\n//import Layer from './Layer';\n\nconst socket = io(window.location.href);\n\n\nexport const experienceSlice = createSlice({\n  name: 'experience',\n  \n  initialState: {\n    layers: [],\n    events: [],\n    readyforinput: {},\n    transcript: \"\",\n    lastsenttranscript:\"\",\n    authored:[],\n    layerName:\"\",\n    listening: {},\n    rendering:false,\n  },\n\n  reducers: {\n    setAuthored : (state, action)=>{\n      state.authored = action.payload;\n    },\n    setLayerName : (state, action)=>{\n      state.layerName = action.payload;\n    },\n    setLayers : (state, action)=>{\n      state.layers = action.payload;\n    },\n    setEvents: (state, action)=>{\n      state.events = action.payload;\n    },\n    setEvent: (state, action) => {\n      state.events = [...state.events.filter(l=>l.id !== action.payload.id), action.payload];\n    },\n    setTranscript: (state, action)=>{\n      const {transcript, layerid} = action.payload;\n      state.transcript = transcript;\n    },\n    setReadyForInput: (state,action)=>{\n      state.readyforinput = {\n        ...state.readyforinput, ...action.payload\n      }\n    },\n    setListening: (state, action)=>{\n      const {layerid, listening} = action.payload;\n      state.listening = {\n        ...state.listening,\n        [layerid] : listening\n      }\n    },\n    sentTranscript: (state)=>{\n      state.lastsenttranscript = state.transcript;\n    },\n    resetReadiness: (state)=>{\n      state.readyforinput = {};\n    },\n    setRendering: (state,action)=>{\n      state.rendering = action.payload;\n    }\n  }\n});\n\nexport const { setRendering, setLayers, setLayerName, setEvent, setListening, setEvents, setTranscript,sentTranscript,setReadyForInput,setAuthored,resetReadiness} = experienceSlice.actions;\n\nexport const reset = (layerid=\"\")=>dispatch=>{\n  superagent.get('/event/start').then(res => {\n    dispatch(resetReadiness());\n    dispatch(setEvents(res.body));\n    dispatch(setTranscript({transcript:\"\", layerid}));\n  \n })\n .catch(err => {\n   console.log(\"error resetting events\", err);\n    // err.message, err.response\n });\n}\n\nconst delay = (ms) =>{\n  return new Promise((resolve, reject)=>{\n    setTimeout(()=>{\n      resolve()\n    }, ms);\n  });\n}\n\n\n//TODO - get rid - this is to react to browser speech synth, which not using now\n\nexport const listenOnActions = (window) => async dispatch => {\n  //const voices = await getVoices();\n\n  socket.on('action', async actions => {\n\n  \n  for (const payload of actions){\n  \n  \n    /*if (payload.type===\"browserspeech\"){\n      for (const sentence of payload.data.speech){\n        _talking = true;\n       // recognition.stop();\n        await sayWords(window, sentence.words,voices[1]);//51\n        if (sentence.delay){\n          await delay(sentence.delay);\n        }\n      }\n     _talking = false;\n     try{\n     \n      //recognition.start();\n    }catch(err){\n     \n    }\n      //window.speechSynthesis.speak(new SpeechSynthesisUtterance(payload.data.words));\n    }\n   */\n  }\n });\n}\n\nexport const renderSpeech = ()=> async (dispatch, getState)=>{\n  const name = getState().experience.layerName;\n  dispatch(setRendering(true));\n  await superagent.get(\"/author/render\").query({name});\n  dispatch(setRendering(false));\n}\n\nexport const listenOnEvents = () => (dispatch, getState) => {\n\n\n  socket.on('event', payload => {\n    dispatch(setTranscript({transcript:\"\"}));\n    dispatch(setListening({layerid: payload.id, listening:false}));\n    dispatch(setEvent(payload));\n  });\n\n  socket.on('ready', payload=>{\n    //TODO: get layerid from event!\n    const {event, layer} = payload;\n   \n    dispatch(setTranscript({transcript:\"\"}));\n    console.log(\"setting ready for inout\", event, layer);\n    dispatch(setReadyForInput({[layer]:true}));\n\n    if (event.type===\"speech\"){\n      dispatch(setListening({layerid: layer, listening:true}));\n    }\n  });\n}\n\nsocket.on(\"connect_error\", () => {\n  const reconnect = ()=>{\n    console.log(\"attempting to reconnect!!\");\n    setTimeout(() => {\n      socket.connect();\n    }, 1000);\n  }\n  reconnect();\n});\n\nexport const buttonPressed  = (b, layerid) => (dispatch)=>{\n  console.log(\"button pressed!!\", b, layerid);\n  dispatch(setReadyForInput({[layerid]:false}));\n  superagent.get(\"/event/press\").query({name:b, layer:layerid}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\nexport const manualWebhook  = (b, layerid) => ()=>{\n  superagent.get(\"/event/webhook\").query({trigger:b}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\nexport const manualTrigger = (layer, node)=>()=>{\n  superagent.get(\"/event/trigger\").query({layer,node}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\n//TOD0 - only listen if any of the current events are listening events.\n//on server only subscibe to current events rather than all!!\n\nexport const sendTranscript = () => (dispatch, getState) =>{\n   \n    const {transcript} = getState().experience;\n    const layers = getState().experience.listening\n\n    const sendTranscript = async ()=>{\n      for (const key of Object.keys(layers)){\n        if (layers[key]){    \n          await superagent.get(\"/event/speech\").query({layer:key, speech:getState().experience.transcript})\n          dispatch(sentTranscript());      \n        }\n      }\n      dispatch(setTranscript({transcript:\"\"}));\n    }\n    \n    if (transcript.trim() !== \"\"){\n      sendTranscript();\n    }\n};\n\nexport const gestureObserved = (g,layerid)=> (dispatch, getState) =>{\n  //stopListening();\n  superagent.get(\"/event/gesture\").query({gesture:g}).end((err, res)=>{});\n  //dispatch(setEvent({}));\n}\n\nexport const fetchAuthored = ()=>(dispatch)=>{\n  superagent.get('/author/authored').then(res => {\n    const alist = res.body.layers;\n    dispatch(setAuthored(alist));\n  })\n}\n\n\n\n//this kicks everything off;\n\n//recogniotion cannot know about layer!!\n\nexport const fetchLayers = (layer, r) => (dispatch, getState)=>{\n  \n  superagent.get('/event/layers').query({layer}).then(res => {\n    const trees = res.body.map(et=>({...et.tree, layerid:et.layerid}));\n    console.log(trees);\n    dispatch(setLayerName(layer));\n    dispatch(setLayers(trees));\n  })\n  .catch(err => {\n    console.log(\"error resetting events\", err);\n  });\n}\n\n\nexport const listenToSpeech = () => (dispatch, getState) => {\n  //console.log(\"called listen to speech!\");\n  //startRecognition();\n}\n\n// The function below is called a selector and allows us to select a value from\n// the state. Selectors can also be defined inline where they're used instead of\n// in the slice file. For example: `useSelector((state) => state.counter.value)`\nexport const selectEvents= state => {\n  return  [...(state.experience.events || [])].sort((a,b)=>{\n    if (a.id < b.id) return -1;\n    if (a.id > b.id) return 1;\n    return -1;\n  });\n}\n\n\nexport const selectReadyForInput = state => state.experience.readyforinput;\nexport const selectSpeech= state => state.experience.transcript;\n\n\nexport const selectTrees = state =>  {\n    return state.experience.layers.reduce((acc, item)=>{\n      return {\n          ...acc,\n          [item.layerid] : d3.tree().nodeSize([120, 230])(d3.hierarchy(item, d=>d.children))\n      }\n    },{});\n}\nexport const selectAuthored = state => state.experience.authored;\nexport const selectLayerName = state => state.experience.layerName;\nexport const selectRendering = state => state.experience.rendering;\n\nexport default experienceSlice.reducer;\n","import React, {useState,} from 'react';\nimport { useSelector} from 'react-redux';\n\nimport {\n    selectSpeech,\n} from './experienceSlice';\n\nexport default function Speech({rules, ready, handleAction, handleChange}) {\n \n\n  const [words, setWords] = useState(\"\");\n\n  const _handleChange = (value) =>{\n    handleChange(value);\n    setWords(value);\n  }\n\n  const _handleAction = ()=>{\n    setWords(\"\");\n    handleAction();\n  }\n\n  const renderOperands = ()=>{\n\n    const operands = rules.reduce((acc, item)=>{\n          return [...acc, ...(item.rule.operand || []).map(o=>({\n                operand: o,\n                next: item.next,\n          }))]\n    },[]);\n\n    if (operands.length === 0){\n      return <div className=\"flex flex-col overflow-auto\">\n            <input onChange={(e)=>_handleChange(e.target.value)} value={words} className=\"h-10 pl-2 m-4 rounded\" type=\"text\" placeholder=\"simulate some words\"></input>\n            <button onClick={()=>{_handleAction()}} className=\"bg-blue-500 mr-2 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">say it!</button>\n        </div>\n    }else{\n      return  operands.map(b=>{\n            return   <button key={b.operand} onClick={()=>{ _handleChange(b.operand);_handleAction();}} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 mt-2rounded\">{`${b.operand} (${b.next})`}</button>\n      });\n    }\n}\n\n  const speech = useSelector(selectSpeech);\n\n  return (\n    <div className=\"flex flex-col h-full w-full\">\n      <div style={{height:50}} className=\"flex text-xs font-bold justify-center items-center\">{speech.trim()==\"\" ? \"[listening for speech]\" : `\"${speech}\"`}</div>\n      {ready && <div className=\"p-6 bg-black flex flex-grow flex-col\">\n          <div className=\"font-semibold text-white text-base pb-2\">override</div>\n          {renderOperands()}\n      </div>}\n    </div>  \n  );\n  \n}\n","import React, { useState, useEffect } from 'react';\n\nfunction Webhook({ready, names, handleAction}) {\n    \n\n      const renderWebhooks = ()=>{\n            if(ready){\n                  return <div>{webhooks}</div>\n            }else{\n                  return <></>;\n            }\n      }\n    const webhooks = names.map(w=>{\n       \n          return   <button key={w} onClick={()=>handleAction(w)} className=\"bg-green-500 m-2 text-xs hover:bg-green-700 text-white font-bold py-2 px-4 rounded\">{w}</button>\n         \n    });\n    \n    return renderWebhooks();\n }\n \n export default Webhook;","import Buttons from \"./Buttons\";\nimport Speech from \"./Speech\";\nimport Webhook from \"./Webhook\";\n//import Gesture from \"./Gesture\";\nimport {setTranscript, sendTranscript, buttonPressed, manualWebhook} from './experienceSlice';\nimport {useDispatch } from 'react-redux';\n\nfunction Layer(e) {\n    const {id} = e;\n    const dispatch = useDispatch();\n    const renderEvent = (event)=>{\n\n        switch (event.type){\n            case \"button\":\n                return <Buttons \n                            ready={event.ready} \n                            names={event.data} \n                            handleAction={(b)=>{\n                                dispatch(buttonPressed(b,id));\n                            }}/>\n            case \"speech\":\n                return <Speech  \n                            rules={event.rules} \n                            ready={event.ready} \n                            handleChange={(transcript)=>{\n                               \n                                dispatch(setTranscript({transcript,layerid:id}));\n                            }}\n                            handleAction={()=>{\n                              \n                                dispatch(sendTranscript());\n                            }}/>\n            case \"webhook\":\n                return <Webhook\n                            ready={event.ready} \n                            names={event.data} \n                            handleAction={(b)=>{\n                            dispatch(manualWebhook(b));\n                }}/>\n\n            default:\n                return JSON.stringify(event,null,4)\n        }\n    }\n\n    return (\n        <div className=\"w-full text-black  bg-gray-600 overflow-hidden shadow-lg flex flex-grow flex-col\" style={{minHeight:280, overflow:\"auto\"}}> \n            <div className=\"flex flex-row text-xs font-semibold p-4 bg-gray-400\">\n                    <div className=\"flex flex-grow\">{`${e.id} (${e.data.type})`} </div>\n                    <div onClick={()=>e.toggleTree(e.id)} className=\"flex\">tree</div>\n            </div> \n            <div className=\"flex justify-center flex-grow\">\n                {renderEvent({...e.data, ready:e.ready||false})}\n            </div>\n        </div>\n    );\n}\n\nexport default Layer;","import {selectLayerName} from './experienceSlice';\nimport { useSelector } from 'react-redux';\n\nconst Navigation = ({ start, authored, toggleCreate, toggleUploadMedia, twineExport, renderSpeech, rendering}) => {\n  \n  const layerName = useSelector(selectLayerName);\n\n  const renderAuthored = ()=>{\n    return authored.map(a=>{\n      const textWeight = layerName==a ? \"font-bold\" : \"font-normal\"; \n      return <a key={a} className={`p-2 text-white ${textWeight} text-xs`} style={{opacity:layerName==a?1:0.6}} href={encodeURI(`?layers=${a}`)}>{a}</a>\n    })\n  }\n    return <nav className=\"flex items-center flex-wrap bg-teal-500 p-1\">\n      <div className=\"flex items-center text-white\">   \n        <svg width=\"66\" height=\"42\" viewBox=\"0 0 33 21\" style={{fillRule:\"evenodd\",clipRule:\"evenodd\",strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeMiterlimit:\"1.5\"}}>\n          <path d=\"M1.425,11.233c1.484,-2.368 3.867,-5.752 8.591,-8.263c4.267,-2.268 9.378,-2.597 10.538,-2.634c11.581,-0.375 11.745,9.075 11.758,9.983c0.149,2.891 -0.988,5.991 -2.709,6.365c-2.557,0.556 -5.645,0.675 -8.484,0.823c-0,-0 -0.485,-2.705 -3.147,-2.523c-3.078,0.211 -3.057,2.749 -3.057,2.749l-5.478,0.034c-3.169,-0.217 -6.251,-0.923 -9.112,-2.878c0.099,-1.076 0.424,-2.577 1.1,-3.656Z\"  style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M18.03,16.213c1.187,0 2.15,0.921 2.15,2.056c0,1.135 -0.963,2.056 -2.15,2.056c-1.187,0 -2.151,-0.921 -2.151,-2.056c-0,-1.135 0.964,-2.056 2.151,-2.056Zm-0,1.273c0.452,-0 0.819,0.351 0.819,0.783c0,0.433 -0.367,0.784 -0.819,0.784c-0.453,-0 -0.82,-0.351 -0.82,-0.784c-0,-0.432 0.367,-0.783 0.82,-0.783Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n          <path d=\"M3.191,11.01c-0,0 5.163,-9.036 17.356,-9.416c10.119,-0.316 10.542,8.541 10.542,8.541c-0.983,0.081 -1.454,0.569 -1.498,0.911c-0.093,0.724 0.607,1.131 1.224,1.14c-0.301,1.964 -0.921,2.796 -2.169,3.24c-1.608,0.572 -6.789,0.413 -6.789,0.413c-0,-0 -0.524,-2.554 -3.759,-2.522c-2.696,0.027 -3.614,2.85 -3.614,2.85c-4.652,0.473 -8.768,-0.024 -12.101,-1.954c0.019,-0.386 0.149,-0.733 0.372,-1.045c-0,-0 1.62,-0.073 1.658,-1.111c0.035,-0.959 -1.222,-1.047 -1.222,-1.047Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M21.831,5.29c0.027,-0.872 0.996,-1.574 2.185,-1.574c1.207,0 2.186,0.723 2.186,1.612c0,0.051 -0.003,0.101 -0.009,0.151l0.297,7.926l-4.358,0.089l-0.317,-8.204l0.016,0Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.68}}/>\n          <ellipse cx=\"24.137\" cy=\"6.687\" rx=\"1.042\" ry=\"1.013\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.54}}/>\n          <path d=\"M17.87,5.83c-0.004,-0.204 -0.147,-0.367 -0.319,-0.363c-1.828,-0.053 -3.673,-0.044 -5.557,0.109c-0.172,0.003 -0.309,0.171 -0.305,0.375c0.092,0.837 0.1,1.693 0.051,2.564c0.004,0.203 0.147,0.366 0.319,0.363c1.87,-0.146 3.715,-0.137 5.557,-0.11c0.172,-0.003 0.308,-0.171 0.304,-0.375c-0.045,-0.854 -0.062,-1.709 -0.05,-2.563Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n        </svg>\n      </div>\n     <div>\n      <span className=\"font-semibold text-xl tracking-tight pl-4 text-white\">\n        Future Mundane\n      </span>\n    </div>\n    \n    <div className=\"w-full block flex-grow lg:flex lg:items-center lg:w-auto pl-10\">\n      <div className=\"text-sm lg: flex-grow\">\n        {layerName.trim() != \"\" && <a onClick={start} className=\"block mt-4 lg:inline-block lg:mt-0 text-white  hover:font-bold mr-4\">Start</a>}\n        {layerName.trim() != \"\" && <a target=\"_blank\" href={encodeURI(`/author?layers=${layerName}`)} className=\"block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4\">Edit</a>}\n      </div>\n    </div>\n    <div className=\"flex flex-col\">\n      <div className=\"flex flex-row\">\n        {renderAuthored()}\n      </div>\n      <div className=\"flex flex-row justify-end\">\n        <a className=\"p-2 text-xs font-bold text-white\" onClick={toggleCreate}>upload experience</a>\n        <a className=\"p-2 text-xs font-bold text-white\" onClick={toggleUploadMedia}>upload media</a>\n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={twineExport}>export (twine)</a>} \n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={renderSpeech}>{`${!rendering ? \"render speech\": \"[rendering...]\"}`}</a>}\n      </div>\n    </div>\n  </nav>\n};\n\nexport default Navigation;\n","import {useState} from 'react';\nimport request from 'superagent';\n\nexport function Uploader({close=()=>{}, success=()=>{}}){\n\n    const [error, setError] = useState(\"\");\n    const [file, setFile] = useState();\n\n    const changeHandler = (event) => {\n\t\tsetFile(event.target.files[0]);\n\t};\n\n\tconst handleSubmission = () => {\n        console.log(file);\n        const formData = new FormData(); \n     \n            // Update the formData object \n        formData.append( \n            \"mediaFile\", \n            file,\n            file.name \n        ); \n\n        request.post(\"/media/upload\").send(formData).end(function(err, response) {\n            console.log(err, response);\n            if (!err){\n                setFile(undefined);\n                success(file.name);\n            }\n        });\n\t};\n\n    const renderError = ()=>{\n        return <div className=\"text-red-600 p-4 text-bold justify-center\">{error}</div>\n    }\n    const renderUpload = ()=>{\n        return <div className=\"flex flex-col p-4 items-center\">\n            <input type=\"file\" name=\"file\" onChange={changeHandler} />\n            <div className=\"flex flex-row p-4 items-center\">\n            {file &&  <div onClick={handleSubmission} className=\"m-2 p-2 bg-blue-500 text-white\">upload</div>}\n            <div onClick={close} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n            </div>\n        </div>\n    }\n    \n    return <div style={{width:350}}>\n        <div className=\"text-center shadow-lg flex flex-col\">\n            {renderUpload()}\n            {error && renderError()}\n        </div>\n        \n    </div>\n}","import {useState} from 'react';\n\n\nexport function TextEntry({close=()=>{}, done=()=>{}}){\n\n   \n    const [text, setText] = useState();\n    \n    return <div className=\"relative flex justify-end\">\n        <div className=\"text-center shadow-lg flex flex-col\" style={{width:400}}>\n            \n                <textarea className=\"border border-black\" rows={4} onChange={e=>setText(e.target.value)} value={text}/>\n                <div className=\"flex flex-row p-4 items-center justify-center\">\n                    <div onClick={()=>done(text)} className=\"m-2 p-2 bg-blue-500 text-white\">set</div>\n                    <div onClick={close} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n                </div>\n        </div>\n        \n    </div>\n}","import request from \"superagent\";\n\nexport function placeholderType(url){\n    if (url.indexOf(\"/image\") != -1){\n        return \"image\";\n    }\n    if (url.indexOf(\"/speech\") != -1){\n        return \"speech\";\n    }\n    return \"\";\n}\n\nexport async function updatePlaceholder (key, value){\n    const {text} = await request.get(\"/placeholders/set\").query({key,value});\n    console.log(JSON.parse(text))\n}","import {useState, useEffect} from 'react';\nimport { placeholderType, updatePlaceholder } from '../../utils';\nimport { Uploader } from \"./Uploader\";\nimport {TextEntry} from \"./TextEntry\";\nimport request from 'superagent';\n\nexport function PlaceholderManager({placeholders={}, close=()=>{}}){\n\n    const [placeholderValues, setPlaceholderValues] = useState({});\n    const [expand, setExpand] = useState({});\n\n    const fetchPlaceHolderValues = async()=>{\n        const {text=\"{}\"} = await request.get(\"/placeholders/\");\n        setPlaceholderValues(JSON.parse(text));\n    }\n\n    useEffect(() => {   \n       fetchPlaceHolderValues();\n    }, []);\n\n    const togglePlaceholders = (value)=>{\n        close();\n    }\n\n    const toggleExpand = (id, value)=>{\n        setExpand({\n                ...expand, \n                [`${id}${value}`] : expand[`${id}${value}`] ? false: true\n        });\n    }\n\n    const _updatePlaceholder= (value, text)=>{\n        updatePlaceholder(value, text);\n        fetchPlaceHolderValues();\n    }\n\n    const renderSpeechPlaceHolder = (value, id)=>{\n        return <div key={value} className=\"flex flex-col pt-2\">\n                    <div onClick={()=>toggleExpand(id, value)} className=\"text-sm text-blue-500\">{`current text: ${placeholderValues[value] || \"[empty]\"}`}</div>\n                     {expand[`${id}${value}`] && <div>\n                        <div className=\"p-4\"> {`set speech for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <TextEntry close={()=>{toggleExpand(id, value)}} done={(text)=>{toggleExpand(id, value); _updatePlaceholder(value, text)}}/>\n                    </div>}\n                </div>\n    }\n\n    const renderImagePlaceHolder = (value, id)=>{\n        return     <div key={value} className=\"flex flex-col pt-2\">\n                        <div onClick={()=>toggleExpand(id, value)} className=\"p-4 text-blue-500\"> {`upload image for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <div className=\"flex justify-center \"><img onClick={()=>toggleExpand(id, value)} className=\"shadow-md\" width=\"250px\"  style={{border: \"4px solid white\"}} src={`assets/${placeholderValues[value]}`}/></div>\n                        {expand[`${id}${value}`] && <div>\n                            <Uploader close={()=>{toggleExpand(id, value)}} success={(name)=>{toggleExpand(id, value); _updatePlaceholder(value, name)}}/>\n                        </div>}\n                    </div>\n    }\n\n    const renderPlaceholder = (url, placeholder, key)=>{\n        const type = placeholderType(url);\n        switch (type){\n            case \"speech\":\n                return renderSpeechPlaceHolder(placeholder,key);\n\n            case \"image\":\n                return renderImagePlaceHolder(placeholder,key);\n        }\n    }\n\n    const renderPlaceholders = (key,placeholders)=>{\n\n        const items = Object.keys(placeholders).map(url=>{\n            return placeholders[url].map(placeholder=>renderPlaceholder(url, placeholder, key));\n        })\n        return <div>\n            <div className=\"uppercase font-semibold\">{key}</div> \n            {items}      \n        </div>\n    }\n\n    const renderList = () => Object.keys(placeholders).map((key)=>{\n        const placeholder = placeholders[key];\n        return <div className=\"p-4\" key={key}>\n                    {renderPlaceholders(key, placeholder)}\n                   \n                </div>\n    });\n\n    return <div  className=\"flex absolute\" style={{top:80, left:0, width:\"100vw\", height:\"calc(100vh - 80px)\", background:\"#ffffff99\"}}>\n        <div className=\"bg-white flex flex-col p-4 shadow-lg\" style={{width:400, overflowY:\"auto\", height:\"calc(100vh - 100px)\"}}>\n            <div onClick={togglePlaceholders} className=\"flex justify-end justify-items-end m-2 p-2 text-black\">\n               <div className=\"flex justify-center items-center bg-gray-600 text-white\" style={{paddingBottom:5, width:20, height:20, borderRadius:10}}>x</div> \n            </div>\n            <div className=\"text-lg font-semibold text-center w-full\">Manage Dynamic Content</div>\n           \n            {renderList()}\n           \n        </div>\n    </div>\n}","import * as React from \"react\";\nimport * as d3 from \"d3\";\nimport * as d3z from \"d3-zoom\";\nimport request from \"superagent\";\nimport {useD3} from '../../hooks/useD3';\nimport { Uploader } from \"./Uploader\";\nimport {TextEntry} from \"./TextEntry\";\nimport {PlaceholderManager} from \"./PlaceholderManager\";\nimport {placeholderType, updatePlaceholder} from \"../../utils\";\n\nlet _seen = {};\n\nconst _flatten = list => list.reduce(\n    (a, b) => a.concat(Array.isArray(b) ? _flatten(b) : b), []\n);\n\n\nconst links = (node)=>{\n   \n    return _flatten([\n      {    \n        links: node.data.links,\n        trigger: node.data.trigger,\n        from : {\n          name:node.data.id,\n          x: _seen[node.data.id].x,\n          y: _seen[node.data.id].y + 60\n        },\n        to : (node.children||[]).map(c=>({trigger:c.data.trigger, name:c.data.id,x:_seen[c.data.id].x, y:_seen[c.data.id].y-60}))\n      },\n      ...(node.children || []).map(c=>links(c))\n    ])\n  }\n\n  const rids = (node)=>{\n        const root = Object.keys(node.data.links || {}).reduce((acc, key)=>{\n            const item = node.data.links[key];\n            return {\n                ...acc,\n                [item.rid]: item\n            }\n        },{})\n  \n        return {\n            ...root,\n            ...(node.children || []).reduce((acc, item)=>{\n                return {\n                    ...acc,\n                    ...rids(item)\n                }\n            },{})\n        }\n  }\n\nconst linkdata = (node)=>{\n    return {...(node.data.links || {}), ...(node.children || []).reduce((acc,item)=>{\n        return {\n            ...acc,\n            ...linkdata(item),\n        }\n    },{})}\n}\n\nconst _clink = (sx, sy, tx, ty) => {\n    return <path d={`M ${sx} ${sy} C ${(sx + tx) / 2} ${sy}, ${(sx + tx) / 2} ${ty}, ${tx} ${ty}`} style={{stroke:\"#000\", strokeWidth:\"2\", fill:\"none\"}}></path> \n}\n\nconst _loopback = (sx, sy, tx, ty) =>{\n    //(link.from.y + (l.y-link.from.y)/2)\n    \n    return <path d={`M ${sx} ${sy} C ${(sx)} ${sy+60}, ${(sx-120) } ${ty+60}, ${tx} ${ty}`} style={{stroke:\"#444\", strokeWidth:\"1\", fill:\"none\"}}></path> \n}\n\nconst isloopback = (l)=>{\n    \n    const result = l.from.y > l.to.y;\n    return result;\n  }\n  \n\nconst findNode = (t, name)=>{\n\n    if ((t.data || {}).name == name){\n        return t;\n    }\n\n    if ((t.children || []).length <= 0){\n        return null;\n    }\n    \n    //search children\n\n    let node = null;\n    for (let i = 0; i < t.children.length; i++){\n        node = findNode(t.children[i], name);\n        if (node != null){\n            break;\n        }\n    }\n    return node;\n}\n\nconst recenter = (gtree,t)=>{\n    const g = d3.select(gtree.current);\n    const {x,y} = _seen[t.id] || {x:0, y:0};\n    let mx = 0, my=0;\n    const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n    if (moustrans){\n        [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n    }\n    g.attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n}\n\n\nfunction Tree(t) {\n  \n      \n    const gtree = React.useRef();\n    \n    // to toggle showing the placeholder dialogue\n    const [placeholderVisible, setPlaceholderVisible] = React.useState(false);\n\n    // to toggle the main placeholder management screen on and off\n    const [placeholderManagementVisible, setPlaceholderManagementVisible] = React.useState(false);\n    \n    //record the placeholders for the currently selected node\n    const [selectedPlaceholders, setSelectedPlaceholders] = React.useState({}); //placeholders that have been found for a selected node.\n\n    //all of the placeholders in this tree, indexed by node id\n    const [allPlaceholders, setAllPlaceholders] = React.useState({});\n    \n    const [placeholderValues, setPlaceholderValues] = React.useState({}); //placeholders that have been found in the text\n\n\n    const moveChart = ()=>{\n        const g = d3.select(gtree.current);\n        let {x,y} = _seen[t.id] || {x:0,y:0};\n        let mx = 0, my=0;\n        const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n        if (moustrans){\n            [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n        }\n        g.transition().duration(2000).attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n    }\n\n    //recursively get all placeholders from this tree\n    const extractPlaceholders = (node)=>{\n        if (Object.keys(node.data.placeholders||{}).length > 0){\n            return {\n                        [node.data.id]:node.data.placeholders, \n                        ...(node.children || []).reduce((acc, item)=>{\n                            return {...acc, ...extractPlaceholders(item)}\n                        },{})\n            }\n        }else{\n            if ((node.children || []).length > 0){\n                return node.children.reduce((acc, item)=>{\n                    return {...acc, ...extractPlaceholders(item)}\n                },{})\n            }\n            return {};\n        }\n    }\n\n\n    const fetchPlaceHolderValues = async()=>{\n        const {text=\"{}\"} = await request.get(\"/placeholders/\");\n        setPlaceholderValues(JSON.parse(text));\n        setAllPlaceholders(extractPlaceholders(t));\n    }\n\n    React.useEffect(() => {   \n       fetchPlaceHolderValues();\n    }, []);\n\n    React.useEffect(() => {\n        moveChart();\n    }, [t]);\n    \n    const mytree = useD3((svg) => {\n        \n       const dgbox = svg.select(\"g#dragbox\");\n       \n         svg.call(d3z.zoom().on(\"zoom\",  (e)=>{\n            const {x,y} = e.transform;\n            dgbox.attr(\"transform\", `translate(${x},${y})`)\n        }))\n        //svg.call(d3z.zoom, d3z.zoomIdentity.scale(0.8).translate([x,y]))\n\n    }, []);\n\n    const renderLinks = (links, data)=>{\n        const seenlinks = {};\n   \n\n        return links.map((link)=>{\n          \n            return link.to.map((l)=>{\n           \n           \n                if (seenlinks[`${link.from.name},${l.name}`]){\n                    return <g></g>\n                }else{    \n                    seenlinks[`${link.from.name},${l.name}`]= true;\n                //const labeldata = data[`${link.from.name}->${l.name}`] || [];\n                const tx = (l.x-link.from.x)/2;\n                const ty = (Math.max(l.y,link.from.y)-Math.min(l.y,link.from.y))/2;\n                const anchor = \"middle\";//tx == 0 ? \"middle\" : tx < 0 ? \"end\": \"start\";\n                \n            \n                const labeldata = data[l.trigger];\n\n                \n                const mx = 20 + (labeldata.actions.length - 1) * 20;\n\n               \n                const label = labeldata.actions.map((ld,i)=>{\n                    \n                    return <text key={ld.map(a=>a.action).join(\",\")} fontSize=\"x-small\" textAnchor={\"middle\"} x={l.y+60} y={l.x-mx + (i*18)} > {[...new Set(ld.map(l=>l.action))].join(',')}</text>\n                });\n\n                const {rule={}} = labeldata;\n                const operator = rule.operator || \"\";\n                const operand =  rule.operand || [];\n                const rulelabel = `${operator}, ${operand}`;\n                const renderText = ()=>{\n                    if (isloopback({from:link.from, to:l})){\n                       return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"#000\" opacity=\"0.5\" textAnchor={anchor} y={link.from.x+tx-5+70} x={(link.from.y + (l.y-link.from.y)/2)}>{rulelabel}</text>\n                    }\n                   return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"black\" textAnchor={anchor} y={link.from.x+tx-5} x={(link.from.y+ty)}>{rulelabel}</text>\n                }\n\n                const ruletext =    <g>\n                                        <rect x={link.from.y-20+ty} y={link.from.x-13+tx} width={40} height={12} style={{fill: \"#edf2f7\"}}/>\n                                       {renderText()}\n                                    </g>\n\n\n                return <g key={`${l.x},${l.y}`}>\n                            {isloopback({from:link.from, to:l}) ? _loopback(link.from.y, link.from.x, l.y, l.x) : _clink(link.from.y, link.from.x, l.y, l.x)}\n                            {ruletext}\n                            {label}\n                            \n                       </g>\n                }\n\n            });\n           //return link.to.map((l)=><path d={_clink(link.from.x, link.from.y,l.x, l.y)} stroke=\"#D1D1D1\" fill=\"none\"/>);\n        });\n    }\n\n    const togglePlaceholders = async (placeholders={})=>{\n        await fetchPlaceHolderValues();\n        setSelectedPlaceholders(placeholders)\n        setPlaceholderVisible(!placeholderVisible);\n    }\n\n    const toggleShowPlaceHolderManagement = ()=>{\n        setPlaceholderManagementVisible(!placeholderManagementVisible);\n    }\n\n  \n\n    const renderSpeechPlaceHolder = (value)=>{\n        return <div className=\"flex flex-col justify-center items-center\">\n                    <div className=\"text-sm\">{placeholderValues[value]}</div>\n                    <div className=\"p-4\"> {`set speech for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                    <TextEntry close={togglePlaceholders} done={(text)=>{togglePlaceholders(); updatePlaceholder(value, text)}}/>\n                </div>\n    }\n\n    const renderImagePlaceHolder = (value)=>{\n        return     <div className=\"flex flex-col justify-center items-center\">\n                        <div className=\"p-4\"> {`upload image for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <div><img className=\"shadow-lg\" style={{border:\"5px solid white\"}} width=\"350px\" src={`assets/${placeholderValues[value]}`}/></div>\n                        <Uploader close={togglePlaceholders} success={(name)=>{togglePlaceholders(); updatePlaceholder(value, name)}}/>\n                    </div>\n    }\n\n    const renderPlaceholder  = (key, value)=>{\n\n        const renderType = (key,value)=>{\n            switch (placeholderType(key)){\n                case \"speech\":\n                    return renderSpeechPlaceHolder(value)\n                case \"image\":\n                    return renderImagePlaceHolder(value);\n                default:\n                    return;\n            }\n        }\n\n        return  <div onClick={togglePlaceholders} className=\"flex absolute justify-center items-center\" style={{top:0, left:0, width:\"100vw\", height:\"100vh\", background:\"#ffffff99\"}}>\n            <div onClick={(e)=>e.stopPropagation()}className=\"flex bg-white rounded shadow-lg border-4 border-gray-300 p-6\">\n                {renderType(key,value)}\n            </div>\n        </div>\n    }\n\n    //render the placeholders for a particular node\n    const renderPlaceholders = ()=>{\n      return  Object.keys(selectedPlaceholders).map(key=>{\n        return renderPlaceholder(key, selectedPlaceholders[key]);\n      })\n    }\n\n   \n\n    const renderTree = (node,selected,rid, handleClick)=>{\n       \n\n        let paint = false;\n       \n        if (_seen[node.data.id].x !== node.x || _seen[node.data.id].y != node.y){\n            return;\n        }\n        \n        if (!rid){\n            paint = selected==node.data.id;// && node.children && node.children.length > 0;\n        }else{\n            paint = selected===node.data.id;// && node.data.trigger == rid;\n        }\n\n        const {placeholders={}} = node.data;\n       \n        const show = Object.keys(placeholders).length > 0;\n       \n\n        return <g key={`${node.x},${node.y}`}> \n                    <rect onClick={()=>handleClick(node.data.id)} x={node.y-60} y={node.x-10} width={120} height={20} rx={10} style={{fill: paint ? \"#4299e1\":\"white\", stroke:\"black\"}}/>\n                    <text onClick={()=>handleClick(node.data.id)} textAnchor=\"middle\" fontSize=\"x-small\"  x={node.y} y={node.x+4}>{node.data.name}</text>\n                    {show && <circle onClick={()=>togglePlaceholders(placeholders)} cx={node.y} cy={node.x-30} r={10} fill=\"#E91475\" stroke=\"#000\"/>}\n                    {(node.children || []).map(n=>renderTree(n, selected, rid,handleClick))}\n            </g>\n\n        \n    }\n\n    _seen = {};\n\n    const generatecoords = (node)=>{\n        if (!_seen[node.data.id]){\n            _seen[node.data.id] = {x:node.x, y:node.y};\n            (node.children || []).map(n=>generatecoords(n))\n        }\n    }\n\n    generatecoords(t);\n\n    return <div className=\"text-black bg-gray-200 rounded bg-white overflow-hidden shadow-lg\"> \n        <svg ref={mytree} height={t.height} style={{width:`calc(100vw - 280px)`}}>\n            <circle onClick={()=>{recenter(gtree,t)}} cx={50} cy={50} r=\"10\" fill=\"white\" strokeWidth={2} stroke=\"#000\"></circle>\n            <circle onClick={()=>{recenter(gtree,t)}} cx={50} cy={50} r=\"5\" fill=\"white\" strokeWidth={2} stroke=\"#000\"></circle>\n            <text onClick={()=>{recenter(gtree,t)}}  textAnchor=\"middle\" fontSize=\"x-small\"  x={50} y={80}>recenter</text>\n\n            <circle onClick={toggleShowPlaceHolderManagement} cx={130} cy={50} r=\"10\" fill=\"#E91475\" strokeWidth={2} stroke=\"#000\"></circle>\n            <text onClick={toggleShowPlaceHolderManagement}  textAnchor=\"middle\" fontSize=\"x-small\"  x={130} y={80}>placeholders</text>\n            <g ref ={gtree} transform={`translate(120,${t.height/2})`}>\n                <g id=\"dragbox\"> \n                    {renderLinks(links(t), rids(t))}\n                    {renderTree(t, t.id, t.triggered, t.handleClick)}\n                </g>\n            </g>   \n        </svg>\n        {placeholderVisible && renderPlaceholders()}\n        {placeholderManagementVisible && <PlaceholderManager placeholders={allPlaceholders} close={toggleShowPlaceHolderManagement}/>}\n    </div>\n }\n \n export default Tree;","import React from 'react';\nimport * as d3 from 'd3';\n\nexport const useD3 = (d3Fn, dependencies) => {\n    const ref = React.useRef();\n\n    React.useEffect(() => {\n        d3Fn(d3.select(ref.current));\n        return () => {};\n      }, dependencies);\n    return ref;\n}","import { useState, useEffect } from 'react';\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height\n  };\n}\n\nexport default function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return windowDimensions;\n}\n","import {useState} from 'react';\nimport {useDispatch } from 'react-redux';\nimport {fetchAuthored} from './experienceSlice';\n\nexport function Importer({save, cancel}){\n    const dispatch = useDispatch();\n    const [json, setJSON] = useState({});\n    const [error, setError] = useState(\"\");\n    const [name, setName] = useState(\"\");\n    const [selectedFile, setSelectedFile] = useState();\n\n    const changeHandler = (event) => {\n\t\tsetSelectedFile(event.target.files[0]);\n\t};\n\n\tconst handleSubmission = () => {\n        const fileReader = new FileReader();\n        fileReader.readAsText(selectedFile, \"UTF-8\");\n        fileReader.onload = e => {\n            try{\n                setJSON(JSON.parse(e.target.result))\n            }catch(err){\n\n            }\n        };\n\t};\n\n    const importIt = async ()=>{\n        try {\n            \n            setError(\"\");\n            if (name.trim()==\"\"){\n                setError(\"Please provide a name for this file\");\n                return;\n            }\n            await save(name,json);\n            dispatch(fetchAuthored());\n        }catch(err){\n            setError(\"Error with JSON file, please correct and try again\")\n        }\n    }\n\n    const renderError = ()=>{\n        return <div className=\"text-red-600 p-4 text-bold justify-center\">{error}</div>\n    }\n    const renderUpload = ()=>{\n        return <div className=\"flex flex-row p-4 items-center\">\n            <input type=\"file\" name=\"file\" onChange={changeHandler} />\n            {selectedFile &&  <div onClick={handleSubmission} className=\"m-2 p-2 bg-blue-500 text-white\">upload</div>}\n            <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n        </div>\n    }\n    \n    const renderName = ()=>{\n        return   <div className=\"flex flex-col text-center p-4 items-center justify-center\">\n                    <input value={name} onChange={(e)=>setName(e.target.value)} type=\"text\" placeholder=\"give it a name\" className=\"w-64 p-2 bg-gray-400\"></input>\n                    <div className=\"flex flex-row justify-center items-center\">\n                        <div onClick={importIt} className=\"m-2 p-2 bg-blue-500 text-white\">IMPORT!</div>\n                        <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n                    </div>\n                </div>\n    }\n\n    return <div className=\"relative flex justify-end\">\n        <div className=\"text-center shadow-lg flex flex-col\">\n            {Object.keys(json).length > 0 && renderName()}\n            {Object.keys(json).length <= 0 && renderUpload()}\n            {error && renderError()}\n        </div>\n        \n    </div>\n}","import React, {useEffect, useState} from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Layer from './Layer';\nimport Navigation from './Navigation';\nimport Tree from './Tree';\nimport useWindowDimensions from '../../hooks/useWindowDimensions';\nimport { Importer } from './Importer';\nimport { Uploader } from './Uploader';\nimport request from 'superagent';\nimport superagent from 'superagent';\n\nimport {\n    listenOnEvents,\n    listenOnActions,\n    fetchLayers,\n    selectEvents,\n    selectAuthored,\n    selectReadyForInput,\n    selectLayerName,\n    selectRendering,\n    selectTrees,\n    reset,\n    fetchAuthored,\n    manualTrigger,\n    renderSpeech,\n} from './experienceSlice';\n\nexport function Experience() {\n  const events = useSelector(selectEvents);\n  const readyforinput = useSelector(selectReadyForInput);\n  const trees = useSelector(selectTrees);\n  const authored = useSelector(selectAuthored);\n  const layerName = useSelector(selectLayerName);\n  const rendering = useSelector(selectRendering);\n  const [visibleTrees, setVisibleTrees] = useState({});\n  const [create, setCreate] = useState(false);\n  const [upload, setUpload] = useState(false);\n\n  const { height } = useWindowDimensions();\n\n  const dispatch = useDispatch();\n\n\n  const proxyRecognition = ()=>{\n    return {\n       start : ()=>{}\n    }\n  }\n\n  \n  const toggleCreate = (value)=>{\n    if (value != undefined){\n      setCreate(value);\n    }else{\n      setCreate(!create);\n    }\n  }\n\n  const toggleUploadMedia = (value)=>{\n    if (value != undefined){\n      setUpload(value);\n    }else{\n      setUpload(!upload);\n    }\n  }\n\n\n  const [startLabel, setStartLabel] = useState(\"start\");\n  \n  //const _fetchLayers = (layer)=>{\n  //  dispatch(fetchLayers(layer, recognition));\n //}\n\n  useEffect(() => {\n    const BrowserSpeechRecognition =\n    typeof window !== 'undefined' &&\n    (window.SpeechRecognition ||\n      window.webkitSpeechRecognition ||\n      window.mozSpeechRecognition ||\n      window.msSpeechRecognition ||\n      window.oSpeechRecognition)\n    const recognition = BrowserSpeechRecognition ? new BrowserSpeechRecognition() : proxyRecognition();\n    recognition.continous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n\n    dispatch(fetchAuthored());\n    dispatch(listenOnEvents());\n    dispatch(listenOnActions(window));\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const params = Object.fromEntries(urlSearchParams.entries());\n    const {layers=null} = params;\n    if (layers){\n      dispatch(fetchLayers(layers, recognition))\n    }\n  }, []); //only re-run the effect if new message comes in\n\n  const toggleTree = (id)=>{\n    setVisibleTrees({...visibleTrees, [id]:!(visibleTrees[id]||false)})\n  }\n\n  const handleClick = (layer, node)=>{\n    dispatch(manualTrigger(layer,node));\n  }\n \n\n  const expandedtrees = Object.keys(visibleTrees).reduce((acc,key)=>{\n    if (visibleTrees[key]== true)\n      return acc + 1;\n    return acc;\n  },0)\n\n  const minimised = events.length - expandedtrees;  \n  const th = ((height - 54 - (minimised > 0 ? 280 :0)) / expandedtrees) - events.length*4;\n\n  const list = events.sort((e1, e2)=>{\n      if (visibleTrees[e1.id] && !visibleTrees[e2.id])\n        return -1;\n      if (visibleTrees[e2.id] && !visibleTrees[e1.id])\n        return 1;\n      return 0;\n\n  }).map((e,i)=>{\n\n    return  <div key = {e.id} className=\"flex flex-row m-1\">\n              <div  className=\"flex w-64 justify-center overflow-visible\" style={{height:visibleTrees[e.id] ? th-2: 280}}>\n                <Layer {...{...e, ready:readyforinput[e.id]||false, toggleTree}} />\n              </div>\n            { visibleTrees[e.id]  && <Tree {...{...trees[e.id], handleClick:(node)=>{handleClick(e.id, node)}, height:th, id:e.data.id, triggered:e.triggered}}/>}\n          </div>  \n  });\n\n  //const forest = trees.map((t,i)=><Tree key={i} {...t}/>);\n\n  const resetExperience = ()=>{\n     dispatch(reset());\n     setStartLabel(\"reset\");\n  }\n  const save = async (name, json)=>{\n    await request.post('/author/save').set('Content-Type', 'application/json').send({name,layer:json});\n    toggleCreate(false);\n  }\n\n  const exportTwine = ()=>{\n    superagent.get('/author/translate').query({name:layerName}).then(res => {\n      const {html} = res.body;\n      const htmlString = `data:text/html;chatset=utf-8,${encodeURIComponent(html)}`;\n      const link = document.createElement(\"a\");\n      link.href = htmlString;\n      link.download = `${layerName}.html`;\n      link.click();\n   })\n  }\n\n  const _renderSpeech = ()=>{\n    dispatch(renderSpeech());\n  }\n\n  //importer imports twine!\n  return (\n      <div>\n        <Navigation rendering={rendering} authored={authored} start={resetExperience} toggleCreate={toggleCreate} toggleUploadMedia={toggleUploadMedia} twineExport={exportTwine} renderSpeech={_renderSpeech}/>\n        <div className=\"flex row mb-4 border-b-2 flex-wrap\" >\n          {list}\n        </div>\n        {create &&  <div className=\"absolute right-0\" style={{top:80}}><Importer save={(name,json)=>save(name,json)} cancel={()=>toggleCreate(false)}/></div>}\n        {upload && <div className=\"absolute right-0\" style={{top:80}}><Uploader close={()=>toggleUploadMedia(false)}/></div>}\n      </div>\n  );\n  \n}\n","import React from 'react';\r\nimport {Experience} from './features/experience/Experience';\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <Experience/>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { configureStore } from '@reduxjs/toolkit';\r\nimport experienceReducer from '../features/experience/experienceSlice';\r\n\r\nexport default configureStore({\r\n  reducer: {\r\n    experience: experienceReducer,\r\n  },\r\n});\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './assets/main.css'\r\nimport App from './App';\r\nimport store from './app/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}