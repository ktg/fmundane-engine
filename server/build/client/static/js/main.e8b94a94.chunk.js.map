{"version":3,"sources":["features/experience/Buttons.js","features/experience/experienceSlice.js","features/experience/Speech.js","features/experience/Webhook.js","features/experience/Layer.js","features/experience/Navigation.js","hooks/useD3.js","features/experience/Uploader.js","features/experience/TextEntry.js","utils/index.js","features/experience/PlaceholderManager.js","features/experience/Tree.js","hooks/useWindowDimensions.js","features/experience/Importer.js","features/experience/Experience.js","App.js","app/store.js","serviceWorker.js","index.js"],"names":["Buttons","ready","names","handleAction","buttons","map","b","onClick","className","socket","io","window","location","href","experienceSlice","createSlice","name","initialState","layers","events","readyforinput","transcript","lastsenttranscript","authored","layerName","listening","rendering","reducers","setAuthored","state","action","payload","setLayerName","setLayers","setEvents","setEvent","filter","l","id","setTranscript","layerid","setReadyForInput","setListening","sentTranscript","resetReadiness","setRendering","actions","reset","dispatch","superagent","get","then","res","body","catch","err","console","log","listenOnActions","on","renderSpeech","getState","experience","query","listenOnEvents","event","layer","type","setTimeout","connect","buttonPressed","end","manualWebhook","trigger","manualTrigger","node","sendTranscript","Object","keys","key","speech","trim","fetchAuthored","alist","fetchLayers","r","trees","et","tree","selectEvents","sort","a","selectReadyForInput","selectSpeech","selectTrees","reduce","acc","item","d3","nodeSize","d","children","selectAuthored","selectLayerName","selectRendering","Speech","rules","handleChange","useState","words","setWords","_handleChange","value","_handleAction","useSelector","style","height","operands","rule","operand","o","next","length","onChange","e","target","placeholder","renderOperands","Webhook","webhooks","w","Layer","useDispatch","minHeight","overflow","data","toggleTree","JSON","stringify","renderEvent","Navigation","start","toggleCreate","toggleUploadMedia","twineExport","width","viewBox","fillRule","clipRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","fill","stroke","strokeWidth","cx","cy","rx","ry","encodeURI","textWeight","opacity","useD3","d3Fn","dependencies","ref","React","useRef","useEffect","current","Uploader","close","success","error","file","setFile","changeHandler","files","handleSubmission","formData","FormData","append","fetch","method","headers","TextEntry","done","text","setText","rows","placeholderType","url","indexOf","updatePlaceholder","request","parse","PlaceholderManager","placeholders","placeholderValues","setPlaceholderValues","expand","setExpand","fetchPlaceHolderValues","toggleExpand","_updatePlaceholder","renderPlaceholder","border","src","renderImagePlaceHolder","renderPlaceholders","items","top","left","background","overflowY","paddingBottom","borderRadius","_seen","_flatten","list","concat","Array","isArray","links","from","x","y","to","c","rids","root","rid","_clink","sx","sy","tx","ty","_loopback","isloopback","recenter","gtree","t","g","mx","my","moustrans","select","attr","split","replace","Tree","placeholderVisible","setPlaceholderVisible","placeholderManagementVisible","setPlaceholderManagementVisible","selectedPlaceholders","setSelectedPlaceholders","allPlaceholders","setAllPlaceholders","extractPlaceholders","transition","duration","moveChart","mytree","svg","dgbox","call","d3z","transform","togglePlaceholders","toggleShowPlaceHolderManagement","stopPropagation","renderSpeechPlaceHolder","renderType","generatecoords","n","textAnchor","fontSize","seenlinks","link","Math","max","min","anchor","labeldata","label","ld","i","Set","join","operator","rulelabel","ruletext","fontWeight","renderLinks","renderTree","selected","handleClick","paint","show","triggered","getWindowDimensions","innerWidth","innerHeight","Importer","save","cancel","json","setJSON","setError","setName","selectedFile","setSelectedFile","fileReader","FileReader","readAsText","onload","result","importIt","Experience","visibleTrees","setVisibleTrees","create","setCreate","upload","setUpload","windowDimensions","setWindowDimensions","handleResize","addEventListener","removeEventListener","useWindowDimensions","undefined","setStartLabel","BrowserSpeechRecognition","SpeechRecognition","webkitSpeechRecognition","mozSpeechRecognition","msSpeechRecognition","oSpeechRecognition","recognition","continous","interimResults","lang","urlSearchParams","URLSearchParams","search","fromEntries","entries","expandedtrees","th","e1","e2","post","set","send","html","htmlString","encodeURIComponent","document","createElement","download","click","App","configureStore","reducer","experienceReducer","Boolean","hostname","match","ReactDOM","render","StrictMode","store","getElementById","navigator","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.e8b94a94.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\n\nfunction Buttons({ready, names, handleAction}) {\n    \n\n      const renderButtons = ()=>{\n            if(ready){\n                  return <div>{buttons}</div>\n            }else{\n                  return <></>;\n            }\n      }\n    const buttons = names.map(b=>{\n       \n          return   <button key={b} onClick={()=>handleAction(b)} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">{b}</button>\n         \n    });\n    \n    return renderButtons();\n }\n \n export default Buttons;","import { compose, createSlice } from '@reduxjs/toolkit';\nimport io from 'socket.io-client';\nimport superagent from 'superagent';\nimport * as d3 from 'd3-hierarchy';\n\n//import Layer from './Layer';\n\nconst socket = io(window.location.href);\n\n\nexport const experienceSlice = createSlice({\n  name: 'experience',\n  \n  initialState: {\n    layers: [],\n    events: [],\n    readyforinput: {},\n    transcript: \"\",\n    lastsenttranscript:\"\",\n    authored:[],\n    layerName:\"\",\n    listening: {},\n    rendering:false,\n  },\n\n  reducers: {\n    setAuthored : (state, action)=>{\n      state.authored = action.payload;\n    },\n    setLayerName : (state, action)=>{\n      state.layerName = action.payload;\n    },\n    setLayers : (state, action)=>{\n      state.layers = action.payload;\n    },\n    setEvents: (state, action)=>{\n      state.events = action.payload;\n    },\n    setEvent: (state, action) => {\n      state.events = [...state.events.filter(l=>l.id !== action.payload.id), action.payload];\n    },\n    setTranscript: (state, action)=>{\n      const {transcript, layerid} = action.payload;\n      state.transcript = transcript;\n    },\n    setReadyForInput: (state,action)=>{\n      state.readyforinput = {\n        ...state.readyforinput, ...action.payload\n      }\n    },\n    setListening: (state, action)=>{\n      const {layerid, listening} = action.payload;\n      state.listening = {\n        ...state.listening,\n        [layerid] : listening\n      }\n    },\n    sentTranscript: (state)=>{\n      state.lastsenttranscript = state.transcript;\n    },\n    resetReadiness: (state)=>{\n      state.readyforinput = {};\n    },\n    setRendering: (state,action)=>{\n      state.rendering = action.payload;\n    }\n  }\n});\n\nexport const { setRendering, setLayers, setLayerName, setEvent, setListening, setEvents, setTranscript,sentTranscript,setReadyForInput,setAuthored,resetReadiness} = experienceSlice.actions;\n\nexport const reset = (layerid=\"\")=>dispatch=>{\n  superagent.get('/event/start').then(res => {\n    dispatch(resetReadiness());\n    dispatch(setEvents(res.body));\n    dispatch(setTranscript({transcript:\"\", layerid}));\n  \n })\n .catch(err => {\n   console.log(\"error resetting events\", err);\n    // err.message, err.response\n });\n}\n\nconst delay = (ms) =>{\n  return new Promise((resolve, reject)=>{\n    setTimeout(()=>{\n      resolve()\n    }, ms);\n  });\n}\n\n\n//TODO - get rid - this is to react to browser speech synth, which not using now\n\nexport const listenOnActions = (window) => async dispatch => {\n  //const voices = await getVoices();\n\n  socket.on('action', async actions => {\n\n  \n  for (const payload of actions){\n  \n  \n    /*if (payload.type===\"browserspeech\"){\n      for (const sentence of payload.data.speech){\n        _talking = true;\n       // recognition.stop();\n        await sayWords(window, sentence.words,voices[1]);//51\n        if (sentence.delay){\n          await delay(sentence.delay);\n        }\n      }\n     _talking = false;\n     try{\n     \n      //recognition.start();\n    }catch(err){\n     \n    }\n      //window.speechSynthesis.speak(new SpeechSynthesisUtterance(payload.data.words));\n    }\n   */\n  }\n });\n}\n\nexport const renderSpeech = ()=> async (dispatch, getState)=>{\n  const name = getState().experience.layerName;\n  dispatch(setRendering(true));\n  await superagent.get(\"/author/render\").query({name});\n  dispatch(setRendering(false));\n}\n\nexport const listenOnEvents = () => (dispatch, getState) => {\n\n\n  socket.on('event', payload => {\n    dispatch(setTranscript({transcript:\"\"}));\n    dispatch(setListening({layerid: payload.id, listening:false}));\n    dispatch(setEvent(payload));\n  });\n\n  socket.on('ready', payload=>{\n    //TODO: get layerid from event!\n    const {event, layer} = payload;\n   \n    dispatch(setTranscript({transcript:\"\"}));\n    console.log(\"setting ready for inout\", event, layer);\n    dispatch(setReadyForInput({[layer]:true}));\n\n    if (event.type===\"speech\"){\n      dispatch(setListening({layerid: layer, listening:true}));\n    }\n  });\n}\n\nsocket.on(\"connect_error\", () => {\n  const reconnect = ()=>{\n    console.log(\"attempting to reconnect!!\");\n    setTimeout(() => {\n      socket.connect();\n    }, 1000);\n  }\n  reconnect();\n});\n\nexport const buttonPressed  = (b, layerid) => (dispatch)=>{\n  console.log(\"button pressed!!\", b, layerid);\n  dispatch(setReadyForInput({[layerid]:false}));\n  superagent.get(\"/event/press\").query({name:b, layer:layerid}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\nexport const manualWebhook  = (b, layerid) => ()=>{\n  superagent.get(\"/event/webhook\").query({trigger:b}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\nexport const manualTrigger = (layer, node)=>()=>{\n  superagent.get(\"/event/trigger\").query({layer,node}).end((err, res) => {\n    if (err){\n        console.log(err);\n    }   \n  });\n}\n\n//TOD0 - only listen if any of the current events are listening events.\n//on server only subscibe to current events rather than all!!\n\nexport const sendTranscript = () => (dispatch, getState) =>{\n   \n    const {transcript} = getState().experience;\n    const layers = getState().experience.listening\n\n    const sendTranscript = async ()=>{\n      for (const key of Object.keys(layers)){\n        if (layers[key]){    \n          await superagent.get(\"/event/speech\").query({layer:key, speech:getState().experience.transcript})\n          dispatch(sentTranscript());      \n        }\n      }\n      dispatch(setTranscript({transcript:\"\"}));\n    }\n    \n    if (transcript.trim() !== \"\"){\n      sendTranscript();\n    }\n};\n\nexport const gestureObserved = (g,layerid)=> (dispatch, getState) =>{\n  //stopListening();\n  superagent.get(\"/event/gesture\").query({gesture:g}).end((err, res)=>{});\n  //dispatch(setEvent({}));\n}\n\nexport const fetchAuthored = ()=>(dispatch)=>{\n  superagent.get('/author/authored').then(res => {\n    const alist = res.body.layers;\n    dispatch(setAuthored(alist));\n  })\n}\n\n\n\n//this kicks everything off;\n\n//recogniotion cannot know about layer!!\n\nexport const fetchLayers = (layer, r) => (dispatch, getState)=>{\n  \n  superagent.get('/event/layers').query({layer}).then(res => {\n    const trees = res.body.map(et=>({...et.tree, layerid:et.layerid}));\n    console.log(trees);\n    dispatch(setLayerName(layer));\n    dispatch(setLayers(trees));\n  })\n  .catch(err => {\n    console.log(\"error resetting events\", err);\n  });\n}\n\n\nexport const listenToSpeech = () => (dispatch, getState) => {\n  //console.log(\"called listen to speech!\");\n  //startRecognition();\n}\n\n// The function below is called a selector and allows us to select a value from\n// the state. Selectors can also be defined inline where they're used instead of\n// in the slice file. For example: `useSelector((state) => state.counter.value)`\nexport const selectEvents= state => {\n  return  [...(state.experience.events || [])].sort((a,b)=>{\n    if (a.id < b.id) return -1;\n    if (a.id > b.id) return 1;\n    return -1;\n  });\n}\n\n\nexport const selectReadyForInput = state => state.experience.readyforinput;\nexport const selectSpeech= state => state.experience.transcript;\n\n\nexport const selectTrees = state =>  {\n    return state.experience.layers.reduce((acc, item)=>{\n      return {\n          ...acc,\n          [item.layerid] : d3.tree().nodeSize([120, 230])(d3.hierarchy(item, d=>d.children))\n      }\n    },{});\n}\nexport const selectAuthored = state => state.experience.authored;\nexport const selectLayerName = state => state.experience.layerName;\nexport const selectRendering = state => state.experience.rendering;\n\nexport default experienceSlice.reducer;\n","import React, {useState,} from 'react';\nimport { useSelector} from 'react-redux';\n\nimport {\n    selectSpeech,\n} from './experienceSlice';\n\nexport default function Speech({rules, ready, handleAction, handleChange}) {\n \n\n  const [words, setWords] = useState(\"\");\n\n  const _handleChange = (value) =>{\n    handleChange(value);\n    setWords(value);\n  }\n\n  const _handleAction = ()=>{\n    setWords(\"\");\n    handleAction();\n  }\n\n  const renderOperands = ()=>{\n\n    const operands = rules.reduce((acc, item)=>{\n          return [...acc, ...(item.rule.operand || []).map(o=>({\n                operand: o,\n                next: item.next,\n          }))]\n    },[]);\n\n    if (operands.length === 0){\n      return <div className=\"flex flex-col overflow-auto\">\n            <input onChange={(e)=>_handleChange(e.target.value)} value={words} className=\"h-10 pl-2 m-4 rounded\" type=\"text\" placeholder=\"simulate some words\"></input>\n            <button onClick={()=>{_handleAction()}} className=\"bg-blue-500 mr-2 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded\">say it!</button>\n        </div>\n    }else{\n      return  operands.map(b=>{\n            return   <button key={b.operand} onClick={()=>{ _handleChange(b.operand);_handleAction();}} className=\"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 mt-2rounded\">{`${b.operand} (${b.next})`}</button>\n      });\n    }\n}\n\n  const speech = useSelector(selectSpeech);\n\n  return (\n    <div className=\"flex flex-col h-full w-full\">\n      <div style={{height:50}} className=\"flex text-xs font-bold justify-center items-center\">{speech.trim()==\"\" ? \"[listening for speech]\" : `\"${speech}\"`}</div>\n      {ready && <div className=\"p-6 bg-black flex flex-grow flex-col\">\n          <div className=\"font-semibold text-white text-base pb-2\">override</div>\n          {renderOperands()}\n      </div>}\n    </div>  \n  );\n  \n}\n","import React, { useState, useEffect } from 'react';\n\nfunction Webhook({ready, names, handleAction}) {\n    \n\n      const renderWebhooks = ()=>{\n            if(ready){\n                  return <div>{webhooks}</div>\n            }else{\n                  return <></>;\n            }\n      }\n    const webhooks = names.map(w=>{\n       \n          return   <button key={w} onClick={()=>handleAction(w)} className=\"bg-green-500 m-2 text-xs hover:bg-green-700 text-white font-bold py-2 px-4 rounded\">{w}</button>\n         \n    });\n    \n    return renderWebhooks();\n }\n \n export default Webhook;","import Buttons from \"./Buttons\";\nimport Speech from \"./Speech\";\nimport Webhook from \"./Webhook\";\n//import Gesture from \"./Gesture\";\nimport {setTranscript, sendTranscript, buttonPressed, manualWebhook} from './experienceSlice';\nimport {useDispatch } from 'react-redux';\n\nfunction Layer(e) {\n    const {id} = e;\n    const dispatch = useDispatch();\n    const renderEvent = (event)=>{\n\n        switch (event.type){\n            case \"button\":\n                return <Buttons \n                            ready={event.ready} \n                            names={event.data} \n                            handleAction={(b)=>{\n                                dispatch(buttonPressed(b,id));\n                            }}/>\n            case \"speech\":\n                return <Speech  \n                            rules={event.rules} \n                            ready={event.ready} \n                            handleChange={(transcript)=>{\n                               \n                                dispatch(setTranscript({transcript,layerid:id}));\n                            }}\n                            handleAction={()=>{\n                              \n                                dispatch(sendTranscript());\n                            }}/>\n            case \"webhook\":\n                return <Webhook\n                            ready={event.ready} \n                            names={event.data} \n                            handleAction={(b)=>{\n                            dispatch(manualWebhook(b));\n                }}/>\n\n            default:\n                return JSON.stringify(event,null,4)\n        }\n    }\n\n    return (\n        <div className=\"w-full text-black  bg-gray-600 overflow-hidden shadow-lg flex flex-grow flex-col\" style={{minHeight:280, overflow:\"auto\"}}> \n            <div className=\"flex flex-row text-xs font-semibold p-4 bg-gray-400\">\n                    <div className=\"flex flex-grow\">{`${e.id} (${e.data.type})`} </div>\n                    <div onClick={()=>e.toggleTree(e.id)} className=\"flex\">tree</div>\n            </div> \n            <div className=\"flex justify-center flex-grow\">\n                {renderEvent({...e.data, ready:e.ready||false})}\n            </div>\n        </div>\n    );\n}\n\nexport default Layer;","import {selectLayerName} from './experienceSlice';\nimport { useSelector } from 'react-redux';\n\nconst Navigation = ({ start, authored, toggleCreate, toggleUploadMedia, twineExport, renderSpeech, rendering}) => {\n  \n  const layerName = useSelector(selectLayerName);\n\n  const renderAuthored = ()=>{\n    return authored.map(a=>{\n      const textWeight = layerName==a ? \"font-bold\" : \"font-normal\"; \n      return <a key={a} className={`p-2 text-white ${textWeight} text-xs`} style={{opacity:layerName==a?1:0.6}} href={encodeURI(`?layers=${a}`)}>{a}</a>\n    })\n  }\n    return <nav className=\"flex items-center flex-wrap bg-teal-500 p-1\">\n      <div className=\"flex items-center text-white\">   \n        <svg width=\"66\" height=\"42\" viewBox=\"0 0 33 21\" style={{fillRule:\"evenodd\",clipRule:\"evenodd\",strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeMiterlimit:\"1.5\"}}>\n          <path d=\"M1.425,11.233c1.484,-2.368 3.867,-5.752 8.591,-8.263c4.267,-2.268 9.378,-2.597 10.538,-2.634c11.581,-0.375 11.745,9.075 11.758,9.983c0.149,2.891 -0.988,5.991 -2.709,6.365c-2.557,0.556 -5.645,0.675 -8.484,0.823c-0,-0 -0.485,-2.705 -3.147,-2.523c-3.078,0.211 -3.057,2.749 -3.057,2.749l-5.478,0.034c-3.169,-0.217 -6.251,-0.923 -9.112,-2.878c0.099,-1.076 0.424,-2.577 1.1,-3.656Z\"  style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M18.03,16.213c1.187,0 2.15,0.921 2.15,2.056c0,1.135 -0.963,2.056 -2.15,2.056c-1.187,0 -2.151,-0.921 -2.151,-2.056c-0,-1.135 0.964,-2.056 2.151,-2.056Zm-0,1.273c0.452,-0 0.819,0.351 0.819,0.783c0,0.433 -0.367,0.784 -0.819,0.784c-0.453,-0 -0.82,-0.351 -0.82,-0.784c-0,-0.432 0.367,-0.783 0.82,-0.783Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n          <path d=\"M3.191,11.01c-0,0 5.163,-9.036 17.356,-9.416c10.119,-0.316 10.542,8.541 10.542,8.541c-0.983,0.081 -1.454,0.569 -1.498,0.911c-0.093,0.724 0.607,1.131 1.224,1.14c-0.301,1.964 -0.921,2.796 -2.169,3.24c-1.608,0.572 -6.789,0.413 -6.789,0.413c-0,-0 -0.524,-2.554 -3.759,-2.522c-2.696,0.027 -3.614,2.85 -3.614,2.85c-4.652,0.473 -8.768,-0.024 -12.101,-1.954c0.019,-0.386 0.149,-0.733 0.372,-1.045c-0,-0 1.62,-0.073 1.658,-1.111c0.035,-0.959 -1.222,-1.047 -1.222,-1.047Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.65}}/>\n          <path d=\"M21.831,5.29c0.027,-0.872 0.996,-1.574 2.185,-1.574c1.207,0 2.186,0.723 2.186,1.612c0,0.051 -0.003,0.101 -0.009,0.151l0.297,7.926l-4.358,0.089l-0.317,-8.204l0.016,0Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.68}}/>\n          <ellipse cx=\"24.137\" cy=\"6.687\" rx=\"1.042\" ry=\"1.013\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.54}}/>\n          <path d=\"M17.87,5.83c-0.004,-0.204 -0.147,-0.367 -0.319,-0.363c-1.828,-0.053 -3.673,-0.044 -5.557,0.109c-0.172,0.003 -0.309,0.171 -0.305,0.375c0.092,0.837 0.1,1.693 0.051,2.564c0.004,0.203 0.147,0.366 0.319,0.363c1.87,-0.146 3.715,-0.137 5.557,-0.11c0.172,-0.003 0.308,-0.171 0.304,-0.375c-0.045,-0.854 -0.062,-1.709 -0.05,-2.563Z\" style={{fill:\"none\",stroke:\"#fff\",strokeWidth:0.61}} />\n        </svg>\n      </div>\n     <div>\n      <span className=\"font-semibold text-xl tracking-tight pl-4 text-white\">\n        Future Mundane\n      </span>\n    </div>\n    \n    <div className=\"w-full block flex-grow lg:flex lg:items-center lg:w-auto pl-10\">\n      <div className=\"text-sm lg: flex-grow\">\n        {layerName.trim() != \"\" && <a onClick={start} className=\"block mt-4 lg:inline-block lg:mt-0 text-white  hover:font-bold mr-4\">Start</a>}\n        {layerName.trim() != \"\" && <a target=\"_blank\" href={encodeURI(`/author?layers=${layerName}`)} className=\"block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4\">Edit</a>}\n      </div>\n    </div>\n    <div className=\"flex flex-col\">\n      <div className=\"flex flex-row\">\n        {renderAuthored()}\n      </div>\n      <div className=\"flex flex-row justify-end\">\n        <a className=\"p-2 text-xs font-bold text-white\" onClick={toggleCreate}>upload experience</a>\n        <a className=\"p-2 text-xs font-bold text-white\" onClick={toggleUploadMedia}>upload media</a>\n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={twineExport}>export (twine)</a>} \n        {layerName.trim() != \"\" && <a className=\"p-2 text-xs font-bold text-white\" onClick={renderSpeech}>{`${!rendering ? \"render speech\": \"[rendering...]\"}`}</a>}\n      </div>\n    </div>\n  </nav>\n};\n\nexport default Navigation;\n","import React from 'react';\nimport * as d3 from 'd3';\n\nexport const useD3 = (d3Fn, dependencies) => {\n    const ref = React.useRef();\n\n    React.useEffect(() => {\n        d3Fn(d3.select(ref.current));\n        return () => {};\n      }, dependencies);\n    return ref;\n}","import { useState } from 'react';\n\nexport function Uploader({\n\t                         close = () => {\n\t                         }, success = () => {\n\t},\n                         }) {\n\n\tconst [error, setError] = useState('');\n\tconst [file, setFile] = useState();\n\n\tconst changeHandler = (event) => {\n\t\tsetFile(event.target.files[0]);\n\t};\n\n\tconst handleSubmission = () => {\n\t\tconst formData = new FormData();\n\t\t// Update the formData object\n\t\tconsole.log(file)\n\t\tformData.append(\n\t\t\t'mediaFile',\n\t\t\tfile,\n\t\t\tfile.name,\n\t\t);\n\n\t\tfetch('/media/upload', {\n\t\t\tmethod: 'POST',\n\t\t\tbody: formData,\n\t\t\theaders: { 'Content-Type': 'multipart/form-data' }\n\t\t}).then((res) => {\n\t\t\tconsole.log(res)\n\t\t}).catch((err) => {\n\t\t\tconsole.log(err)\n\t\t})\n\t\t// request.post('/media/upload').send(formData).end(function(err, response) {\n\t\t// \tconsole.log('.', err, response);\n\t\t// \tif (!err) {\n\t\t// \t\tsetFile(undefined);\n\t\t// \t\tsuccess(file.name);\n\t\t// \t}\n\t\t// });\n\t};\n\n\tconst renderError = () => {\n\t\treturn <div className='text-red-600 p-4 text-bold justify-center'>{error}</div>;\n\t};\n\tconst renderUpload = () => {\n\t\treturn <div className='flex flex-col p-4 items-center'>\n\t\t\t<input type='file' name='file' onChange={changeHandler} />\n\t\t\t<div className='flex flex-row p-4 items-center'>\n\t\t\t\t{file && <div onClick={handleSubmission} className='m-2 p-2 bg-blue-500 text-white'>upload</div>}\n\t\t\t\t<div onClick={close} className='m-2 p-2 bg-blue-500 text-white'>CANCEL</div>\n\t\t\t</div>\n\t\t</div>;\n\t};\n\n\treturn <div style={{ width: 350 }}>\n\t\t<div className='text-center shadow-lg flex flex-col'>\n\t\t\t{renderUpload()}\n\t\t\t{error && renderError()}\n\t\t</div>\n\t</div>;\n}","import {useState} from 'react';\n\n\nexport function TextEntry({close=()=>{}, done=()=>{}}){\n\n   \n    const [text, setText] = useState();\n    \n    return <div className=\"relative flex justify-end\">\n        <div className=\"text-center shadow-lg flex flex-col\" style={{width:400}}>\n            \n                <textarea className=\"border border-black\" rows={4} onChange={e=>setText(e.target.value)} value={text}/>\n                <div className=\"flex flex-row p-4 items-center justify-center\">\n                    <div onClick={()=>done(text)} className=\"m-2 p-2 bg-blue-500 text-white\">set</div>\n                    <div onClick={close} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n                </div>\n        </div>\n        \n    </div>\n}","import request from \"superagent\";\n\nexport function placeholderType(url){\n    if (url.indexOf(\"/image\") != -1){\n        return \"image\";\n    }\n    if (url.indexOf(\"/speech\") != -1){\n        return \"speech\";\n    }\n    return \"\";\n}\n\nexport async function updatePlaceholder (key, value){\n    const {text} = await request.get(\"/placeholders/set\").query({key,value});\n    console.log(JSON.parse(text))\n}","import {useState, useEffect} from 'react';\nimport { placeholderType, updatePlaceholder } from '../../utils';\nimport { Uploader } from \"./Uploader\";\nimport {TextEntry} from \"./TextEntry\";\nimport request from 'superagent';\n\nexport function PlaceholderManager({placeholders={}, close=()=>{}}){\n\n    const [placeholderValues, setPlaceholderValues] = useState({});\n    const [expand, setExpand] = useState({});\n\n    const fetchPlaceHolderValues = async()=>{\n        const {text=\"{}\"} = await request.get(\"/placeholders/\");\n        setPlaceholderValues(JSON.parse(text));\n    }\n\n    useEffect(() => {   \n       fetchPlaceHolderValues();\n    }, []);\n\n    const togglePlaceholders = (value)=>{\n        close();\n    }\n\n    const toggleExpand = (id, value)=>{\n        setExpand({\n                ...expand, \n                [`${id}${value}`] : expand[`${id}${value}`] ? false: true\n        });\n    }\n\n    const _updatePlaceholder= (value, text)=>{\n        updatePlaceholder(value, text);\n        fetchPlaceHolderValues();\n    }\n\n    const renderSpeechPlaceHolder = (value, id)=>{\n        return <div key={value} className=\"flex flex-col pt-2\">\n                    <div onClick={()=>toggleExpand(id, value)} className=\"text-sm text-blue-500\">{`current text: ${placeholderValues[value] || \"[empty]\"}`}</div>\n                     {expand[`${id}${value}`] && <div>\n                        <div className=\"p-4\"> {`set speech for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <TextEntry close={()=>{toggleExpand(id, value)}} done={(text)=>{toggleExpand(id, value); _updatePlaceholder(value, text)}}/>\n                    </div>}\n                </div>\n    }\n\n    const renderImagePlaceHolder = (value, id)=>{\n        return     <div key={value} className=\"flex flex-col pt-2\">\n                        <div onClick={()=>toggleExpand(id, value)} className=\"p-4 text-blue-500\"> {`upload image for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <div className=\"flex justify-center \"><img onClick={()=>toggleExpand(id, value)} className=\"shadow-md\" width=\"250px\"  style={{border: \"4px solid white\"}} src={`assets/${placeholderValues[value]}`}/></div>\n                        {expand[`${id}${value}`] && <div>\n                            <Uploader close={()=>{toggleExpand(id, value)}} success={(name)=>{toggleExpand(id, value); _updatePlaceholder(value, name)}}/>\n                        </div>}\n                    </div>\n    }\n\n    const renderPlaceholder = (url, placeholder, key)=>{\n        const type = placeholderType(url);\n        switch (type){\n            case \"speech\":\n                return renderSpeechPlaceHolder(placeholder,key);\n\n            case \"image\":\n                return renderImagePlaceHolder(placeholder,key);\n        }\n    }\n\n    const renderPlaceholders = (key,placeholders)=>{\n\n        const items = Object.keys(placeholders).map(url=>{\n            return placeholders[url].map(placeholder=>renderPlaceholder(url, placeholder, key));\n        })\n        return <div>\n            <div className=\"uppercase font-semibold\">{key}</div> \n            {items}      \n        </div>\n    }\n\n    const renderList = () => Object.keys(placeholders).map((key)=>{\n        const placeholder = placeholders[key];\n        return <div className=\"p-4\" key={key}>\n                    {renderPlaceholders(key, placeholder)}\n                   \n                </div>\n    });\n\n    return <div  className=\"flex absolute\" style={{top:80, left:0, width:\"100vw\", height:\"calc(100vh - 80px)\", background:\"#ffffff99\"}}>\n        <div className=\"bg-white flex flex-col p-4 shadow-lg\" style={{width:400, overflowY:\"auto\", height:\"calc(100vh - 100px)\"}}>\n            <div onClick={togglePlaceholders} className=\"flex justify-end justify-items-end m-2 p-2 text-black\">\n               <div className=\"flex justify-center items-center bg-gray-600 text-white\" style={{paddingBottom:5, width:20, height:20, borderRadius:10}}>x</div> \n            </div>\n            <div className=\"text-lg font-semibold text-center w-full\">Manage Dynamic Content</div>\n           \n            {renderList()}\n           \n        </div>\n    </div>\n}","import * as React from \"react\";\nimport * as d3 from \"d3\";\nimport * as d3z from \"d3-zoom\";\nimport request from \"superagent\";\nimport {useD3} from '../../hooks/useD3';\nimport { Uploader } from \"./Uploader\";\nimport {TextEntry} from \"./TextEntry\";\nimport {PlaceholderManager} from \"./PlaceholderManager\";\nimport {placeholderType, updatePlaceholder} from \"../../utils\";\n\nlet _seen = {};\n\nconst _flatten = list => list.reduce(\n    (a, b) => a.concat(Array.isArray(b) ? _flatten(b) : b), []\n);\n\n\nconst links = (node)=>{\n   \n    return _flatten([\n      {    \n        links: node.data.links,\n        trigger: node.data.trigger,\n        from : {\n          name:node.data.id,\n          x: _seen[node.data.id].x,\n          y: _seen[node.data.id].y + 60\n        },\n        to : (node.children||[]).map(c=>({trigger:c.data.trigger, name:c.data.id,x:_seen[c.data.id].x, y:_seen[c.data.id].y-60}))\n      },\n      ...(node.children || []).map(c=>links(c))\n    ])\n  }\n\n  const rids = (node)=>{\n        const root = Object.keys(node.data.links || {}).reduce((acc, key)=>{\n            const item = node.data.links[key];\n            return {\n                ...acc,\n                [item.rid]: item\n            }\n        },{})\n  \n        return {\n            ...root,\n            ...(node.children || []).reduce((acc, item)=>{\n                return {\n                    ...acc,\n                    ...rids(item)\n                }\n            },{})\n        }\n  }\n\nconst linkdata = (node)=>{\n    return {...(node.data.links || {}), ...(node.children || []).reduce((acc,item)=>{\n        return {\n            ...acc,\n            ...linkdata(item),\n        }\n    },{})}\n}\n\nconst _clink = (sx, sy, tx, ty) => {\n    return <path d={`M ${sx} ${sy} C ${(sx + tx) / 2} ${sy}, ${(sx + tx) / 2} ${ty}, ${tx} ${ty}`} style={{stroke:\"#000\", strokeWidth:\"2\", fill:\"none\"}}></path> \n}\n\nconst _loopback = (sx, sy, tx, ty) =>{\n    //(link.from.y + (l.y-link.from.y)/2)\n    \n    return <path d={`M ${sx} ${sy} C ${(sx)} ${sy+60}, ${(sx-120) } ${ty+60}, ${tx} ${ty}`} style={{stroke:\"#444\", strokeWidth:\"1\", fill:\"none\"}}></path> \n}\n\nconst isloopback = (l)=>{\n    \n    const result = l.from.y > l.to.y;\n    return result;\n  }\n  \n\nconst findNode = (t, name)=>{\n\n    if ((t.data || {}).name == name){\n        return t;\n    }\n\n    if ((t.children || []).length <= 0){\n        return null;\n    }\n    \n    //search children\n\n    let node = null;\n    for (let i = 0; i < t.children.length; i++){\n        node = findNode(t.children[i], name);\n        if (node != null){\n            break;\n        }\n    }\n    return node;\n}\n\nconst recenter = (gtree,t)=>{\n    const g = d3.select(gtree.current);\n    const {x,y} = _seen[t.id] || {x:0, y:0};\n    let mx = 0, my=0;\n    const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n    if (moustrans){\n        [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n    }\n    g.attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n}\n\n\nfunction Tree(t) {\n  \n      \n    const gtree = React.useRef();\n    \n    // to toggle showing the placeholder dialogue\n    const [placeholderVisible, setPlaceholderVisible] = React.useState(false);\n\n    // to toggle the main placeholder management screen on and off\n    const [placeholderManagementVisible, setPlaceholderManagementVisible] = React.useState(false);\n    \n    //record the placeholders for the currently selected node\n    const [selectedPlaceholders, setSelectedPlaceholders] = React.useState({}); //placeholders that have been found for a selected node.\n\n    //all of the placeholders in this tree, indexed by node id\n    const [allPlaceholders, setAllPlaceholders] = React.useState({});\n    \n    const [placeholderValues, setPlaceholderValues] = React.useState({}); //placeholders that have been found in the text\n\n\n    const moveChart = ()=>{\n        const g = d3.select(gtree.current);\n        let {x,y} = _seen[t.id] || {x:0,y:0};\n        let mx = 0, my=0;\n        const moustrans = g.select(\"g#dragbox\").attr(\"transform\");\n        if (moustrans){\n            [mx,my] = moustrans.split(/\\s+/)[0].replace(\"translate(\",\"\").replace(\")\",\"\").split(\",\");\n        }\n        g.transition().duration(2000).attr(\"transform\", `translate(${-y-mx+200},${-x-my+t.height/2})`);\n    }\n\n    //recursively get all placeholders from this tree\n    const extractPlaceholders = (node)=>{\n        if (Object.keys(node.data.placeholders||{}).length > 0){\n            return {\n                        [node.data.id]:node.data.placeholders, \n                        ...(node.children || []).reduce((acc, item)=>{\n                            return {...acc, ...extractPlaceholders(item)}\n                        },{})\n            }\n        }else{\n            if ((node.children || []).length > 0){\n                return node.children.reduce((acc, item)=>{\n                    return {...acc, ...extractPlaceholders(item)}\n                },{})\n            }\n            return {};\n        }\n    }\n\n\n    const fetchPlaceHolderValues = async()=>{\n        const {text=\"{}\"} = await request.get(\"/placeholders/\");\n        setPlaceholderValues(JSON.parse(text));\n        setAllPlaceholders(extractPlaceholders(t));\n    }\n\n    React.useEffect(() => {   \n       fetchPlaceHolderValues();\n    }, []);\n\n    React.useEffect(() => {\n        moveChart();\n    }, [t]);\n    \n    const mytree = useD3((svg) => {\n        \n       const dgbox = svg.select(\"g#dragbox\");\n       \n         svg.call(d3z.zoom().on(\"zoom\",  (e)=>{\n            const {x,y} = e.transform;\n            dgbox.attr(\"transform\", `translate(${x},${y})`)\n        }))\n        //svg.call(d3z.zoom, d3z.zoomIdentity.scale(0.8).translate([x,y]))\n\n    }, []);\n\n    const renderLinks = (links, data)=>{\n        const seenlinks = {};\n   \n\n        return links.map((link)=>{\n          \n            return link.to.map((l)=>{\n           \n           \n                if (seenlinks[`${link.from.name},${l.name}`]){\n                    return <g></g>\n                }else{    \n                    seenlinks[`${link.from.name},${l.name}`]= true;\n                //const labeldata = data[`${link.from.name}->${l.name}`] || [];\n                const tx = (l.x-link.from.x)/2;\n                const ty = (Math.max(l.y,link.from.y)-Math.min(l.y,link.from.y))/2;\n                const anchor = \"middle\";//tx == 0 ? \"middle\" : tx < 0 ? \"end\": \"start\";\n                \n            \n                const labeldata = data[l.trigger];\n\n                \n                const mx = 20 + (labeldata.actions.length - 1) * 20;\n\n               \n                const label = labeldata.actions.map((ld,i)=>{\n                    \n                    return <text key={ld.map(a=>a.action).join(\",\")} fontSize=\"x-small\" textAnchor={\"middle\"} x={l.y+60} y={l.x-mx + (i*18)} > {[...new Set(ld.map(l=>l.action))].join(',')}</text>\n                });\n\n                const {rule={}} = labeldata;\n                const operator = rule.operator || \"\";\n                const operand =  rule.operand || [];\n                const rulelabel = `${operator}, ${operand}`;\n                const renderText = ()=>{\n                    if (isloopback({from:link.from, to:l})){\n                       return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"#000\" opacity=\"0.5\" textAnchor={anchor} y={link.from.x+tx-5+70} x={(link.from.y + (l.y-link.from.y)/2)}>{rulelabel}</text>\n                    }\n                   return  <text fontSize=\"x-small\" fontWeight=\"bold\" fill=\"black\" textAnchor={anchor} y={link.from.x+tx-5} x={(link.from.y+ty)}>{rulelabel}</text>\n                }\n\n                const ruletext =    <g>\n                                        <rect x={link.from.y-20+ty} y={link.from.x-13+tx} width={40} height={12} style={{fill: \"#edf2f7\"}}/>\n                                       {renderText()}\n                                    </g>\n\n\n                return <g key={`${l.x},${l.y}`}>\n                            {isloopback({from:link.from, to:l}) ? _loopback(link.from.y, link.from.x, l.y, l.x) : _clink(link.from.y, link.from.x, l.y, l.x)}\n                            {ruletext}\n                            {label}\n                            \n                       </g>\n                }\n\n            });\n           //return link.to.map((l)=><path d={_clink(link.from.x, link.from.y,l.x, l.y)} stroke=\"#D1D1D1\" fill=\"none\"/>);\n        });\n    }\n\n    const togglePlaceholders = async (placeholders={})=>{\n        await fetchPlaceHolderValues();\n        setSelectedPlaceholders(placeholders)\n        setPlaceholderVisible(!placeholderVisible);\n    }\n\n    const toggleShowPlaceHolderManagement = ()=>{\n        setPlaceholderManagementVisible(!placeholderManagementVisible);\n    }\n\n  \n\n    const renderSpeechPlaceHolder = (value)=>{\n        return <div className=\"flex flex-col justify-center items-center\">\n                    <div className=\"text-sm\">{placeholderValues[value]}</div>\n                    <div className=\"p-4\"> {`set speech for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                    <TextEntry close={togglePlaceholders} done={(text)=>{togglePlaceholders(); updatePlaceholder(value, text)}}/>\n                </div>\n    }\n\n    const renderImagePlaceHolder = (value)=>{\n        return     <div className=\"flex flex-col justify-center items-center\">\n                        <div className=\"p-4\"> {`upload image for`} <strong>{value}</strong> {\"placeholder\"}</div>\n                        <div><img className=\"shadow-lg\" style={{border:\"5px solid white\"}} width=\"350px\" src={`assets/${placeholderValues[value]}`}/></div>\n                        <Uploader close={togglePlaceholders} success={(name)=>{togglePlaceholders(); updatePlaceholder(value, name)}}/>\n                    </div>\n    }\n\n    const renderPlaceholder  = (key, value)=>{\n\n        const renderType = (key,value)=>{\n            switch (placeholderType(key)){\n                case \"speech\":\n                    return renderSpeechPlaceHolder(value)\n                case \"image\":\n                    return renderImagePlaceHolder(value);\n                default:\n                    return;\n            }\n        }\n\n        return  <div onClick={togglePlaceholders} className=\"flex absolute justify-center items-center\" style={{top:0, left:0, width:\"100vw\", height:\"100vh\", background:\"#ffffff99\"}}>\n            <div onClick={(e)=>e.stopPropagation()}className=\"flex bg-white rounded shadow-lg border-4 border-gray-300 p-6\">\n                {renderType(key,value)}\n            </div>\n        </div>\n    }\n\n    //render the placeholders for a particular node\n    const renderPlaceholders = ()=>{\n      return  Object.keys(selectedPlaceholders).map(key=>{\n        return renderPlaceholder(key, selectedPlaceholders[key]);\n      })\n    }\n\n   \n\n    const renderTree = (node,selected,rid, handleClick)=>{\n       \n\n        let paint = false;\n       \n        if (_seen[node.data.id].x !== node.x || _seen[node.data.id].y != node.y){\n            return;\n        }\n        \n        if (!rid){\n            paint = selected==node.data.id;// && node.children && node.children.length > 0;\n        }else{\n            paint = selected===node.data.id;// && node.data.trigger == rid;\n        }\n\n        const {placeholders={}} = node.data;\n       \n        const show = Object.keys(placeholders).length > 0;\n       \n\n        return <g key={`${node.x},${node.y}`}> \n                    <rect onClick={()=>handleClick(node.data.id)} x={node.y-60} y={node.x-10} width={120} height={20} rx={10} style={{fill: paint ? \"#4299e1\":\"white\", stroke:\"black\"}}/>\n                    <text onClick={()=>handleClick(node.data.id)} textAnchor=\"middle\" fontSize=\"x-small\"  x={node.y} y={node.x+4}>{node.data.name}</text>\n                    {show && <circle onClick={()=>togglePlaceholders(placeholders)} cx={node.y} cy={node.x-30} r={10} fill=\"#E91475\" stroke=\"#000\"/>}\n                    {(node.children || []).map(n=>renderTree(n, selected, rid,handleClick))}\n            </g>\n\n        \n    }\n\n    _seen = {};\n\n    const generatecoords = (node)=>{\n        if (!_seen[node.data.id]){\n            _seen[node.data.id] = {x:node.x, y:node.y};\n            (node.children || []).map(n=>generatecoords(n))\n        }\n    }\n\n    generatecoords(t);\n\n    return <div className=\"text-black bg-gray-200 rounded bg-white overflow-hidden shadow-lg\"> \n        <svg ref={mytree} height={t.height} style={{width:`calc(100vw - 280px)`}}>\n            <circle onClick={()=>{recenter(gtree,t)}} cx={50} cy={50} r=\"10\" fill=\"white\" strokeWidth={2} stroke=\"#000\"></circle>\n            <circle onClick={()=>{recenter(gtree,t)}} cx={50} cy={50} r=\"5\" fill=\"white\" strokeWidth={2} stroke=\"#000\"></circle>\n            <text onClick={()=>{recenter(gtree,t)}}  textAnchor=\"middle\" fontSize=\"x-small\"  x={50} y={80}>recenter</text>\n\n            <circle onClick={toggleShowPlaceHolderManagement} cx={130} cy={50} r=\"10\" fill=\"#E91475\" strokeWidth={2} stroke=\"#000\"></circle>\n            <text onClick={toggleShowPlaceHolderManagement}  textAnchor=\"middle\" fontSize=\"x-small\"  x={130} y={80}>placeholders</text>\n            <g ref ={gtree} transform={`translate(120,${t.height/2})`}>\n                <g id=\"dragbox\"> \n                    {renderLinks(links(t), rids(t))}\n                    {renderTree(t, t.id, t.triggered, t.handleClick)}\n                </g>\n            </g>   \n        </svg>\n        {placeholderVisible && renderPlaceholders()}\n        {placeholderManagementVisible && <PlaceholderManager placeholders={allPlaceholders} close={toggleShowPlaceHolderManagement}/>}\n    </div>\n }\n \n export default Tree;","import { useState, useEffect } from 'react';\n\nfunction getWindowDimensions() {\n  const { innerWidth: width, innerHeight: height } = window;\n  return {\n    width,\n    height\n  };\n}\n\nexport default function useWindowDimensions() {\n  const [windowDimensions, setWindowDimensions] = useState(getWindowDimensions());\n\n  useEffect(() => {\n    function handleResize() {\n      setWindowDimensions(getWindowDimensions());\n    }\n\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return windowDimensions;\n}\n","import {useState} from 'react';\nimport {useDispatch } from 'react-redux';\nimport {fetchAuthored} from './experienceSlice';\n\nexport function Importer({save, cancel}){\n    const dispatch = useDispatch();\n    const [json, setJSON] = useState({});\n    const [error, setError] = useState(\"\");\n    const [name, setName] = useState(\"\");\n    const [selectedFile, setSelectedFile] = useState();\n\n    const changeHandler = (event) => {\n\t\tsetSelectedFile(event.target.files[0]);\n\t};\n\n\tconst handleSubmission = () => {\n        const fileReader = new FileReader();\n        fileReader.readAsText(selectedFile, \"UTF-8\");\n        fileReader.onload = e => {\n            try{\n                setJSON(JSON.parse(e.target.result))\n            }catch(err){\n\n            }\n        };\n\t};\n\n    const importIt = async ()=>{\n        try {\n            \n            setError(\"\");\n            if (name.trim()==\"\"){\n                setError(\"Please provide a name for this file\");\n                return;\n            }\n            await save(name,json);\n            dispatch(fetchAuthored());\n        }catch(err){\n            setError(\"Error with JSON file, please correct and try again\")\n        }\n    }\n\n    const renderError = ()=>{\n        return <div className=\"text-red-600 p-4 text-bold justify-center\">{error}</div>\n    }\n    const renderUpload = ()=>{\n        return <div className=\"flex flex-row p-4 items-center\">\n            <input type=\"file\" name=\"file\" onChange={changeHandler} />\n            {selectedFile &&  <div onClick={handleSubmission} className=\"m-2 p-2 bg-blue-500 text-white\">upload</div>}\n            <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n        </div>\n    }\n    \n    const renderName = ()=>{\n        return   <div className=\"flex flex-col text-center p-4 items-center justify-center\">\n                    <input value={name} onChange={(e)=>setName(e.target.value)} type=\"text\" placeholder=\"give it a name\" className=\"w-64 p-2 bg-gray-400\"></input>\n                    <div className=\"flex flex-row justify-center items-center\">\n                        <div onClick={importIt} className=\"m-2 p-2 bg-blue-500 text-white\">IMPORT!</div>\n                        <div onClick={cancel} className=\"m-2 p-2 bg-blue-500 text-white\">CANCEL</div>\n                    </div>\n                </div>\n    }\n\n    return <div className=\"relative flex justify-end\">\n        <div className=\"text-center shadow-lg flex flex-col\">\n            {Object.keys(json).length > 0 && renderName()}\n            {Object.keys(json).length <= 0 && renderUpload()}\n            {error && renderError()}\n        </div>\n        \n    </div>\n}","import React, {useEffect, useState} from 'react';\nimport { useSelector, useDispatch } from 'react-redux';\nimport Layer from './Layer';\nimport Navigation from './Navigation';\nimport Tree from './Tree';\nimport useWindowDimensions from '../../hooks/useWindowDimensions';\nimport { Importer } from './Importer';\nimport { Uploader } from './Uploader';\nimport request from 'superagent';\nimport superagent from 'superagent';\n\nimport {\n    listenOnEvents,\n    listenOnActions,\n    fetchLayers,\n    selectEvents,\n    selectAuthored,\n    selectReadyForInput,\n    selectLayerName,\n    selectRendering,\n    selectTrees,\n    reset,\n    fetchAuthored,\n    manualTrigger,\n    renderSpeech,\n} from './experienceSlice';\n\nexport function Experience() {\n  const events = useSelector(selectEvents);\n  const readyforinput = useSelector(selectReadyForInput);\n  const trees = useSelector(selectTrees);\n  const authored = useSelector(selectAuthored);\n  const layerName = useSelector(selectLayerName);\n  const rendering = useSelector(selectRendering);\n  const [visibleTrees, setVisibleTrees] = useState({});\n  const [create, setCreate] = useState(false);\n  const [upload, setUpload] = useState(false);\n\n  const { height } = useWindowDimensions();\n\n  const dispatch = useDispatch();\n\n\n  const proxyRecognition = ()=>{\n    return {\n       start : ()=>{}\n    }\n  }\n\n  \n  const toggleCreate = (value)=>{\n    if (value != undefined){\n      setCreate(value);\n    }else{\n      setCreate(!create);\n    }\n  }\n\n  const toggleUploadMedia = (value)=>{\n    if (value != undefined){\n      setUpload(value);\n    }else{\n      setUpload(!upload);\n    }\n  }\n\n\n  const [startLabel, setStartLabel] = useState(\"start\");\n  \n  //const _fetchLayers = (layer)=>{\n  //  dispatch(fetchLayers(layer, recognition));\n //}\n\n  useEffect(() => {\n    const BrowserSpeechRecognition =\n    typeof window !== 'undefined' &&\n    (window.SpeechRecognition ||\n      window.webkitSpeechRecognition ||\n      window.mozSpeechRecognition ||\n      window.msSpeechRecognition ||\n      window.oSpeechRecognition)\n    const recognition = BrowserSpeechRecognition ? new BrowserSpeechRecognition() : proxyRecognition();\n    recognition.continous = true;\n    recognition.interimResults = true;\n    recognition.lang = 'en-US';\n\n    dispatch(fetchAuthored());\n    dispatch(listenOnEvents());\n    dispatch(listenOnActions(window));\n    const urlSearchParams = new URLSearchParams(window.location.search);\n    const params = Object.fromEntries(urlSearchParams.entries());\n    const {layers=null} = params;\n    if (layers){\n      dispatch(fetchLayers(layers, recognition))\n    }\n  }, []); //only re-run the effect if new message comes in\n\n  const toggleTree = (id)=>{\n    setVisibleTrees({...visibleTrees, [id]:!(visibleTrees[id]||false)})\n  }\n\n  const handleClick = (layer, node)=>{\n    dispatch(manualTrigger(layer,node));\n  }\n \n\n  const expandedtrees = Object.keys(visibleTrees).reduce((acc,key)=>{\n    if (visibleTrees[key]== true)\n      return acc + 1;\n    return acc;\n  },0)\n\n  const minimised = events.length - expandedtrees;  \n  const th = ((height - 54 - (minimised > 0 ? 280 :0)) / expandedtrees) - events.length*4;\n\n  const list = events.sort((e1, e2)=>{\n      if (visibleTrees[e1.id] && !visibleTrees[e2.id])\n        return -1;\n      if (visibleTrees[e2.id] && !visibleTrees[e1.id])\n        return 1;\n      return 0;\n\n  }).map((e,i)=>{\n\n    return  <div key = {e.id} className=\"flex flex-row m-1\">\n              <div  className=\"flex w-64 justify-center overflow-visible\" style={{height:visibleTrees[e.id] ? th-2: 280}}>\n                <Layer {...{...e, ready:readyforinput[e.id]||false, toggleTree}} />\n              </div>\n            { visibleTrees[e.id]  && <Tree {...{...trees[e.id], handleClick:(node)=>{handleClick(e.id, node)}, height:th, id:e.data.id, triggered:e.triggered}}/>}\n          </div>  \n  });\n\n  //const forest = trees.map((t,i)=><Tree key={i} {...t}/>);\n\n  const resetExperience = ()=>{\n     dispatch(reset());\n     setStartLabel(\"reset\");\n  }\n  const save = async (name, json)=>{\n    await request.post('/author/save').set('Content-Type', 'application/json').send({name,layer:json});\n    toggleCreate(false);\n  }\n\n  const exportTwine = ()=>{\n    superagent.get('/author/translate').query({name:layerName}).then(res => {\n      const {html} = res.body;\n      const htmlString = `data:text/html;chatset=utf-8,${encodeURIComponent(html)}`;\n      const link = document.createElement(\"a\");\n      link.href = htmlString;\n      link.download = `${layerName}.html`;\n      link.click();\n   })\n  }\n\n  const _renderSpeech = ()=>{\n    dispatch(renderSpeech());\n  }\n\n  //importer imports twine!\n  return (\n      <div>\n        <Navigation rendering={rendering} authored={authored} start={resetExperience} toggleCreate={toggleCreate} toggleUploadMedia={toggleUploadMedia} twineExport={exportTwine} renderSpeech={_renderSpeech}/>\n        <div className=\"flex row mb-4 border-b-2 flex-wrap\" >\n          {list}\n        </div>\n        {create &&  <div className=\"absolute right-0\" style={{top:80}}><Importer save={(name,json)=>save(name,json)} cancel={()=>toggleCreate(false)}/></div>}\n        {upload && <div className=\"absolute right-0\" style={{top:80}}><Uploader close={()=>toggleUploadMedia(false)}/></div>}\n      </div>\n  );\n  \n}\n","import React from 'react';\r\nimport {Experience} from './features/experience/Experience';\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <Experience/>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { configureStore } from '@reduxjs/toolkit';\r\nimport experienceReducer from '../features/experience/experienceSlice';\r\n\r\nexport default configureStore({\r\n  reducer: {\r\n    experience: experienceReducer,\r\n  },\r\n});\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './assets/main.css'\r\nimport App from './App';\r\nimport store from './app/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <Provider store={store}>\r\n      <App />\r\n    </Provider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}