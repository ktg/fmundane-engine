(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{109:function(e,t,n){},139:function(e,t){},153:function(e,t){},159:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(38),i=n.n(a),s=(n(109),n(3)),o=n(9),l=n(6),d=n(2),u=n(4),f=n(8),j=n(0);var x=function(e){var t=e.ready,n=e.names,c=e.handleAction,r=n.map((function(e){return Object(j.jsx)("button",{onClick:function(){return c(e)},className:"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:e},e)}));return t?Object(j.jsx)("div",{children:r}):Object(j.jsx)(j.Fragment,{})},b=n(15),h=n(11),p=n(43),O=n(78),m=n.n(O),v=n(7),g=n.n(v),y=n(161),w=n(80),k=m()(window.location.href),N=Object(p.b)({name:"experience",initialState:{layers:[],events:[],readyforinput:{},transcript:"",lastsenttranscript:"",authored:[],layerName:"",listening:{},rendering:!1},reducers:{setAuthored:function(e,t){e.authored=t.payload},setLayerName:function(e,t){e.layerName=t.payload},setLayers:function(e,t){e.layers=t.payload},setEvents:function(e,t){e.events=t.payload},setEvent:function(e,t){e.events=[].concat(Object(b.a)(e.events.filter((function(e){return e.id!==t.payload.id}))),[t.payload])},setTranscript:function(e,t){var n=t.payload,c=n.transcript;n.layerid;e.transcript=c},setReadyForInput:function(e,t){e.readyforinput=Object(d.a)(Object(d.a)({},e.readyforinput),t.payload)},setListening:function(e,t){var n=t.payload,c=n.layerid,r=n.listening;e.listening=Object(d.a)(Object(d.a)({},e.listening),{},Object(l.a)({},c,r))},sentTranscript:function(e){e.lastsenttranscript=e.transcript},resetReadiness:function(e){e.readyforinput={}},setRendering:function(e,t){e.rendering=t.payload}}}),C=N.actions,S=C.setRendering,E=C.setLayers,A=C.setLayerName,R=C.setEvent,M=C.setListening,W=C.setEvents,L=C.setTranscript,T=C.sentTranscript,z=C.setReadyForInput,F=C.setAuthored,q=C.resetReadiness,J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return function(t){g.a.get("/event/start").then((function(n){t(q()),t(W(n.body)),t(L({transcript:"",layerid:e}))})).catch((function(e){console.log("error resetting events",e)}))}},U=function(e){return function(){var e=Object(o.a)(Object(s.a)().mark((function e(t){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:k.on("action",function(){var e=Object(o.a)(Object(s.a)().mark((function e(t){var n,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(h.a)(t);try{for(n.s();!(c=n.n()).done;)c.value}catch(r){n.e(r)}finally{n.f()}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},I=function(){return function(){var e=Object(o.a)(Object(s.a)().mark((function e(t,n){var c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=n().experience.layerName,t(S(!0)),e.next=4,g.a.get("/author/render").query({name:c});case 4:t(S(!1));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},Z=function(){return function(e,t){k.on("event",(function(t){e(L({transcript:""})),e(M({layerid:t.id,listening:!1})),e(R(t))})),k.on("ready",(function(t){var n=t.event,c=t.layer;e(L({transcript:""})),console.log("setting ready for inout",n,c),e(z(Object(l.a)({},c,!0))),"speech"===n.type&&e(M({layerid:c,listening:!0}))}))}};k.on("connect_error",(function(){console.log("attempting to reconnect!!"),setTimeout((function(){k.connect()}),1e3)}));var P=function(e,t){return function(n){console.log("button pressed!!",e,t),n(z(Object(l.a)({},t,!1))),g.a.get("/event/press").query({name:e,layer:t}).end((function(e,t){e&&console.log(e)}))}},B=function(e,t){return function(){g.a.get("/event/webhook").query({trigger:e}).end((function(e,t){e&&console.log(e)}))}},D=function(e,t){return function(){g.a.get("/event/trigger").query({layer:e,node:t}).end((function(e,t){e&&console.log(e)}))}},H=function(){return function(e,t){var n=t().experience.transcript,c=t().experience.listening,r=function(){var n=Object(o.a)(Object(s.a)().mark((function n(){var r,a,i;return Object(s.a)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=0,a=Object.keys(c);case 1:if(!(r<a.length)){n.next=10;break}if(i=a[r],!c[i]){n.next=7;break}return n.next=6,g.a.get("/event/speech").query({layer:i,speech:t().experience.transcript});case 6:e(T());case 7:r++,n.next=1;break;case 10:e(L({transcript:""}));case 11:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();""!==n.trim()&&r()}},_=function(){return function(e){g.a.get("/author/authored").then((function(t){var n=t.body.layers;e(F(n))}))}},Y=function(e,t){return function(t,n){g.a.get("/event/layers").query({layer:e}).then((function(n){var c=n.body.map((function(e){return Object(d.a)(Object(d.a)({},e.tree),{},{layerid:e.layerid})}));console.log(c),t(A(e)),t(E(c))})).catch((function(e){console.log("error resetting events",e)}))}},$=function(e){return Object(b.a)(e.experience.events||[]).sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:-1}))},G=function(e){return e.experience.readyforinput},K=function(e){return e.experience.transcript},Q=function(e){return e.experience.layers.reduce((function(e,t){return Object(d.a)(Object(d.a)({},e),{},Object(l.a)({},t.layerid,y.a().nodeSize([120,230])(w.b(t,(function(e){return e.children})))))}),{})},V=function(e){return e.experience.authored},X=function(e){return e.experience.layerName},ee=function(e){return e.experience.rendering},te=N.reducer;function ne(e){var t=e.rules,n=e.ready,r=e.handleAction,a=e.handleChange,i=Object(c.useState)(""),s=Object(u.a)(i,2),o=s[0],l=s[1],d=function(e){a(e),l(e)},x=function(){l(""),r()},h=Object(f.c)(K);return Object(j.jsxs)("div",{className:"flex flex-col h-full w-full",children:[Object(j.jsx)("div",{style:{height:50},className:"flex text-xs font-bold justify-center items-center",children:""==h.trim()?"[listening for speech]":'"'.concat(h,'"')}),n&&Object(j.jsxs)("div",{className:"p-6 bg-black flex flex-grow flex-col",children:[Object(j.jsx)("div",{className:"font-semibold text-white text-base pb-2",children:"override"}),function(){var e=t.reduce((function(e,t){return[].concat(Object(b.a)(e),Object(b.a)((t.rule.operand||[]).map((function(e){return{operand:e,next:t.next}}))))}),[]);return 0===e.length?Object(j.jsxs)("div",{className:"flex flex-col overflow-auto",children:[Object(j.jsx)("input",{onChange:function(e){return d(e.target.value)},value:o,className:"h-10 pl-2 m-4 rounded",type:"text",placeholder:"simulate some words"}),Object(j.jsx)("button",{onClick:function(){x()},className:"bg-blue-500 mr-2 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"say it!"})]}):e.map((function(e){return Object(j.jsx)("button",{onClick:function(){d(e.operand),x()},className:"bg-blue-500 m-2 text-xs hover:bg-blue-700 text-white font-bold py-2 px-4 mt-2rounded",children:"".concat(e.operand," (").concat(e.next,")")},e.operand)}))}()]})]})}var ce=function(e){var t=e.ready,n=e.names,c=e.handleAction,r=n.map((function(e){return Object(j.jsx)("button",{onClick:function(){return c(e)},className:"bg-green-500 m-2 text-xs hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:e},e)}));return t?Object(j.jsx)("div",{children:r}):Object(j.jsx)(j.Fragment,{})};var re=function(e){var t=e.id,n=Object(f.b)();return Object(j.jsxs)("div",{className:"w-full text-black  bg-gray-600 overflow-hidden shadow-lg flex flex-grow flex-col",style:{minHeight:280,overflow:"auto"},children:[Object(j.jsxs)("div",{className:"flex flex-row text-xs font-semibold p-4 bg-gray-400",children:[Object(j.jsxs)("div",{className:"flex flex-grow",children:["".concat(e.id," (").concat(e.data.type,")")," "]}),Object(j.jsx)("div",{onClick:function(){return e.toggleTree(e.id)},className:"flex",children:"tree"})]}),Object(j.jsx)("div",{className:"flex justify-center flex-grow",children:function(e){switch(e.type){case"button":return Object(j.jsx)(x,{ready:e.ready,names:e.data,handleAction:function(e){n(P(e,t))}});case"speech":return Object(j.jsx)(ne,{rules:e.rules,ready:e.ready,handleChange:function(e){n(L({transcript:e,layerid:t}))},handleAction:function(){n(H())}});case"webhook":return Object(j.jsx)(ce,{ready:e.ready,names:e.data,handleAction:function(e){n(B(e))}});default:return JSON.stringify(e,null,4)}}(Object(d.a)(Object(d.a)({},e.data),{},{ready:e.ready||!1}))})]})},ae=function(e){var t=e.start,n=e.authored,c=e.toggleCreate,r=e.toggleUploadMedia,a=e.twineExport,i=e.renderSpeech,s=e.rendering,o=Object(f.c)(X);return Object(j.jsxs)("nav",{className:"flex items-center flex-wrap bg-teal-500 p-1",children:[Object(j.jsx)("div",{className:"flex items-center text-white",children:Object(j.jsxs)("svg",{width:"66",height:"42",viewBox:"0 0 33 21",style:{fillRule:"evenodd",clipRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"1.5"},children:[Object(j.jsx)("path",{d:"M1.425,11.233c1.484,-2.368 3.867,-5.752 8.591,-8.263c4.267,-2.268 9.378,-2.597 10.538,-2.634c11.581,-0.375 11.745,9.075 11.758,9.983c0.149,2.891 -0.988,5.991 -2.709,6.365c-2.557,0.556 -5.645,0.675 -8.484,0.823c-0,-0 -0.485,-2.705 -3.147,-2.523c-3.078,0.211 -3.057,2.749 -3.057,2.749l-5.478,0.034c-3.169,-0.217 -6.251,-0.923 -9.112,-2.878c0.099,-1.076 0.424,-2.577 1.1,-3.656Z",style:{fill:"none",stroke:"#fff",strokeWidth:.65}}),Object(j.jsx)("path",{d:"M18.03,16.213c1.187,0 2.15,0.921 2.15,2.056c0,1.135 -0.963,2.056 -2.15,2.056c-1.187,0 -2.151,-0.921 -2.151,-2.056c-0,-1.135 0.964,-2.056 2.151,-2.056Zm-0,1.273c0.452,-0 0.819,0.351 0.819,0.783c0,0.433 -0.367,0.784 -0.819,0.784c-0.453,-0 -0.82,-0.351 -0.82,-0.784c-0,-0.432 0.367,-0.783 0.82,-0.783Z",style:{fill:"none",stroke:"#fff",strokeWidth:.61}}),Object(j.jsx)("path",{d:"M3.191,11.01c-0,0 5.163,-9.036 17.356,-9.416c10.119,-0.316 10.542,8.541 10.542,8.541c-0.983,0.081 -1.454,0.569 -1.498,0.911c-0.093,0.724 0.607,1.131 1.224,1.14c-0.301,1.964 -0.921,2.796 -2.169,3.24c-1.608,0.572 -6.789,0.413 -6.789,0.413c-0,-0 -0.524,-2.554 -3.759,-2.522c-2.696,0.027 -3.614,2.85 -3.614,2.85c-4.652,0.473 -8.768,-0.024 -12.101,-1.954c0.019,-0.386 0.149,-0.733 0.372,-1.045c-0,-0 1.62,-0.073 1.658,-1.111c0.035,-0.959 -1.222,-1.047 -1.222,-1.047Z",style:{fill:"none",stroke:"#fff",strokeWidth:.65}}),Object(j.jsx)("path",{d:"M21.831,5.29c0.027,-0.872 0.996,-1.574 2.185,-1.574c1.207,0 2.186,0.723 2.186,1.612c0,0.051 -0.003,0.101 -0.009,0.151l0.297,7.926l-4.358,0.089l-0.317,-8.204l0.016,0Z",style:{fill:"none",stroke:"#fff",strokeWidth:.68}}),Object(j.jsx)("ellipse",{cx:"24.137",cy:"6.687",rx:"1.042",ry:"1.013",style:{fill:"none",stroke:"#fff",strokeWidth:.54}}),Object(j.jsx)("path",{d:"M17.87,5.83c-0.004,-0.204 -0.147,-0.367 -0.319,-0.363c-1.828,-0.053 -3.673,-0.044 -5.557,0.109c-0.172,0.003 -0.309,0.171 -0.305,0.375c0.092,0.837 0.1,1.693 0.051,2.564c0.004,0.203 0.147,0.366 0.319,0.363c1.87,-0.146 3.715,-0.137 5.557,-0.11c0.172,-0.003 0.308,-0.171 0.304,-0.375c-0.045,-0.854 -0.062,-1.709 -0.05,-2.563Z",style:{fill:"none",stroke:"#fff",strokeWidth:.61}})]})}),Object(j.jsx)("div",{children:Object(j.jsx)("span",{className:"font-semibold text-xl tracking-tight pl-4 text-white",children:"Future Mundane"})}),Object(j.jsx)("div",{className:"w-full block flex-grow lg:flex lg:items-center lg:w-auto pl-10",children:Object(j.jsxs)("div",{className:"text-sm lg: flex-grow",children:[""!=o.trim()&&Object(j.jsx)("a",{onClick:t,className:"block mt-4 lg:inline-block lg:mt-0 text-white  hover:font-bold mr-4",children:"Start"}),""!=o.trim()&&Object(j.jsx)("a",{target:"_blank",href:encodeURI("/author?layers=".concat(o)),className:"block mt-4 lg:inline-block lg:mt-0 text-teal-200 hover:text-white mr-4",children:"Edit"})]})}),Object(j.jsxs)("div",{className:"flex flex-col",children:[Object(j.jsx)("div",{className:"flex flex-row",children:n.map((function(e){var t=o==e?"font-bold":"font-normal";return Object(j.jsx)("a",{className:"p-2 text-white ".concat(t," text-xs"),style:{opacity:o==e?1:.6},href:encodeURI("?layers=".concat(e)),children:e},e)}))}),Object(j.jsxs)("div",{className:"flex flex-row justify-end",children:[Object(j.jsx)("a",{className:"p-2 text-xs font-bold text-white",onClick:c,children:"upload experience"}),Object(j.jsx)("a",{className:"p-2 text-xs font-bold text-white",onClick:r,children:"upload media"}),""!=o.trim()&&Object(j.jsx)("a",{className:"p-2 text-xs font-bold text-white",onClick:a,children:"export (twine)"}),""!=o.trim()&&Object(j.jsx)("a",{className:"p-2 text-xs font-bold text-white",onClick:i,children:"".concat(s?"[rendering...]":"render speech")})]})]})]})},ie=n(30),se=n(41),oe=function(e,t){var n=r.a.useRef();return r.a.useEffect((function(){return e(ie.a(n.current)),function(){}}),t),n};function le(e){var t=e.close,n=void 0===t?function(){}:t,r=(e.success,Object(c.useState)("")),a=Object(u.a)(r,2),i=a[0],s=(a[1],Object(c.useState)()),o=Object(u.a)(s,2),l=o[0],d=o[1],f=function(e){d(e.target.files[0])},x=function(){var e=new FormData;e.append("mediaFile",l,l.name),console.log(e),fetch("/media/upload",{method:"POST",body:e}).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))};return Object(j.jsx)("div",{style:{width:350},children:Object(j.jsxs)("div",{className:"text-center shadow-lg flex flex-col",children:[Object(j.jsxs)("div",{className:"flex flex-col p-4 items-center",children:[Object(j.jsx)("input",{type:"file",name:"file",onChange:f}),Object(j.jsxs)("div",{className:"flex flex-row p-4 items-center",children:[l&&Object(j.jsx)("div",{onClick:x,className:"m-2 p-2 bg-blue-500 text-white",children:"upload"}),Object(j.jsx)("div",{onClick:n,className:"m-2 p-2 bg-blue-500 text-white",children:"CANCEL"})]})]}),i&&Object(j.jsx)("div",{className:"text-red-600 p-4 text-bold justify-center",children:i})]})})}function de(e){var t=e.close,n=void 0===t?function(){}:t,r=e.done,a=void 0===r?function(){}:r,i=Object(c.useState)(),s=Object(u.a)(i,2),o=s[0],l=s[1];return Object(j.jsx)("div",{className:"relative flex justify-end",children:Object(j.jsxs)("div",{className:"text-center shadow-lg flex flex-col",style:{width:400},children:[Object(j.jsx)("textarea",{className:"border border-black",rows:4,onChange:function(e){return l(e.target.value)},value:o}),Object(j.jsxs)("div",{className:"flex flex-row p-4 items-center justify-center",children:[Object(j.jsx)("div",{onClick:function(){return a(o)},className:"m-2 p-2 bg-blue-500 text-white",children:"set"}),Object(j.jsx)("div",{onClick:n,className:"m-2 p-2 bg-blue-500 text-white",children:"CANCEL"})]})]})})}function ue(e){return-1!=e.indexOf("/image")?"image":-1!=e.indexOf("/speech")?"speech":""}function fe(e,t){return je.apply(this,arguments)}function je(){return(je=Object(o.a)(Object(s.a)().mark((function e(t,n){var c,r;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.get("/placeholders/set").query({key:t,value:n});case 2:c=e.sent,r=c.text,console.log(JSON.parse(r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xe(e){var t=e.placeholders,n=void 0===t?{}:t,r=e.close,a=void 0===r?function(){}:r,i=Object(c.useState)({}),f=Object(u.a)(i,2),x=f[0],b=f[1],h=Object(c.useState)({}),p=Object(u.a)(h,2),O=p[0],m=p[1],v=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,n,c;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.get("/placeholders/");case 2:t=e.sent,n=t.text,c=void 0===n?"{}":n,b(JSON.parse(c));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){v()}),[]);var y=function(e,t){m(Object(d.a)(Object(d.a)({},O),{},Object(l.a)({},"".concat(e).concat(t),!O["".concat(e).concat(t)])))},w=function(e,t){fe(e,t),v()},k=function(e,t,n){var c,r;switch(ue(e)){case"speech":return c=t,r=n,Object(j.jsxs)("div",{className:"flex flex-col pt-2",children:[Object(j.jsx)("div",{onClick:function(){return y(r,c)},className:"text-sm text-blue-500",children:"current text: ".concat(x[c]||"[empty]")}),O["".concat(r).concat(c)]&&Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"p-4",children:[" ","set speech for"," ",Object(j.jsx)("strong",{children:c})," ","placeholder"]}),Object(j.jsx)(de,{close:function(){y(r,c)},done:function(e){y(r,c),w(c,e)}})]})]},c);case"image":return function(e,t){return Object(j.jsxs)("div",{className:"flex flex-col pt-2",children:[Object(j.jsxs)("div",{onClick:function(){return y(t,e)},className:"p-4 text-blue-500",children:[" ","upload image for"," ",Object(j.jsx)("strong",{children:e})," ","placeholder"]}),Object(j.jsx)("div",{className:"flex justify-center ",children:Object(j.jsx)("img",{onClick:function(){return y(t,e)},className:"shadow-md",width:"250px",style:{border:"4px solid white"},src:"assets/".concat(x[e])})}),O["".concat(t).concat(e)]&&Object(j.jsx)("div",{children:Object(j.jsx)(le,{close:function(){y(t,e)},success:function(n){y(t,e),w(e,n)}})})]},e)}(t,n)}},N=function(e,t){var n=Object.keys(t).map((function(n){return t[n].map((function(t){return k(n,t,e)}))}));return Object(j.jsxs)("div",{children:[Object(j.jsx)("div",{className:"uppercase font-semibold",children:e}),n]})};return Object(j.jsx)("div",{className:"flex absolute",style:{top:80,left:0,width:"100vw",height:"calc(100vh - 80px)",background:"#ffffff99"},children:Object(j.jsxs)("div",{className:"bg-white flex flex-col p-4 shadow-lg",style:{width:400,overflowY:"auto",height:"calc(100vh - 100px)"},children:[Object(j.jsx)("div",{onClick:function(e){a()},className:"flex justify-end justify-items-end m-2 p-2 text-black",children:Object(j.jsx)("div",{className:"flex justify-center items-center bg-gray-600 text-white",style:{paddingBottom:5,width:20,height:20,borderRadius:10},children:"x"})}),Object(j.jsx)("div",{className:"text-lg font-semibold text-center w-full",children:"Manage Dynamic Content"}),Object.keys(n).map((function(e){var t=n[e];return Object(j.jsx)("div",{className:"p-4",children:N(e,t)},e)}))]})})}var be={},he=function e(t){return t.reduce((function(t,n){return t.concat(Array.isArray(n)?e(n):n)}),[])},pe=function e(t){return he([{links:t.data.links,trigger:t.data.trigger,from:{name:t.data.id,x:be[t.data.id].x,y:be[t.data.id].y+60},to:(t.children||[]).map((function(e){return{trigger:e.data.trigger,name:e.data.id,x:be[e.data.id].x,y:be[e.data.id].y-60}}))}].concat(Object(b.a)((t.children||[]).map((function(t){return e(t)})))))},Oe=function e(t){var n=Object.keys(t.data.links||{}).reduce((function(e,n){var c=t.data.links[n];return Object(d.a)(Object(d.a)({},e),{},Object(l.a)({},c.rid,c))}),{});return Object(d.a)(Object(d.a)({},n),(t.children||[]).reduce((function(t,n){return Object(d.a)(Object(d.a)({},t),e(n))}),{}))},me=function(e,t,n,c){return Object(j.jsx)("path",{d:"M ".concat(e," ").concat(t," C ").concat((e+n)/2," ").concat(t,", ").concat((e+n)/2," ").concat(c,", ").concat(n," ").concat(c),style:{stroke:"#000",strokeWidth:"2",fill:"none"}})},ve=function(e,t,n,c){return Object(j.jsx)("path",{d:"M ".concat(e," ").concat(t," C ").concat(e," ").concat(t+60,", ").concat(e-120," ").concat(c+60,", ").concat(n," ").concat(c),style:{stroke:"#444",strokeWidth:"1",fill:"none"}})},ge=function(e){return e.from.y>e.to.y},ye=function(e,t){var n=ie.a(e.current),c=be[t.id]||{x:0,y:0},r=c.x,a=c.y,i=0,s=0,o=n.select("g#dragbox").attr("transform");if(o){var l=o.split(/\s+/)[0].replace("translate(","").replace(")","").split(","),d=Object(u.a)(l,2);i=d[0],s=d[1]}n.attr("transform","translate(".concat(-a-i+200,",").concat(-r-s+t.height/2,")"))};var we=function(e){var t=c.useRef(),n=c.useState(!1),r=Object(u.a)(n,2),a=r[0],i=r[1],f=c.useState(!1),x=Object(u.a)(f,2),h=x[0],p=x[1],O=c.useState({}),m=Object(u.a)(O,2),v=m[0],y=m[1],w=c.useState({}),k=Object(u.a)(w,2),N=k[0],C=k[1],S=c.useState({}),E=Object(u.a)(S,2),A=E[0],R=E[1],M=function e(t){return Object.keys(t.data.placeholders||{}).length>0?Object(d.a)(Object(l.a)({},t.data.id,t.data.placeholders),(t.children||[]).reduce((function(t,n){return Object(d.a)(Object(d.a)({},t),e(n))}),{})):(t.children||[]).length>0?t.children.reduce((function(t,n){return Object(d.a)(Object(d.a)({},t),e(n))}),{}):{}},W=function(){var t=Object(o.a)(Object(s.a)().mark((function t(){var n,c,r;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g.a.get("/placeholders/");case 2:n=t.sent,c=n.text,r=void 0===c?"{}":c,R(JSON.parse(r)),C(M(e));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();c.useEffect((function(){W()}),[]),c.useEffect((function(){!function(){var n=ie.a(t.current),c=be[e.id]||{x:0,y:0},r=c.x,a=c.y,i=0,s=0,o=n.select("g#dragbox").attr("transform");if(o){var l=o.split(/\s+/)[0].replace("translate(","").replace(")","").split(","),d=Object(u.a)(l,2);i=d[0],s=d[1]}n.transition().duration(2e3).attr("transform","translate(".concat(-a-i+200,",").concat(-r-s+e.height/2,")"))}()}),[e]);var L=oe((function(e){var t=e.select("g#dragbox");e.call(se.a().on("zoom",(function(e){var n=e.transform,c=n.x,r=n.y;t.attr("transform","translate(".concat(c,",").concat(r,")"))})))}),[]),T=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){var t,n=arguments;return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},e.next=3,W();case 3:y(t),i(!a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){p(!h)},F=function(e,t){return Object(j.jsx)("div",{onClick:T,className:"flex absolute justify-center items-center",style:{top:0,left:0,width:"100vw",height:"100vh",background:"#ffffff99"},children:Object(j.jsx)("div",{onClick:function(e){return e.stopPropagation()},className:"flex bg-white rounded shadow-lg border-4 border-gray-300 p-6",children:function(e,t){switch(ue(e)){case"speech":return function(e){return Object(j.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[Object(j.jsx)("div",{className:"text-sm",children:A[e]}),Object(j.jsxs)("div",{className:"p-4",children:[" ","set speech for"," ",Object(j.jsx)("strong",{children:e})," ","placeholder"]}),Object(j.jsx)(de,{close:T,done:function(t){T(),fe(e,t)}})]})}(t);case"image":return function(e){return Object(j.jsxs)("div",{className:"flex flex-col justify-center items-center",children:[Object(j.jsxs)("div",{className:"p-4",children:[" ","upload image for"," ",Object(j.jsx)("strong",{children:e})," ","placeholder"]}),Object(j.jsx)("div",{children:Object(j.jsx)("img",{className:"shadow-lg",style:{border:"5px solid white"},width:"350px",src:"assets/".concat(A[e])})}),Object(j.jsx)(le,{close:T,success:function(t){T(),fe(e,t)}})]})}(t);default:return}}(e,t)})})};return be={},function e(t){be[t.data.id]||(be[t.data.id]={x:t.x,y:t.y},(t.children||[]).map((function(t){return e(t)})))}(e),Object(j.jsxs)("div",{className:"text-black bg-gray-200 rounded bg-white overflow-hidden shadow-lg",children:[Object(j.jsxs)("svg",{ref:L,height:e.height,style:{width:"calc(100vw - 280px)"},children:[Object(j.jsx)("circle",{onClick:function(){ye(t,e)},cx:50,cy:50,r:"10",fill:"white",strokeWidth:2,stroke:"#000"}),Object(j.jsx)("circle",{onClick:function(){ye(t,e)},cx:50,cy:50,r:"5",fill:"white",strokeWidth:2,stroke:"#000"}),Object(j.jsx)("text",{onClick:function(){ye(t,e)},textAnchor:"middle",fontSize:"x-small",x:50,y:80,children:"recenter"}),Object(j.jsx)("circle",{onClick:z,cx:130,cy:50,r:"10",fill:"#E91475",strokeWidth:2,stroke:"#000"}),Object(j.jsx)("text",{onClick:z,textAnchor:"middle",fontSize:"x-small",x:130,y:80,children:"placeholders"}),Object(j.jsx)("g",{ref:t,transform:"translate(120,".concat(e.height/2,")"),children:Object(j.jsxs)("g",{id:"dragbox",children:[function(e,t){var n={};return e.map((function(e){return e.to.map((function(c){if(n["".concat(e.from.name,",").concat(c.name)])return Object(j.jsx)("g",{});n["".concat(e.from.name,",").concat(c.name)]=!0;var r=(c.x-e.from.x)/2,a=(Math.max(c.y,e.from.y)-Math.min(c.y,e.from.y))/2,i="middle",s=t[c.trigger],o=20+20*(s.actions.length-1),l=s.actions.map((function(e,t){return Object(j.jsxs)("text",{fontSize:"x-small",textAnchor:"middle",x:c.y+60,y:c.x-o+18*t,children:[" ",Object(b.a)(new Set(e.map((function(e){return e.action})))).join(",")]},e.map((function(e){return e.action})).join(","))})),d=s.rule,u=void 0===d?{}:d,f=u.operator||"",x=u.operand||[],h="".concat(f,", ").concat(x),p=Object(j.jsxs)("g",{children:[Object(j.jsx)("rect",{x:e.from.y-20+a,y:e.from.x-13+r,width:40,height:12,style:{fill:"#edf2f7"}}),ge({from:e.from,to:c})?Object(j.jsx)("text",{fontSize:"x-small",fontWeight:"bold",fill:"#000",opacity:"0.5",textAnchor:i,y:e.from.x+r-5+70,x:e.from.y+(c.y-e.from.y)/2,children:h}):Object(j.jsx)("text",{fontSize:"x-small",fontWeight:"bold",fill:"black",textAnchor:i,y:e.from.x+r-5,x:e.from.y+a,children:h})]});return Object(j.jsxs)("g",{children:[ge({from:e.from,to:c})?ve(e.from.y,e.from.x,c.y,c.x):me(e.from.y,e.from.x,c.y,c.x),p,l]},"".concat(c.x,",").concat(c.y))}))}))}(pe(e),Oe(e)),function e(t,n,c,r){var a=!1;if(be[t.data.id].x===t.x&&be[t.data.id].y==t.y){a=c?n===t.data.id:n==t.data.id;var i=t.data.placeholders,s=void 0===i?{}:i,o=Object.keys(s).length>0;return Object(j.jsxs)("g",{children:[Object(j.jsx)("rect",{onClick:function(){return r(t.data.id)},x:t.y-60,y:t.x-10,width:120,height:20,rx:10,style:{fill:a?"#4299e1":"white",stroke:"black"}}),Object(j.jsx)("text",{onClick:function(){return r(t.data.id)},textAnchor:"middle",fontSize:"x-small",x:t.y,y:t.x+4,children:t.data.name}),o&&Object(j.jsx)("circle",{onClick:function(){return T(s)},cx:t.y,cy:t.x-30,r:10,fill:"#E91475",stroke:"#000"}),(t.children||[]).map((function(t){return e(t,n,c,r)}))]},"".concat(t.x,",").concat(t.y))}}(e,e.id,e.triggered,e.handleClick)]})})]}),a&&Object.keys(v).map((function(e){return F(e,v[e])})),h&&Object(j.jsx)(xe,{placeholders:N,close:z})]})};function ke(){var e=window;return{width:e.innerWidth,height:e.innerHeight}}function Ne(e){var t=e.save,n=e.cancel,r=Object(f.b)(),a=Object(c.useState)({}),i=Object(u.a)(a,2),l=i[0],d=i[1],x=Object(c.useState)(""),b=Object(u.a)(x,2),h=b[0],p=b[1],O=Object(c.useState)(""),m=Object(u.a)(O,2),v=m[0],g=m[1],y=Object(c.useState)(),w=Object(u.a)(y,2),k=w[0],N=w[1],C=function(e){N(e.target.files[0])},S=function(){var e=new FileReader;e.readAsText(k,"UTF-8"),e.onload=function(e){try{d(JSON.parse(e.target.result))}catch(t){}}},E=function(){var e=Object(o.a)(Object(s.a)().mark((function e(){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,p(""),""!=v.trim()){e.next=5;break}return p("Please provide a name for this file"),e.abrupt("return");case 5:return e.next=7,t(v,l);case 7:r(_()),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),p("Error with JSON file, please correct and try again");case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();return Object(j.jsx)("div",{className:"relative flex justify-end",children:Object(j.jsxs)("div",{className:"text-center shadow-lg flex flex-col",children:[Object.keys(l).length>0&&Object(j.jsxs)("div",{className:"flex flex-col text-center p-4 items-center justify-center",children:[Object(j.jsx)("input",{value:v,onChange:function(e){return g(e.target.value)},type:"text",placeholder:"give it a name",className:"w-64 p-2 bg-gray-400"}),Object(j.jsxs)("div",{className:"flex flex-row justify-center items-center",children:[Object(j.jsx)("div",{onClick:E,className:"m-2 p-2 bg-blue-500 text-white",children:"IMPORT!"}),Object(j.jsx)("div",{onClick:n,className:"m-2 p-2 bg-blue-500 text-white",children:"CANCEL"})]})]}),Object.keys(l).length<=0&&Object(j.jsxs)("div",{className:"flex flex-row p-4 items-center",children:[Object(j.jsx)("input",{type:"file",name:"file",onChange:C}),k&&Object(j.jsx)("div",{onClick:S,className:"m-2 p-2 bg-blue-500 text-white",children:"upload"}),Object(j.jsx)("div",{onClick:n,className:"m-2 p-2 bg-blue-500 text-white",children:"CANCEL"})]}),h&&Object(j.jsx)("div",{className:"text-red-600 p-4 text-bold justify-center",children:h})]})})}function Ce(){var e=Object(f.c)($),t=Object(f.c)(G),n=Object(f.c)(Q),r=Object(f.c)(V),a=Object(f.c)(X),i=Object(f.c)(ee),x=Object(c.useState)({}),b=Object(u.a)(x,2),h=b[0],p=b[1],O=Object(c.useState)(!1),m=Object(u.a)(O,2),v=m[0],y=m[1],w=Object(c.useState)(!1),k=Object(u.a)(w,2),N=k[0],C=k[1],S=function(){var e=Object(c.useState)(ke()),t=Object(u.a)(e,2),n=t[0],r=t[1];return Object(c.useEffect)((function(){function e(){r(ke())}return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]),n}(),E=S.height,A=Object(f.b)(),R=function(e){y(void 0!=e?e:!v)},M=function(e){C(void 0!=e?e:!N)},W=Object(c.useState)("start"),L=Object(u.a)(W,2),T=(L[0],L[1]);Object(c.useEffect)((function(){var e="undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition),t=e?new e:{start:function(){}};t.continous=!0,t.interimResults=!0,t.lang="en-US",A(_()),A(Z()),A(U(window));var n=new URLSearchParams(window.location.search),c=Object.fromEntries(n.entries()).layers,r=void 0===c?null:c;r&&A(Y(r,t))}),[]);var z=function(e){p(Object(d.a)(Object(d.a)({},h),{},Object(l.a)({},e,!h[e])))},F=Object.keys(h).reduce((function(e,t){return 1==h[t]?e+1:e}),0),q=(E-54-(e.length-F>0?280:0))/F-4*e.length,P=e.sort((function(e,t){return h[e.id]&&!h[t.id]?-1:h[t.id]&&!h[e.id]?1:0})).map((function(e,c){return Object(j.jsxs)("div",{className:"flex flex-row m-1",children:[Object(j.jsx)("div",{className:"flex w-64 justify-center overflow-visible",style:{height:h[e.id]?q-2:280},children:Object(j.jsx)(re,Object(d.a)({},Object(d.a)(Object(d.a)({},e),{},{ready:t[e.id]||!1,toggleTree:z})))}),h[e.id]&&Object(j.jsx)(we,Object(d.a)({},Object(d.a)(Object(d.a)({},n[e.id]),{},{handleClick:function(t){!function(e,t){A(D(e,t))}(e.id,t)},height:q,id:e.data.id,triggered:e.triggered})))]},e.id)})),B=function(){var e=Object(o.a)(Object(s.a)().mark((function e(t,n){return Object(s.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a.post("/author/save").set("Content-Type","application/json").send({name:t,layer:n});case 2:R(!1);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{children:[Object(j.jsx)(ae,{rendering:i,authored:r,start:function(){A(J()),T("reset")},toggleCreate:R,toggleUploadMedia:M,twineExport:function(){g.a.get("/author/translate").query({name:a}).then((function(e){var t=e.body.html,n="data:text/html;chatset=utf-8,".concat(encodeURIComponent(t)),c=document.createElement("a");c.href=n,c.download="".concat(a,".html"),c.click()}))},renderSpeech:function(){A(I())}}),Object(j.jsx)("div",{className:"flex row mb-4 border-b-2 flex-wrap",children:P}),v&&Object(j.jsx)("div",{className:"absolute right-0",style:{top:80},children:Object(j.jsx)(Ne,{save:function(e,t){return B(e,t)},cancel:function(){return R(!1)}})}),N&&Object(j.jsx)("div",{className:"absolute right-0",style:{top:80},children:Object(j.jsx)(le,{close:function(){return M(!1)}})})]})}var Se=function(){return Object(j.jsx)("div",{className:"App",children:Object(j.jsx)("header",{className:"App-header",children:Object(j.jsx)(Ce,{})})})},Ee=Object(p.a)({reducer:{experience:te}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(j.jsx)(r.a.StrictMode,{children:Object(j.jsx)(f.a,{store:Ee,children:Object(j.jsx)(Se,{})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[159,1,2]]]);
//# sourceMappingURL=main.0faa5b2d.chunk.js.map